<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<link href="toc.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
      <span id="toggle-toc">Contents</span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="https://github.com/AU-COBRA/ConCert" target="_balnk">Project Page</a>
      <a href="index.html">Index</a>
      <a href="toc.html">Table of contents</a>
    </span>
</div>
  <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="js-toc" class="toc" data-toc="h1,h2,h3,h4" data-toc-container="doc" data-toc-offset="-40">
      <div id="js-toc-header" class="toc-header">Contents:</div>
    </div>
    <div id="main">
<h1 class="libtitle">Library ConCert.Execution.BuildUtils</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>. <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Logic.Decidable.html#"><span class="id" title="library">Logic.Decidable</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.ZArith.html#"><span class="id" title="library">ZArith</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.Automation.html#"><span class="id" title="library">Automation</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.RecordUpdate.html#"><span class="id" title="library">RecordUpdate</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Blockchain.html#"><span class="id" title="library">Blockchain</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Serializable.html#"><span class="id" title="library">Serializable</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.ResultMonad.html#"><span class="id" title="library">ResultMonad</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="BuildUtils" class="idref" href="#BuildUtils"><span class="id" title="section">BuildUtils</span></a>.<br/>
<span class="id" title="keyword">Context</span> {<a id="BaseTypes:1" class="idref" href="#BaseTypes:1"><span class="id" title="binder">BaseTypes</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a>}.<br/>

<br/>
<span class="comment">(*&nbsp;The&nbsp;empty&nbsp;state&nbsp;is&nbsp;always&nbsp;reachable&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_empty_state" class="idref" href="#reachable_empty_state"><span class="id" title="lemma">reachable_empty_state</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Transitivity&nbsp;property&nbsp;of&nbsp;reachable&nbsp;and&nbsp;ChainTrace&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_trans" class="idref" href="#reachable_trans"><span class="id" title="lemma">reachable_trans</span></a> <a id="from:2" class="idref" href="#from:2"><span class="id" title="binder">from</span></a> <a id="to:3" class="idref" href="#to:3"><span class="id" title="binder">to</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:2"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:2"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:3"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:3"><span class="id" title="variable">to</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.ChainedList.html#clist_app"><span class="id" title="definition">ChainedList.clist_app</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Transitivity&nbsp;property&nbsp;of&nbsp;reachable&nbsp;and&nbsp;ChainStep&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_step" class="idref" href="#reachable_step"><span class="id" title="lemma">reachable_step</span></a> <a id="from:4" class="idref" href="#from:4"><span class="id" title="binder">from</span></a> <a id="to:5" class="idref" href="#to:5"><span class="id" title="binder">to</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:4"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:4"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:5"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:5"><span class="id" title="variable">to</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">econstructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;state&nbsp;is&nbsp;reachable&nbsp;then&nbsp;the&nbsp;finalized_height&nbsp;cannot&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;chain_height&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="finalized_heigh_chain_height" class="idref" href="#finalized_heigh_chain_height"><span class="id" title="lemma">finalized_heigh_chain_height</span></a> <a id="bstate:6" class="idref" href="#bstate:6"><span class="id" title="binder">bstate</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:6"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#finalized_height"><span class="id" title="projection">finalized_height</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:6"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_height"><span class="id" title="projection">chain_height</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:6"><span class="id" title="variable">bstate</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">trace</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">Heq</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">trace</span> <span class="id" title="var">IH</span> <span class="id" title="var">step</span> ]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">destruct_chain_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">valid_header</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;state&nbsp;is&nbsp;reachable&nbsp;and&nbsp;contract&nbsp;state&nbsp;is&nbsp;stored&nbsp;on&nbsp;an&nbsp;address<br/>
&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;that&nbsp;address&nbsp;must&nbsp;also&nbsp;have&nbsp;some&nbsp;contract&nbsp;deployed&nbsp;to&nbsp;it&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="contract_states_deployed" class="idref" href="#contract_states_deployed"><span class="id" title="lemma">contract_states_deployed</span></a> <a id="to:7" class="idref" href="#to:7"><span class="id" title="binder">to</span></a> (<a id="addr:8" class="idref" href="#addr:8"><span class="id" title="binder">addr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) (<a id="state:9" class="idref" href="#state:9"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#SerializedValue"><span class="id" title="record">SerializedValue</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:7"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:7"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:8"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#state:9"><span class="id" title="variable">state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="wc:10" class="idref" href="#wc:10"><span class="id" title="binder">wc</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:7"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:8"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc:10"><span class="id" title="variable">wc</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">trace</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">Heq</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">trace</span> <span class="id" title="var">IH</span> <span class="id" title="var">step</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">destruct_chain_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 2: <span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">env_eq</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;state&nbsp;is&nbsp;reachable&nbsp;and&nbsp;contract&nbsp;state&nbsp;is&nbsp;stored&nbsp;on&nbsp;an&nbsp;address<br/>
&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;that&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;contract&nbsp;address&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="contract_states_addr_format" class="idref" href="#contract_states_addr_format"><span class="id" title="lemma">contract_states_addr_format</span></a> <a id="to:11" class="idref" href="#to:11"><span class="id" title="binder">to</span></a> (<a id="addr:12" class="idref" href="#addr:12"><span class="id" title="binder">addr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) (<a id="state:13" class="idref" href="#state:13"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#SerializedValue"><span class="id" title="record">SerializedValue</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:11"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:11"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:12"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#state:13"><span class="id" title="variable">state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:12"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#contract_states_deployed"><span class="id" title="lemma">contract_states_deployed</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state</span> <span class="id" title="keyword">as</span> []; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_addr_format"><span class="id" title="lemma">contract_addr_format</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">reachable_empty_state</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_step</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;state&nbsp;`to`&nbsp;is&nbsp;reachable&nbsp;through&nbsp;`mid`&nbsp;if&nbsp;`mid`&nbsp;is&nbsp;reachable&nbsp;and&nbsp;there&nbsp;exists&nbsp;a&nbsp;trace<br/>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;`mid`&nbsp;to&nbsp;`to`.&nbsp;This&nbsp;captures&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;valid&nbsp;execution&nbsp;ending&nbsp;up&nbsp;in&nbsp;`to`<br/>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;going&nbsp;through&nbsp;the&nbsp;state&nbsp;`mid`&nbsp;at&nbsp;some&nbsp;point&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="reachable_through" class="idref" href="#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a id="mid:14" class="idref" href="#mid:14"><span class="id" title="binder">mid</span></a> <a id="to:15" class="idref" href="#to:15"><span class="id" title="binder">to</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#mid:14"><span class="id" title="variable">mid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#inhabited"><span class="id" title="inductive">inhabited</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#mid:14"><span class="id" title="variable">mid</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:15"><span class="id" title="variable">to</span></a>).<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;state&nbsp;is&nbsp;always&nbsp;reachable&nbsp;through&nbsp;itself&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_refl" class="idref" href="#reachable_through_refl"><span class="id" title="lemma">reachable_through_refl</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:16" class="idref" href="#bstate:16"><span class="id" title="binder">bstate</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:16"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:16"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:16"><span class="id" title="variable">bstate</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">bstate</span> <span class="id" title="var">reach</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Transitivity&nbsp;property&nbsp;of&nbsp;reachable_through&nbsp;and&nbsp;ChainStep&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_trans'" class="idref" href="#reachable_through_trans'"><span class="id" title="lemma">reachable_through_trans'</span></a> : <span class="id" title="keyword">forall</span> <a id="from:17" class="idref" href="#from:17"><span class="id" title="binder">from</span></a> <a id="mid:18" class="idref" href="#mid:18"><span class="id" title="binder">mid</span></a> <a id="to:19" class="idref" href="#to:19"><span class="id" title="binder">to</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:17"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#mid:18"><span class="id" title="variable">mid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#mid:18"><span class="id" title="variable">mid</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:19"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:17"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:19"><span class="id" title="variable">to</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [<span class="id" title="var">reach</span> [<span class="id" title="var">trace</span>]] <span class="id" title="var">step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Transitivity&nbsp;property&nbsp;of&nbsp;reachable_through&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_trans" class="idref" href="#reachable_through_trans"><span class="id" title="lemma">reachable_through_trans</span></a> : <span class="id" title="keyword">forall</span> <a id="from:20" class="idref" href="#from:20"><span class="id" title="binder">from</span></a> <a id="mid:21" class="idref" href="#mid:21"><span class="id" title="binder">mid</span></a> <a id="to:22" class="idref" href="#to:22"><span class="id" title="binder">to</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:20"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#mid:21"><span class="id" title="variable">mid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#mid:21"><span class="id" title="variable">mid</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:22"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:20"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:22"><span class="id" title="variable">to</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [[<span class="id" title="var">trace_from</span>] [<span class="id" title="var">trace_mid</span>]] [<span class="id" title="var">_</span> [<span class="id" title="var">trace_to</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.ChainedList.html#clist_app"><span class="id" title="definition">ChainedList.clist_app</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Reachable_through&nbsp;can&nbsp;also&nbsp;be&nbsp;constructed&nbsp;from&nbsp;ChainStep&nbsp;instead&nbsp;of&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;ChainTrace&nbsp;since&nbsp;a&nbsp;ChainTrace&nbsp;can&nbsp;be&nbsp;constructed&nbsp;from&nbsp;a&nbsp;ChainStep&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_step" class="idref" href="#reachable_through_step"><span class="id" title="lemma">reachable_through_step</span></a> : <span class="id" title="keyword">forall</span> <a id="from:23" class="idref" href="#from:23"><span class="id" title="binder">from</span></a> <a id="to:24" class="idref" href="#to:24"><span class="id" title="binder">to</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:23"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:23"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:24"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:23"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:24"><span class="id" title="variable">to</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach_from</span> <span class="id" title="var">step</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through_refl"><span class="id" title="lemma">reachable_through_refl</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">reach_from</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through_trans'"><span class="id" title="lemma">reachable_through_trans'</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Any&nbsp;ChainState&nbsp;that&nbsp;is&nbsp;reachable&nbsp;through&nbsp;another&nbsp;ChainState&nbsp;is&nbsp;reachable&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_reachable" class="idref" href="#reachable_through_reachable"><span class="id" title="lemma">reachable_through_reachable</span></a> : <span class="id" title="keyword">forall</span> <a id="from:25" class="idref" href="#from:25"><span class="id" title="binder">from</span></a> <a id="to:26" class="idref" href="#to:26"><span class="id" title="binder">to</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:25"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:26"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:26"><span class="id" title="variable">to</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [[<span class="id" title="var">trace_from</span>] [<span class="id" title="var">trace_to</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.ChainedList.html#clist_app"><span class="id" title="definition">ChainedList.clist_app</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">reachable_through_refl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_trans'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_reachable</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;state&nbsp;has&nbsp;a&nbsp;contract&nbsp;deployed&nbsp;to&nbsp;some&nbsp;addr&nbsp;then&nbsp;any&nbsp;other&nbsp;state<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reachable&nbsp;through&nbsp;the&nbsp;first&nbsp;state&nbsp;must&nbsp;also&nbsp;have&nbsp;the&nbsp;same&nbsp;contract<br/>
&nbsp;&nbsp;&nbsp;&nbsp;deployed&nbsp;to&nbsp;the&nbsp;same&nbsp;addr&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_contract_deployed" class="idref" href="#reachable_through_contract_deployed"><span class="id" title="lemma">reachable_through_contract_deployed</span></a> : <span class="id" title="keyword">forall</span> <a id="from:27" class="idref" href="#from:27"><span class="id" title="binder">from</span></a> <a id="to:28" class="idref" href="#to:28"><span class="id" title="binder">to</span></a> <a id="addr:29" class="idref" href="#addr:29"><span class="id" title="binder">addr</span></a> <a id="wc:30" class="idref" href="#wc:30"><span class="id" title="binder">wc</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:27"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:28"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:27"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:29"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc:30"><span class="id" title="variable">wc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:28"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:29"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc:30"><span class="id" title="variable">wc</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [<span class="id" title="var">reach</span> [<span class="id" title="var">trace</span>]] <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">from</span> <span class="id" title="var">mid</span> <span class="id" title="var">to</span> <span class="id" title="var">trace</span> <span class="id" title="var">IH</span> <span class="id" title="var">step</span> ].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">destruct_chain_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 2: <span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">not_deployed</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;state&nbsp;has&nbsp;a&nbsp;contract&nbsp;state&nbsp;on&nbsp;some&nbsp;addr&nbsp;then&nbsp;any&nbsp;other&nbsp;state<br/>
&nbsp;&nbsp;&nbsp;&nbsp;reachable&nbsp;through&nbsp;the&nbsp;first&nbsp;state&nbsp;must&nbsp;also&nbsp;have&nbsp;the&nbsp;some&nbsp;contracts<br/>
&nbsp;&nbsp;&nbsp;&nbsp;state&nbsp;on&nbsp;the&nbsp;same&nbsp;addr&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_contract_state" class="idref" href="#reachable_through_contract_state"><span class="id" title="lemma">reachable_through_contract_state</span></a> : <span class="id" title="keyword">forall</span> <a id="from:31" class="idref" href="#from:31"><span class="id" title="binder">from</span></a> <a id="to:32" class="idref" href="#to:32"><span class="id" title="binder">to</span></a> <a id="addr:33" class="idref" href="#addr:33"><span class="id" title="binder">addr</span></a> <a id="cstate:34" class="idref" href="#cstate:34"><span class="id" title="binder">cstate</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:31"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:32"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:31"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:33"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:34"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="new_cstate:35" class="idref" href="#new_cstate:35"><span class="id" title="binder">new_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:32"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:33"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_cstate:35"><span class="id" title="variable">new_cstate</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [<span class="id" title="var">reachable</span> [<span class="id" title="var">trace</span>]] <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">cstate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">from</span> <span class="id" title="var">mid</span> <span class="id" title="var">to</span> <span class="id" title="var">trace</span> <span class="id" title="var">IH</span> <span class="id" title="var">step</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">cstate</span> <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">destruct_chain_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 2: <span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">rewrite_environment_equiv</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">env_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;state&nbsp;is&nbsp;reachable&nbsp;through&nbsp;another&nbsp;state&nbsp;then&nbsp;it&nbsp;cannot&nbsp;have&nbsp;a&nbsp;lower&nbsp;chain&nbsp;height&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_chain_height" class="idref" href="#reachable_through_chain_height"><span class="id" title="lemma">reachable_through_chain_height</span></a> : <span class="id" title="keyword">forall</span> <a id="from:36" class="idref" href="#from:36"><span class="id" title="binder">from</span></a> <a id="to:37" class="idref" href="#to:37"><span class="id" title="binder">to</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:36"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:37"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:36"><span class="id" title="variable">from</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_height"><span class="id" title="projection">chain_height</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:37"><span class="id" title="variable">to</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_height"><span class="id" title="projection">chain_height</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [<span class="id" title="var">reachable</span> [<span class="id" title="var">trace</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">from</span> <span class="id" title="var">mid</span> <span class="id" title="var">to</span> <span class="id" title="var">trace</span> <span class="id" title="var">IH</span> <span class="id" title="var">step</span> ].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.le_refl"><span class="id" title="lemma">Nat.le_refl</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">destruct_chain_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">valid_header</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;state&nbsp;is&nbsp;reachable&nbsp;through&nbsp;another&nbsp;state&nbsp;then&nbsp;it&nbsp;cannot&nbsp;have&nbsp;a&nbsp;lower&nbsp;current&nbsp;slot&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_current_slot" class="idref" href="#reachable_through_current_slot"><span class="id" title="lemma">reachable_through_current_slot</span></a> : <span class="id" title="keyword">forall</span> <a id="from:38" class="idref" href="#from:38"><span class="id" title="binder">from</span></a> <a id="to:39" class="idref" href="#to:39"><span class="id" title="binder">to</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:38"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:39"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:38"><span class="id" title="variable">from</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:39"><span class="id" title="variable">to</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [<span class="id" title="var">reachable</span> [<span class="id" title="var">trace</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">from</span> <span class="id" title="var">mid</span> <span class="id" title="var">to</span> <span class="id" title="var">trace</span> <span class="id" title="var">IH</span> <span class="id" title="var">step</span> ].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.le_refl"><span class="id" title="lemma">Nat.le_refl</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">destruct_chain_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">valid_header</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;If&nbsp;a&nbsp;state&nbsp;is&nbsp;reachable&nbsp;through&nbsp;another&nbsp;state&nbsp;then&nbsp;it&nbsp;cannot&nbsp;have&nbsp;a&nbsp;lower&nbsp;finalized&nbsp;height&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="reachable_through_finalized_height" class="idref" href="#reachable_through_finalized_height"><span class="id" title="lemma">reachable_through_finalized_height</span></a> : <span class="id" title="keyword">forall</span> <a id="from:40" class="idref" href="#from:40"><span class="id" title="binder">from</span></a> <a id="to:41" class="idref" href="#to:41"><span class="id" title="binder">to</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:40"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:41"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:40"><span class="id" title="variable">from</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#finalized_height"><span class="id" title="projection">finalized_height</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:41"><span class="id" title="variable">to</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#finalized_height"><span class="id" title="projection">finalized_height</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [<span class="id" title="var">reachable</span> [<span class="id" title="var">trace</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">from</span> <span class="id" title="var">mid</span> <span class="id" title="var">to</span> <span class="id" title="var">trace</span> <span class="id" title="var">IH</span> <span class="id" title="var">step</span> ].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.le_refl"><span class="id" title="lemma">Nat.le_refl</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">destruct_chain_step</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">valid_header</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Initial&nbsp;contract&nbsp;balance&nbsp;will&nbsp;always&nbsp;be&nbsp;positive&nbsp;in&nbsp;reachable&nbsp;states&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="deployment_amount_nonnegative" class="idref" href="#deployment_amount_nonnegative"><span class="id" title="lemma">deployment_amount_nonnegative</span></a> : <span class="id" title="keyword">forall</span> {<a id="Setup:42" class="idref" href="#Setup:42"><span class="id" title="binder">Setup</span></a> : <span class="id" title="keyword">Type</span>} `{<a id="H:43" class="idref" href="#H:43"><span class="id" title="binder">Serializable</span></a> <a id="H:43" class="idref" href="#H:43"><span class="id" title="binder">Setup</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="bstate:44" class="idref" href="#bstate:44"><span class="id" title="binder">bstate</span></a> <a id="caddr:45" class="idref" href="#caddr:45"><span class="id" title="binder">caddr</span></a> <a id="dep_info:46" class="idref" href="#dep_info:46"><span class="id" title="binder">dep_info</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="trace:47" class="idref" href="#trace:47"><span class="id" title="binder">trace</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:44"><span class="id" title="variable">bstate</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_info"><span class="id" title="definition">deployment_info</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Setup:42"><span class="id" title="variable">Setup</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#trace:47"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:45"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#dep_info:46"><span class="id" title="variable">dep_info</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#dep_info:46"><span class="id" title="variable">dep_info</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_amount"><span class="id" title="projection">deployment_amount</span></a>))%<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">deployment_info_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">trace</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">destruct_chain_step</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_action_eval</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployment_info_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployment_info_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">deployment_info_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.ge_le"><span class="id" title="lemma">Z.ge_le</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="receiver_can_receive_transfer" class="idref" href="#receiver_can_receive_transfer"><span class="id" title="definition">receiver_can_receive_transfer</span></a> (<a id="bstate:48" class="idref" href="#bstate:48"><span class="id" title="binder">bstate</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a>) <a id="act_body:49" class="idref" href="#act_body:49"><span class="id" title="binder">act_body</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#act_body:49"><span class="id" title="variable">act_body</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <span class="id" title="var">to</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <span class="id" title="var">to</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="wc:51" class="idref" href="#wc:51"><span class="id" title="binder">wc</span></a> <a id="state:52" class="idref" href="#state:52"><span class="id" title="binder">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:48"><span class="id" title="variable">bstate</span></a> <span class="id" title="var">to</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc:51"><span class="id" title="variable">wc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:48"><span class="id" title="variable">bstate</span></a> <span class="id" title="var">to</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#state:52"><span class="id" title="variable">state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<a id="bstate_new:53" class="idref" href="#bstate_new:53"><span class="id" title="binder">bstate_new</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a>) <a id="ctx:54" class="idref" href="#ctx:54"><span class="id" title="binder">ctx</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="new_state:55" class="idref" href="#new_state:55"><span class="id" title="binder">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive"><span class="id" title="definition">wc_receive</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc:51"><span class="id" title="variable">wc</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate_new:53"><span class="id" title="variable">bstate_new</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#ctx:54"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#state:52"><span class="id" title="variable">state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.BuildUtils.html#new_state:55"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;This&nbsp;axiom&nbsp;states&nbsp;that&nbsp;for&nbsp;any&nbsp;reachable&nbsp;state&nbsp;and&nbsp;any&nbsp;contract&nbsp;it&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;&nbsp;decidable&nbsp;wether&nbsp;or&nbsp;there&nbsp;is&nbsp;an&nbsp;address&nbsp;where&nbsp;the&nbsp;contract&nbsp;can&nbsp;be&nbsp;deployed&nbsp;to.<br/>
&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;not&nbsp;provable&nbsp;in&nbsp;general&nbsp;with&nbsp;the&nbsp;assumption&nbsp;ChainBase&nbsp;makes&nbsp;about<br/>
&nbsp;&nbsp;&nbsp;&nbsp;addresses&nbsp;and&nbsp;the&nbsp;function&nbsp;address_is_contract.&nbsp;However&nbsp;this&nbsp;should&nbsp;be<br/>
&nbsp;&nbsp;&nbsp;&nbsp;provable&nbsp;in&nbsp;any&nbsp;sensible&nbsp;instance&nbsp;of&nbsp;ChainBase&nbsp;*)</span><br/>
<span class="id" title="keyword">Axiom</span> <a id="deployable_address_decidable" class="idref" href="#deployable_address_decidable"><span class="id" title="axiom">deployable_address_decidable</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:56" class="idref" href="#bstate:56"><span class="id" title="binder">bstate</span></a> <a id="wc:57" class="idref" href="#wc:57"><span class="id" title="binder">wc</span></a> <a id="setup:58" class="idref" href="#setup:58"><span class="id" title="binder">setup</span></a> <a id="act_origin:59" class="idref" href="#act_origin:59"><span class="id" title="binder">act_origin</span></a> <a id="act_from:60" class="idref" href="#act_from:60"><span class="id" title="binder">act_from</span></a> <a id="amount:61" class="idref" href="#amount:61"><span class="id" title="binder">amount</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:56"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Logic.Decidable.html#decidable"><span class="id" title="definition">decidable</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="addr:62" class="idref" href="#addr:62"><span class="id" title="binder">addr</span></a> <a id="state:63" class="idref" href="#state:63"><span class="id" title="binder">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:62"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:56"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:62"><span class="id" title="variable">addr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_init"><span class="id" title="definition">wc_init</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc:57"><span class="id" title="variable">wc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act_from:60"><span class="id" title="variable">act_from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:62"><span class="id" title="variable">addr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:61"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:56"><span class="id" title="variable">bstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#build_ctx"><span class="id" title="constructor">build_ctx</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act_origin:59"><span class="id" title="variable">act_origin</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act_from:60"><span class="id" title="variable">act_from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#addr:62"><span class="id" title="variable">addr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:61"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:61"><span class="id" title="variable">amount</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#setup:58"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#state:63"><span class="id" title="variable">state</span></a>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">action_not_decidable</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">right</span>; <span class="id" title="tactic">intro</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate:67" class="idref" href="#bstate:67"><span class="id" title="binder">bstate</span></a> <a id="new_acts:68" class="idref" href="#new_acts:68"><span class="id" title="binder">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#inhabited"><span class="id" title="inductive">inhabited</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:65"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:66"><span class="id" title="variable">new_acts</span></a>) |- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">bstate_new</span> [<span class="id" title="var">new_acts</span> [<span class="id" title="var">action_evaluation</span>]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_action_eval</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">{|</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_origin"><span class="id" title="projection">act_origin</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#act_from"><span class="id" title="projection">act_from</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#act_body"><span class="id" title="projection">act_body</span></a> := <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">|}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">{|</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_origin"><span class="id" title="projection">act_origin</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#act_from"><span class="id" title="projection">act_from</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#act_body"><span class="id" title="projection">act_body</span></a> := <span class="id" title="keyword">match</span> ?<span class="id" title="var">msg</span> <span class="id" title="keyword">with</span> | <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span> | <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt;<span class="id" title="var">_</span> <span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">|}</span></a> |- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">{|</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_origin"><span class="id" title="projection">act_origin</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#act_from"><span class="id" title="projection">act_from</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#act_body"><span class="id" title="projection">act_body</span></a> := <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">|}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">{|</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_origin"><span class="id" title="projection">act_origin</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#act_from"><span class="id" title="projection">act_from</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#act_body"><span class="id" title="projection">act_body</span></a> := <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">|}</span></a> |- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">action_decidable</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>; <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">constructor</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive"><span class="id" title="definition">wc_receive</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ?<span class="id" title="var">m</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#eval_call"><span class="id" title="constructor">eval_call</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#wc_init"><span class="id" title="definition">wc_init</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#eval_deploy"><span class="id" title="constructor">eval_deploy</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="keyword">context</span> [<a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>] |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#eval_transfer"><span class="id" title="constructor">eval_transfer</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rewrite_balance</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> := <span class="id" title="keyword">context</span> [<span class="id" title="keyword">if</span> (<span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Blockchain.html#6f617e0e5500b437e5aeb1eaa876d41f"><span class="id" title="notation">=?</span></a> ?<span class="id" title="var">to</span>)%<span class="id" title="var">address</span> <span class="id" title="keyword">then</span> <span class="id" title="var">_</span> <span class="id" title="keyword">else</span> <span class="id" title="var">_</span> ],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H2</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">new_to_balance_eq</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">H2</span> <span class="id" title="var">to</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">H</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="tactic">try</span> <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">H</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>; <span class="id" title="var">lia</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">new_to_balance_eq</span> <span class="id" title="tactic">in</span> *]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;For&nbsp;any&nbsp;reachable&nbsp;state&nbsp;and&nbsp;an&nbsp;action&nbsp;it&nbsp;is&nbsp;decidable&nbsp;if&nbsp;it&nbsp;is<br/>
&nbsp;&nbsp;&nbsp;&nbsp;possible&nbsp;to&nbsp;evaluate&nbsp;the&nbsp;action&nbsp;in&nbsp;the&nbsp;state&nbsp;*)</span><br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
<span class="id" title="keyword">Lemma</span> <a id="action_evaluation_decidable" class="idref" href="#action_evaluation_decidable"><span class="id" title="lemma">action_evaluation_decidable</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:69" class="idref" href="#bstate:69"><span class="id" title="binder">bstate</span></a> <a id="act:70" class="idref" href="#act:70"><span class="id" title="binder">act</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:69"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Logic.Decidable.html#decidable"><span class="id" title="definition">decidable</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':71" class="idref" href="#bstate':71"><span class="id" title="binder">bstate'</span></a> <a id="new_acts:72" class="idref" href="#new_acts:72"><span class="id" title="binder">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#inhabited"><span class="id" title="inductive">inhabited</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:69"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act:70"><span class="id" title="variable">act</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':71"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:72"><span class="id" title="variable">new_acts</span></a>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">act</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Hact</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">act_body</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">destruct</span> (<span class="id" title="var">amount</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#a1c27bbd9f48118f287c317de583e02e"><span class="id" title="notation">&gt;=?</span></a> 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_positive</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">destruct</span> (<span class="id" title="var">amount</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#90a0b0fc12252358f48538aa18bc4b8e"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">act_from</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">balance</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_not_decidable</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.geb_leb"><span class="id" title="lemma">Z.geb_leb</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.leb_gt"><span class="id" title="lemma">Z.leb_gt</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">amount_positive</span> <span class="comment">(*&nbsp;Eliminate&nbsp;cases&nbsp;where&nbsp;amount&nbsp;is&nbsp;negative&nbsp;*)</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="id" title="var">action_not_decidable</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.leb_gt"><span class="id" title="lemma">Z.leb_gt</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">balance</span> ]); <span class="comment">(*&nbsp;Eliminate&nbsp;cases&nbsp;where&nbsp;sender&nbsp;does&nbsp;not&nbsp;have&nbsp;enough&nbsp;balance&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <span class="id" title="var">to</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">to_is_contract</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">to</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">to_contract</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">to</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">contract_state</span> |] |]);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="var">action_not_decidable</span>. <span class="comment">(*&nbsp;Eliminate&nbsp;cases&nbsp;with&nbsp;obvious&nbsp;contradictions&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">all</span> : <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.geb_leb"><span class="id" title="lemma">Z.geb_leb</span></a>, &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Zbool.html#Zge_is_le_bool"><span class="id" title="lemma">Zge_is_le_bool</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">amount_positive</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">all</span> : <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.leb_le"><span class="id" title="lemma">Z.leb_le</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">balance</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;act_body&nbsp;=&nbsp;act_transfer&nbsp;to&nbsp;amount&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">new_to_balance</span> := <span class="id" title="keyword">if</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">to</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">to</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">amount</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive"><span class="id" title="definition">wc_receive</span></a> <span class="id" title="var">w</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#build_ctx"><span class="id" title="constructor">build_ctx</span></a> <span class="id" title="var">act_origin</span> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span> <span class="id" title="var">new_to_balance</span> <span class="id" title="var">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>) <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Case:&nbsp;act_transfer&nbsp;is&nbsp;evaluable&nbsp;by&nbsp;eval_call&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<a class="idref" href="ConCert.Execution.Blockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <span class="id" title="var">to</span> <span class="id" title="var">s0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_decidable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Case:&nbsp;act_transfer&nbsp;is&nbsp;not&nbsp;evaluable&nbsp;by&nbsp;eval_call<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;because&nbsp;wc_receive&nbsp;returned&nbsp;None&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_not_decidable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_balance</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;act_body&nbsp;=&nbsp;act_transfer&nbsp;to&nbsp;amount&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Case:&nbsp;act_transfer&nbsp;is&nbsp;evaluable&nbsp;by&nbsp;eval_transfer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_decidable</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;act_body&nbsp;=&nbsp;act_call&nbsp;to&nbsp;amount&nbsp;msg&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">new_to_balance</span> := <span class="id" title="keyword">if</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">to</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">to</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">amount</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive"><span class="id" title="definition">wc_receive</span></a> <span class="id" title="var">w</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#build_ctx"><span class="id" title="constructor">build_ctx</span></a> <span class="id" title="var">act_origin</span> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span> <span class="id" title="var">new_to_balance</span> <span class="id" title="var">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">msg</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Case:&nbsp;act_call&nbsp;is&nbsp;evaluable&nbsp;by&nbsp;eval_call&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<a class="idref" href="ConCert.Execution.Blockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <span class="id" title="var">to</span> <span class="id" title="var">s0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_decidable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Case:&nbsp;act_call&nbsp;is&nbsp;not&nbsp;evaluable&nbsp;by&nbsp;eval_call<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;because&nbsp;wc_receive&nbsp;returned&nbsp;None&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_not_decidable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_balance</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;act_body&nbsp;=&nbsp;act_call&nbsp;to&nbsp;amount&nbsp;msg&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Case:&nbsp;contradiction&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_not_decidable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_addr_format"><span class="id" title="lemma">contract_addr_format</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;act_body&nbsp;=&nbsp;act_deploy&nbsp;amount&nbsp;c&nbsp;setup&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#deployable_address_decidable"><span class="id" title="axiom">deployable_address_decidable</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">wc</span> := <span class="id" title="var">c</span>) (<span class="id" title="var">setup</span> := <span class="id" title="var">setup</span>) (<span class="id" title="var">act_origin</span> := <span class="id" title="var">act_origin</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">act_from</span> := <span class="id" title="var">act_from</span>) (<span class="id" title="var">amount</span> := <span class="id" title="var">amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span> <span class="id" title="var">reach</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">reach</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">to</span> [<span class="id" title="var">state</span> [<span class="id" title="var">to_is_contract_addr</span> [<span class="id" title="var">to_not_deployed</span> <span class="id" title="var">init</span>]]]] | <span class="id" title="var">no_deployable_addr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Case:&nbsp;act_deploy&nbsp;is&nbsp;evaluable&nbsp;by&nbsp;eval_deploy&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<a class="idref" href="ConCert.Execution.Blockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <span class="id" title="var">to</span> <span class="id" title="var">state</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#add_contract"><span class="id" title="definition">add_contract</span></a> <span class="id" title="var">to</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">act_from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_decidable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Case:&nbsp;act_deploy&nbsp;is&nbsp;not&nbsp;evaluable&nbsp;by&nbsp;eval_deploy<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;because&nbsp;no&nbsp;there&nbsp;is&nbsp;no&nbsp;available&nbsp;contract&nbsp;address<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;this&nbsp;contract&nbsp;can&nbsp;be&nbsp;deployed&nbsp;to&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">action_not_decidable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">no_deployable_addr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Property&nbsp;stating&nbsp;that&nbsp;an&nbsp;action&nbsp;does&nbsp;not&nbsp;produce&nbsp;any&nbsp;new&nbsp;action&nbsp;when&nbsp;evaluated&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="produces_no_new_acts" class="idref" href="#produces_no_new_acts"><span class="id" title="definition">produces_no_new_acts</span></a> <a id="act:73" class="idref" href="#act:73"><span class="id" title="binder">act</span></a> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="bstate:74" class="idref" href="#bstate:74"><span class="id" title="binder">bstate</span></a> <a id="bstate':75" class="idref" href="#bstate':75"><span class="id" title="binder">bstate'</span></a> <a id="new_acts:76" class="idref" href="#new_acts:76"><span class="id" title="binder">new_acts</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:74"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act:73"><span class="id" title="variable">act</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':75"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:76"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:76"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;Property&nbsp;on&nbsp;a&nbsp;ChainState&nbsp;queue&nbsp;stating&nbsp;all&nbsp;actions&nbsp;are&nbsp;from&nbsp;accounts&nbsp;and&nbsp;produces<br/>
&nbsp;&nbsp;&nbsp;&nbsp;no&nbsp;new&nbsp;actions&nbsp;when&nbsp;evaluated.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;the&nbsp;queue&nbsp;can&nbsp;be&nbsp;emptied&nbsp;successfully&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="emptyable" class="idref" href="#emptyable"><span class="id" title="definition">emptyable</span></a> <a id="queue:77" class="idref" href="#queue:77"><span class="id" title="binder">queue</span></a> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_is_from_account"><span class="id" title="definition">act_is_from_account</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#queue:77"><span class="id" title="variable">queue</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#produces_no_new_acts"><span class="id" title="definition">produces_no_new_acts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#queue:77"><span class="id" title="variable">queue</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;An&nbsp;empty&nbsp;queue&nbsp;is&nbsp;always&nbsp;emptyable&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="empty_queue_is_emptyable" class="idref" href="#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a> : <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;A&nbsp;subset&nbsp;of&nbsp;a&nbsp;emptyable&nbsp;queu&nbsp;is&nbsp;also&nbsp;emptyable&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="emptyable_cons" class="idref" href="#emptyable_cons"><span class="id" title="lemma">emptyable_cons</span></a> : <span class="id" title="keyword">forall</span> <a id="x:78" class="idref" href="#x:78"><span class="id" title="binder">x</span></a> <a id="l:79" class="idref" href="#l:79"><span class="id" title="binder">l</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.BuildUtils.html#x:78"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#l:79"><span class="id" title="variable">l</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#l:79"><span class="id" title="variable">l</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * [<span class="id" title="var">acts_from_account</span> <span class="id" title="var">no_new_acts</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall_inv_tail"><span class="id" title="lemma">Forall_inv_tail</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">acts_from_account</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall_inv_tail"><span class="id" title="lemma">Forall_inv_tail</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">no_new_acts</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;For&nbsp;any&nbsp;reachable&nbsp;state&nbsp;it&nbsp;is&nbsp;possible&nbsp;to&nbsp;empty&nbsp;the&nbsp;chain_state_queue<br/>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;queue&nbsp;only&nbsp;contains&nbsp;action&nbsp;that&nbsp;satisfy&nbsp;the&nbsp;following<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1)&nbsp;the&nbsp;action&nbsp;is&nbsp;from&nbsp;a&nbsp;user&nbsp;and&nbsp;not&nbsp;a&nbsp;contract<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2)&nbsp;the&nbsp;action&nbsp;does&nbsp;not&nbsp;produce&nbsp;any&nbsp;actions&nbsp;when&nbsp;evaluated<br/>
&nbsp;&nbsp;&nbsp;For&nbsp;any&nbsp;property&nbsp;that&nbsp;holds&nbsp;on&nbsp;the&nbsp;starting&nbsp;state&nbsp;this&nbsp;also&nbsp;hold&nbsp;on<br/>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;state&nbsp;with&nbsp;an&nbsp;empty&nbsp;queue&nbsp;if&nbsp;it&nbsp;can&nbsp;be&nbsp;proven&nbsp;that&nbsp;the&nbsp;property<br/>
&nbsp;&nbsp;&nbsp;&nbsp;holds&nbsp;after&nbsp;evaluating&nbsp;any&nbsp;action.<br/>
*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="empty_queue" class="idref" href="#empty_queue"><span class="id" title="lemma">empty_queue</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:80" class="idref" href="#bstate:80"><span class="id" title="binder">bstate</span></a> (<a id="P:81" class="idref" href="#P:81"><span class="id" title="binder">P</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:80"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:80"><span class="id" title="variable">bstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#P:81"><span class="id" title="variable">P</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:80"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> (<a id="bstate:82" class="idref" href="#bstate:82"><span class="id" title="binder">bstate</span></a> <a id="bstate':83" class="idref" href="#bstate':83"><span class="id" title="binder">bstate'</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a>) <a id="act:84" class="idref" href="#act:84"><span class="id" title="binder">act</span></a> <a id="acts:85" class="idref" href="#acts:85"><span class="id" title="binder">acts</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:82"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':83"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#P:81"><span class="id" title="variable">P</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:82"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:82"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act:84"><span class="id" title="variable">act</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:85"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':83"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:85"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#inhabited"><span class="id" title="inductive">inhabited</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:82"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act:84"><span class="id" title="variable">act</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':83"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:82"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':83"><span class="id" title="variable">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#P:81"><span class="id" title="variable">P</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':83"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':86" class="idref" href="#bstate':86"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:80"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':86"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#P:81"><span class="id" title="variable">P</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':86"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':86"><span class="id" title="variable">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> [<span class="id" title="var">acts_from_account</span> <span class="id" title="var">no_new_acts</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <span class="id" title="var">bstate</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">queue</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">bstate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">queue</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">bstate</span> <span class="id" title="var">reach</span> <span class="id" title="var">Hqueue_eq</span> <span class="id" title="var">HP</span> <span class="id" title="var">HP_preserved</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case:&nbsp;queue&nbsp;is&nbsp;already&nbsp;empty,&nbsp;thus&nbsp;we&nbsp;are&nbsp;already&nbsp;done&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Case:&nbsp;queue&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;action,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thus&nbsp;we&nbsp;need&nbsp;to&nbsp;either&nbsp;discard&nbsp;or&nbsp;evaluate&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp/stdpp.list.html#Forall_cons_1"><span class="id" title="lemma">list.Forall_cons_1</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">acts_from_account</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">act_from_a</span> <span class="id" title="var">acts_from_account</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp/stdpp.list.html#Forall_cons_1"><span class="id" title="lemma">list.Forall_cons_1</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">no_new_acts</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">no_new_acts_from_a</span> <span class="id" title="var">no_new_acts</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">edestruct</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#action_evaluation_decidable"><span class="id" title="lemma">action_evaluation_decidable</span></a> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[<span class="id" title="var">mid_env</span> [<span class="id" title="var">new_acts</span> [<span class="id" title="var">action_evaluation</span>]]] | <span class="id" title="var">no_action_evaluation</span>]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Case:&nbsp;the&nbsp;action&nbsp;is&nbsp;evaluable&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#build_chain_state"><span class="id" title="constructor">build_chain_state</span></a> <span class="id" title="var">mid_env</span> (<span class="id" title="var">new_acts</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <span class="id" title="var">queue</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">mid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">step</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">mid</span>) <span class="id" title="tactic">by</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#step_action"><span class="id" title="constructor">step_action</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">no_new_acts_from_a</span> <span class="id" title="tactic">in</span> <span class="id" title="var">action_evaluation</span> <span class="id" title="keyword">as</span> <span class="id" title="var">new_acts_eq</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">HP_preserved</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">bstate'</span> := <span class="id" title="var">mid</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">HP</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHqueue</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HP</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">to</span> [<span class="id" title="var">reachable_through</span> [<span class="id" title="var">P_to</span> <span class="id" title="var">queue_to</span>]]]; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">exists</span> <span class="id" title="var">to</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Case:&nbsp;the&nbsp;action&nbsp;not&nbsp;is&nbsp;evaluable&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <span class="id" title="var">queue</span> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>) <span class="id" title="keyword">as</span> <span class="id" title="var">mid</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">step</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">mid</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#step_action_invalid"><span class="id" title="constructor">step_action_invalid</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">no_action_evaluation</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_step"><span class="id" title="lemma">reachable_step</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">step</span> <span class="id" title="keyword">as</span> <span class="id" title="var">reachable_mid</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHqueue</span> <span class="id" title="tactic">in</span> <span class="id" title="var">reachable_mid</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">to</span> [<span class="id" title="var">reachable_through</span> [<span class="id" title="var">P_to</span> <span class="id" title="var">queue_to</span>]]]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">to</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<span class="id" title="var">HP_preserved</span> <span class="id" title="var">bstate</span> <span class="id" title="var">mid</span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">right</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;wc_receive&nbsp;and&nbsp;contract&nbsp;receive&nbsp;are&nbsp;equivalent&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="wc_receive_to_receive" class="idref" href="#wc_receive_to_receive"><span class="id" title="lemma">wc_receive_to_receive</span></a> : <span class="id" title="keyword">forall</span> {<a id="Setup:87" class="idref" href="#Setup:87"><span class="id" title="binder">Setup</span></a> <a id="Msg:88" class="idref" href="#Msg:88"><span class="id" title="binder">Msg</span></a> <a id="State:89" class="idref" href="#State:89"><span class="id" title="binder">State</span></a> <a id="Error:90" class="idref" href="#Error:90"><span class="id" title="binder">Error</span></a> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H:91" class="idref" href="#H:91"><span class="id" title="binder">Serializable</span></a> <a id="H:91" class="idref" href="#H:91"><span class="id" title="binder">Setup</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H0:92" class="idref" href="#H0:92"><span class="id" title="binder">Serializable</span></a> <a id="H0:92" class="idref" href="#H0:92"><span class="id" title="binder">Msg</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H1:93" class="idref" href="#H1:93"><span class="id" title="binder">Serializable</span></a> <a id="H1:93" class="idref" href="#H1:93"><span class="id" title="binder">State</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H2:94" class="idref" href="#H2:94"><span class="id" title="binder">Serializable</span></a> <a id="H2:94" class="idref" href="#H2:94"><span class="id" title="binder">Error</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="contract:95" class="idref" href="#contract:95"><span class="id" title="binder">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Contract"><span class="id" title="record">Contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Setup:87"><span class="id" title="variable">Setup</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Msg:88"><span class="id" title="variable">Msg</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:89"><span class="id" title="variable">State</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Error:90"><span class="id" title="variable">Error</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="chain:96" class="idref" href="#chain:96"><span class="id" title="binder">chain</span></a> <a id="cctx:97" class="idref" href="#cctx:97"><span class="id" title="binder">cctx</span></a> <a id="cstate:98" class="idref" href="#cstate:98"><span class="id" title="binder">cstate</span></a> <a id="msg:99" class="idref" href="#msg:99"><span class="id" title="binder">msg</span></a> <a id="new_cstate:100" class="idref" href="#new_cstate:100"><span class="id" title="binder">new_cstate</span></a> <a id="new_acts:101" class="idref" href="#new_acts:101"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#contract:95"><span class="id" title="variable">contract</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#receive"><span class="id" title="projection">receive</span></a>) <a class="idref" href="ConCert.Execution.BuildUtils.html#chain:96"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#cctx:97"><span class="id" title="variable">cctx</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:98"><span class="id" title="variable">cstate</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#msg:99"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.BuildUtils.html#new_cstate:100"><span class="id" title="variable">new_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:101"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive"><span class="id" title="definition">wc_receive</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#contract:95"><span class="id" title="variable">contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#chain:96"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#cctx:97"><span class="id" title="variable">cctx</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:89"><span class="id" title="variable">State</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:98"><span class="id" title="variable">cstate</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Msg:88"><span class="id" title="variable">Msg</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#msg:99"><span class="id" title="variable">msg</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>(@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:89"><span class="id" title="variable">State</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#new_cstate:100"><span class="id" title="variable">new_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:101"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive_strong"><span class="id" title="lemma">wc_receive_strong</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prev_state'</span> &amp; <span class="id" title="var">msg'</span> &amp; <span class="id" title="var">new_state'</span> &amp; <span class="id" title="var">prev_state_eq</span> &amp; <span class="id" title="var">msg_eq</span> &amp; <span class="id" title="var">new_state_eq</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Serializable.html#serialize_injective"><span class="id" title="lemma">serialize_injective</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">new_state_eq</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">prev_state_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">prev_state_eq</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">msg'</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Hmsg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">msg_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">msg_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">msg_eq</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;wc_init&nbsp;and&nbsp;contract&nbsp;init&nbsp;are&nbsp;equivalent&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="wc_init_to_init" class="idref" href="#wc_init_to_init"><span class="id" title="lemma">wc_init_to_init</span></a> : <span class="id" title="keyword">forall</span> {<a id="Setup:102" class="idref" href="#Setup:102"><span class="id" title="binder">Setup</span></a> <a id="Msg:103" class="idref" href="#Msg:103"><span class="id" title="binder">Msg</span></a> <a id="State:104" class="idref" href="#State:104"><span class="id" title="binder">State</span></a> <a id="Error:105" class="idref" href="#Error:105"><span class="id" title="binder">Error</span></a> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H:106" class="idref" href="#H:106"><span class="id" title="binder">Serializable</span></a> <a id="H:106" class="idref" href="#H:106"><span class="id" title="binder">Setup</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H0:107" class="idref" href="#H0:107"><span class="id" title="binder">Serializable</span></a> <a id="H0:107" class="idref" href="#H0:107"><span class="id" title="binder">Msg</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H1:108" class="idref" href="#H1:108"><span class="id" title="binder">Serializable</span></a> <a id="H1:108" class="idref" href="#H1:108"><span class="id" title="binder">State</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H2:109" class="idref" href="#H2:109"><span class="id" title="binder">Serializable</span></a> <a id="H2:109" class="idref" href="#H2:109"><span class="id" title="binder">Error</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="contract:110" class="idref" href="#contract:110"><span class="id" title="binder">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Contract"><span class="id" title="record">Contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Setup:102"><span class="id" title="variable">Setup</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Msg:103"><span class="id" title="variable">Msg</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:104"><span class="id" title="variable">State</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Error:105"><span class="id" title="variable">Error</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="chain:111" class="idref" href="#chain:111"><span class="id" title="binder">chain</span></a> <a id="cctx:112" class="idref" href="#cctx:112"><span class="id" title="binder">cctx</span></a> <a id="cstate:113" class="idref" href="#cstate:113"><span class="id" title="binder">cstate</span></a> <a id="setup:114" class="idref" href="#setup:114"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#contract:110"><span class="id" title="variable">contract</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#init"><span class="id" title="projection">init</span></a>) <a class="idref" href="ConCert.Execution.BuildUtils.html#chain:111"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#cctx:112"><span class="id" title="variable">cctx</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#setup:114"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:113"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#wc_init"><span class="id" title="definition">wc_init</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#contract:110"><span class="id" title="variable">contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#chain:111"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#cctx:112"><span class="id" title="variable">cctx</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Setup:102"><span class="id" title="variable">Setup</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#setup:114"><span class="id" title="variable">setup</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:104"><span class="id" title="variable">State</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:113"><span class="id" title="variable">cstate</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_init_strong"><span class="id" title="lemma">wc_init_strong</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">setup_strong</span> &amp; <span class="id" title="var">result_strong</span> &amp; <span class="id" title="var">serialize_setup</span> &amp; <span class="id" title="var">serialize_result</span> &amp; <span class="id" title="var">init_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Serializable.html#serialize_injective"><span class="id" title="lemma">serialize_injective</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_result</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_setup</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">serialize_setup</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;showing&nbsp;that&nbsp;there&nbsp;exists&nbsp;a&nbsp;future&nbsp;ChainState&nbsp;with&nbsp;an&nbsp;added&nbsp;block&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="add_block" class="idref" href="#add_block"><span class="id" title="lemma">add_block</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:115" class="idref" href="#bstate:115"><span class="id" title="binder">bstate</span></a> <a id="reward:116" class="idref" href="#reward:116"><span class="id" title="binder">reward</span></a> <a id="creator:117" class="idref" href="#creator:117"><span class="id" title="binder">creator</span></a> <a id="acts:118" class="idref" href="#acts:118"><span class="id" title="binder">acts</span></a> <a id="slot_incr:119" class="idref" href="#slot_incr:119"><span class="id" title="binder">slot_incr</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:115"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:115"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#creator:117"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reward:116"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.BuildUtils.html#slot_incr:119"><span class="id" title="variable">slot_incr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&gt;'_x"><span class="id" title="notation">&gt;</span></a> 0)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_is_from_account"><span class="id" title="definition">act_is_from_account</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:118"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_origin_is_eq_from"><span class="id" title="definition">act_origin_is_eq_from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:118"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':120" class="idref" href="#bstate':120"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:115"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':120"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':120"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:118"><span class="id" title="variable">acts</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':120"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#add_new_block_to_env"><span class="id" title="definition">add_new_block_to_env</span></a> {| <a class="idref" href="ConCert.Execution.Blockchain.html#block_height"><span class="id" title="projection">block_height</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_height"><span class="id" title="projection">chain_height</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:115"><span class="id" title="variable">bstate</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#block_slot"><span class="id" title="projection">block_slot</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:115"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#slot_incr:119"><span class="id" title="variable">slot_incr</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#block_finalized_height"><span class="id" title="projection">block_finalized_height</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#finalized_height"><span class="id" title="projection">finalized_height</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:115"><span class="id" title="variable">bstate</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> := <a class="idref" href="ConCert.Execution.BuildUtils.html#creator:117"><span class="id" title="variable">creator</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#block_reward"><span class="id" title="projection">block_reward</span></a> := <a class="idref" href="ConCert.Execution.BuildUtils.html#reward:116"><span class="id" title="variable">reward</span></a>; |} <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:115"><span class="id" title="variable">bstate</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">queue</span> <span class="id" title="var">creator_not_contract</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reward_positive</span> <span class="id" title="var">slot_incr_positive</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acts_from_accounts</span> <span class="id" title="var">origins_from_accounts</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">header</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{| <a class="idref" href="ConCert.Execution.Blockchain.html#block_height"><span class="id" title="projection">block_height</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_height"><span class="id" title="projection">chain_height</span></a> <span class="id" title="var">bstate</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#block_slot"><span class="id" title="projection">block_slot</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <span class="id" title="var">slot_incr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#block_finalized_height"><span class="id" title="projection">block_finalized_height</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#finalized_height"><span class="id" title="projection">finalized_height</span></a> <span class="id" title="var">bstate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#block_creator"><span class="id" title="projection">block_creator</span></a> := <span class="id" title="var">creator</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#block_reward"><span class="id" title="projection">block_reward</span></a> := <span class="id" title="var">reward</span>; |}).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate_with_acts</span> := (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <span class="id" title="var">acts</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#add_new_block_to_env"><span class="id" title="definition">add_new_block_to_env</span></a> <span class="id" title="var">header</span> <span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">step_with_acts</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">bstate_with_acts</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#step_block"><span class="id" title="constructor">step_block</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>). <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#finalized_heigh_chain_height"><span class="id" title="lemma">finalized_heigh_chain_height</span></a>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">bstate_with_acts</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;showing&nbsp;that&nbsp;there&nbsp;exists&nbsp;a&nbsp;future&nbsp;ChainState&nbsp;with&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;same&nbsp;contract&nbsp;states&nbsp;where&nbsp;the&nbsp;current&nbsp;slot&nbsp;is&nbsp;&lt;slot&gt;&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="forward_time_exact" class="idref" href="#forward_time_exact"><span class="id" title="lemma">forward_time_exact</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:121" class="idref" href="#bstate:121"><span class="id" title="binder">bstate</span></a> <a id="reward:122" class="idref" href="#reward:122"><span class="id" title="binder">reward</span></a> <a id="creator:123" class="idref" href="#creator:123"><span class="id" title="binder">creator</span></a> <a id="slot:124" class="idref" href="#slot:124"><span class="id" title="binder">slot</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:121"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:121"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#creator:123"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reward:122"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:121"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#slot:124"><span class="id" title="variable">slot</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':125" class="idref" href="#bstate':125"><span class="id" title="binder">bstate'</span></a> <a id="header:126" class="idref" href="#header:126"><span class="id" title="binder">header</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:121"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':125"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#IsValidNextBlock"><span class="id" title="record">IsValidNextBlock</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#header:126"><span class="id" title="variable">header</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:121"><span class="id" title="variable">bstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="ConCert.Execution.BuildUtils.html#slot:124"><span class="id" title="variable">slot</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':125"><span class="id" title="variable">bstate'</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':125"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':125"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#add_new_block_to_env"><span class="id" title="definition">add_new_block_to_env</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#header:126"><span class="id" title="variable">header</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:121"><span class="id" title="variable">bstate</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">bstate</span> <span class="id" title="var">reward</span> <span class="id" title="var">creator</span> <span class="id" title="var">slot</span> <span class="id" title="var">reach</span> <span class="id" title="var">queue</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">creator_not_contract</span> <span class="id" title="var">reward_positive</span> <span class="id" title="var">slot_not_hit</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#add_block"><span class="id" title="lemma">add_block</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">slot_incr</span> := (<span class="id" title="var">slot</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate</span>)%<span class="id" title="var">nat</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">reach</span> <span class="id" title="keyword">as</span> <span class="id" title="var">new_block</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">new_block</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">bstate_with_act</span> [<span class="id" title="var">reach'</span> [<span class="id" title="var">queue'</span> <span class="id" title="var">env_eq</span>]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">try</span> <span class="id" title="tactic">split</span>; <span class="id" title="var">only</span> 9: <span class="id" title="tactic">apply</span> <span class="id" title="var">env_eq</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#finalized_heigh_chain_height"><span class="id" title="lemma">finalized_heigh_chain_height</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">rewrite_environment_equiv</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;showing&nbsp;that&nbsp;there&nbsp;exists&nbsp;a&nbsp;future&nbsp;ChainState&nbsp;with&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;same&nbsp;contract&nbsp;states&nbsp;where&nbsp;the&nbsp;current&nbsp;slot&nbsp;is&nbsp;at&nbsp;least&nbsp;&lt;slot&gt;&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="forward_time" class="idref" href="#forward_time"><span class="id" title="lemma">forward_time</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:127" class="idref" href="#bstate:127"><span class="id" title="binder">bstate</span></a> <a id="reward:128" class="idref" href="#reward:128"><span class="id" title="binder">reward</span></a> <a id="creator:129" class="idref" href="#creator:129"><span class="id" title="binder">creator</span></a> <a id="slot:130" class="idref" href="#slot:130"><span class="id" title="binder">slot</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:127"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:127"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#creator:129"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reward:128"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':131" class="idref" href="#bstate':131"><span class="id" title="binder">bstate'</span></a> <a id="header:132" class="idref" href="#header:132"><span class="id" title="binder">header</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:127"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':131"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#IsValidNextBlock"><span class="id" title="record">IsValidNextBlock</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#header:132"><span class="id" title="variable">header</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:127"><span class="id" title="variable">bstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="ConCert.Execution.BuildUtils.html#slot:130"><span class="id" title="variable">slot</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':131"><span class="id" title="variable">bstate'</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':131"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':131"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#add_new_block_to_env"><span class="id" title="definition">add_new_block_to_env</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#header:132"><span class="id" title="variable">header</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:127"><span class="id" title="variable">bstate</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">queue</span> <span class="id" title="var">creator_not_contract</span> <span class="id" title="var">reward_positive</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">slot</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate</span>)%<span class="id" title="var">nat</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">slot_hit</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#add_block"><span class="id" title="lemma">add_block</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">slot_incr</span> := 1%<span class="id" title="var">nat</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">reach</span> <span class="id" title="keyword">as</span> <span class="id" title="var">new_block</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">new_block</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">bstate_with_act</span> [<span class="id" title="var">reach'</span> [<span class="id" title="var">queue'</span> <span class="id" title="var">env_eq</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">try</span> <span class="id" title="tactic">split</span>; <span class="id" title="var">only</span> 9: <span class="id" title="tactic">apply</span> <span class="id" title="var">env_eq</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#finalized_heigh_chain_height"><span class="id" title="lemma">finalized_heigh_chain_height</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.Natural.Peano.NPeano.html#Nat.sub_0_le"><span class="id" title="lemma">NPeano.Nat.sub_0_le</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">slot_hit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#forward_time_exact"><span class="id" title="lemma">forward_time_exact</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">slot</span> := <span class="id" title="var">slot</span>) <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">bstate'</span> &amp; <span class="id" title="var">header</span> &amp; <span class="id" title="var">reach'</span> &amp; <span class="id" title="var">header_valid</span> &amp; <span class="id" title="var">slot_hit'</span> &amp; <span class="id" title="var">queue'</span> &amp; <span class="id" title="var">env_eq</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;showing&nbsp;that&nbsp;there&nbsp;exists&nbsp;a&nbsp;future&nbsp;ChainState<br/>
&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;the&nbsp;contract&nbsp;call&nbsp;is&nbsp;evaluated&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="evaluate_action" class="idref" href="#evaluate_action"><span class="id" title="lemma">evaluate_action</span></a> : <span class="id" title="keyword">forall</span> {<a id="Setup:133" class="idref" href="#Setup:133"><span class="id" title="binder">Setup</span></a> <a id="Msg:134" class="idref" href="#Msg:134"><span class="id" title="binder">Msg</span></a> <a id="State:135" class="idref" href="#State:135"><span class="id" title="binder">State</span></a> <a id="Error:136" class="idref" href="#Error:136"><span class="id" title="binder">Error</span></a> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H:137" class="idref" href="#H:137"><span class="id" title="binder">Serializable</span></a> <a id="H:137" class="idref" href="#H:137"><span class="id" title="binder">Setup</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H0:138" class="idref" href="#H0:138"><span class="id" title="binder">Serializable</span></a> <a id="H0:138" class="idref" href="#H0:138"><span class="id" title="binder">Msg</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H1:139" class="idref" href="#H1:139"><span class="id" title="binder">Serializable</span></a> <a id="H1:139" class="idref" href="#H1:139"><span class="id" title="binder">State</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H2:140" class="idref" href="#H2:140"><span class="id" title="binder">Serializable</span></a> <a id="H2:140" class="idref" href="#H2:140"><span class="id" title="binder">Error</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="contract:141" class="idref" href="#contract:141"><span class="id" title="binder">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Contract"><span class="id" title="record">Contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Setup:133"><span class="id" title="variable">Setup</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Msg:134"><span class="id" title="variable">Msg</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:135"><span class="id" title="variable">State</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Error:136"><span class="id" title="variable">Error</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="bstate:142" class="idref" href="#bstate:142"><span class="id" title="binder">bstate</span></a> <a id="origin:143" class="idref" href="#origin:143"><span class="id" title="binder">origin</span></a> <a id="from:144" class="idref" href="#from:144"><span class="id" title="binder">from</span></a> <a id="caddr:145" class="idref" href="#caddr:145"><span class="id" title="binder">caddr</span></a> <a id="amount:146" class="idref" href="#amount:146"><span class="id" title="binder">amount</span></a> <a id="msg:147" class="idref" href="#msg:147"><span class="id" title="binder">msg</span></a> <a id="acts:148" class="idref" href="#acts:148"><span class="id" title="binder">acts</span></a> <a id="new_acts:149" class="idref" href="#new_acts:149"><span class="id" title="binder">new_acts</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="cstate:150" class="idref" href="#cstate:150"><span class="id" title="binder">cstate</span></a> <a id="new_cstate:151" class="idref" href="#new_cstate:151"><span class="id" title="binder">new_cstate</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">{|</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_from"><span class="id" title="projection">act_from</span></a> := <a class="idref" href="ConCert.Execution.BuildUtils.html#from:144"><span class="id" title="variable">from</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_origin"><span class="id" title="projection">act_origin</span></a> := <a class="idref" href="ConCert.Execution.BuildUtils.html#origin:143"><span class="id" title="variable">origin</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_body"><span class="id" title="projection">act_body</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:146"><span class="id" title="variable">amount</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Msg:134"><span class="id" title="variable">Msg</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#msg:147"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">|}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:148"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#amount:146"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:144"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:146"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.BuildUtils.html#contract:141"><span class="id" title="variable">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:135"><span class="id" title="variable">State</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:150"><span class="id" title="variable">cstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#receive"><span class="id" title="projection">Blockchain.receive</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#contract:141"><span class="id" title="variable">contract</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:144"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:146"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#build_ctx"><span class="id" title="constructor">build_ctx</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#origin:143"><span class="id" title="variable">origin</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:144"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a> (<span class="id" title="keyword">if</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:144"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:146"><span class="id" title="variable">amount</span></a>) <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:146"><span class="id" title="variable">amount</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:150"><span class="id" title="variable">cstate</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#msg:147"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.BuildUtils.html#new_cstate:151"><span class="id" title="variable">new_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:149"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':152" class="idref" href="#bstate':152"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':152"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':152"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:135"><span class="id" title="variable">State</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#new_cstate:151"><span class="id" title="variable">new_cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':152"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#origin:143"><span class="id" title="variable">origin</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a>) <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:149"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:148"><span class="id" title="variable">acts</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':152"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:135"><span class="id" title="variable">State</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#new_cstate:151"><span class="id" title="variable">new_cstate</span></a>) (<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:144"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:145"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:146"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:142"><span class="id" title="variable">bstate</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">queue</span> <span class="id" title="var">amount_nonnegative</span> <span class="id" title="var">enough_balance</span>%<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.ge_le"><span class="id" title="lemma">Z.ge_le</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">deployed</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">new_to_balance</span> := <span class="id" title="keyword">if</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <span class="id" title="var">from</span> <span class="id" title="var">caddr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">amount</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#map"><span class="id" title="definition">map</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <span class="id" title="var">origin</span> <span class="id" title="var">caddr</span>) <span class="id" title="var">new_acts</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <span class="id" title="var">acts</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <span class="id" title="var">caddr</span> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <span class="id" title="var">State</span> <span class="id" title="var">_</span>) <span class="id" title="var">new_cstate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">from</span> <span class="id" title="var">caddr</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span>)<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">new_to_balance_eq</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate'</span> <span class="id" title="var">caddr</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">new_to_balance</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">step</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">bstate'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#step_action"><span class="id" title="constructor">step_action</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#eval_call"><span class="id" title="constructor">eval_call</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">msg</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <span class="id" title="var">Msg</span> <span class="id" title="var">_</span>) <span class="id" title="var">msg</span>)); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">new_to_balance_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc_receive_to_receive"><span class="id" title="lemma">wc_receive_to_receive</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exists</span> <span class="id" title="var">bstate'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;showing&nbsp;that&nbsp;there&nbsp;exists&nbsp;a&nbsp;future&nbsp;ChainState<br/>
&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;the&nbsp;transfer&nbsp;action&nbsp;is&nbsp;evaluated&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="evaluate_transfer" class="idref" href="#evaluate_transfer"><span class="id" title="lemma">evaluate_transfer</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:153" class="idref" href="#bstate:153"><span class="id" title="binder">bstate</span></a> <a id="origin:154" class="idref" href="#origin:154"><span class="id" title="binder">origin</span></a> <a id="from:155" class="idref" href="#from:155"><span class="id" title="binder">from</span></a> <a id="to:156" class="idref" href="#to:156"><span class="id" title="binder">to</span></a> <a id="amount:157" class="idref" href="#amount:157"><span class="id" title="binder">amount</span></a> <a id="acts:158" class="idref" href="#acts:158"><span class="id" title="binder">acts</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:153"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:153"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">{|</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_from"><span class="id" title="projection">act_from</span></a> := <a class="idref" href="ConCert.Execution.BuildUtils.html#from:155"><span class="id" title="variable">from</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_origin"><span class="id" title="projection">act_origin</span></a> := <a class="idref" href="ConCert.Execution.BuildUtils.html#origin:154"><span class="id" title="variable">origin</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_body"><span class="id" title="projection">act_body</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:156"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:157"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">|}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:158"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#amount:157"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:153"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:155"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:157"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:156"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':159" class="idref" href="#bstate':159"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:153"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':159"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':159"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:158"><span class="id" title="variable">acts</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':159"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:155"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:156"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:157"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:153"><span class="id" title="variable">bstate</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">queue</span> <span class="id" title="var">amount_nonnegative</span> <span class="id" title="var">enough_balance</span>%<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.ge_le"><span class="id" title="lemma">Z.ge_le</span></a> <span class="id" title="var">to_not_contract</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <span class="id" title="var">acts</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">step</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">bstate'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#step_action"><span class="id" title="constructor">step_action</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">new_acts</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#eval_transfer"><span class="id" title="constructor">eval_transfer</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span> <span class="id" title="var">bstate'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;showing&nbsp;that&nbsp;if&nbsp;an&nbsp;action&nbsp;in&nbsp;the&nbsp;queue&nbsp;is&nbsp;invalid&nbsp;then<br/>
&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;exists&nbsp;a&nbsp;future&nbsp;ChainState&nbsp;witht&nbsp;the&nbsp;same&nbsp;environment<br/>
&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;that&nbsp;action&nbsp;is&nbsp;discarded&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="discard_invalid_action" class="idref" href="#discard_invalid_action"><span class="id" title="lemma">discard_invalid_action</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:160" class="idref" href="#bstate:160"><span class="id" title="binder">bstate</span></a> <a id="act:161" class="idref" href="#act:161"><span class="id" title="binder">act</span></a> <a id="acts:162" class="idref" href="#acts:162"><span class="id" title="binder">acts</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:160"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:160"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act:161"><span class="id" title="variable">act</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:162"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_is_from_account"><span class="id" title="definition">act_is_from_account</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act:161"><span class="id" title="variable">act</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">forall</span> (<a id="bstate0:163" class="idref" href="#bstate0:163"><span class="id" title="binder">bstate0</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Environment"><span class="id" title="record">Environment</span></a>) (<a id="new_acts:164" class="idref" href="#new_acts:164"><span class="id" title="binder">new_acts</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Action"><span class="id" title="record">Action</span></a>), <a class="idref" href="ConCert.Execution.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:160"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#act:161"><span class="id" title="variable">act</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate0:163"><span class="id" title="variable">bstate0</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#new_acts:164"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':165" class="idref" href="#bstate':165"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:160"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':165"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':165"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:162"><span class="id" title="variable">acts</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':165"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:160"><span class="id" title="variable">bstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">queue</span> <span class="id" title="var">act_from_account</span> <span class="id" title="var">no_action_evaluation</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <span class="id" title="var">acts</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">step</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">bstate'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#step_action_invalid"><span class="id" title="constructor">step_action_invalid</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span> <span class="id" title="var">bstate'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;showing&nbsp;that&nbsp;for&nbsp;any&nbsp;permutation&nbsp;of&nbsp;the&nbsp;queue&nbsp;there<br/>
&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;a&nbsp;future&nbsp;ChainState&nbsp;witht&nbsp;the&nbsp;same&nbsp;environment<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;the&nbsp;queue&nbsp;permuted&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="permute_queue" class="idref" href="#permute_queue"><span class="id" title="lemma">permute_queue</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:166" class="idref" href="#bstate:166"><span class="id" title="binder">bstate</span></a> <a id="acts:167" class="idref" href="#acts:167"><span class="id" title="binder">acts</span></a> <a id="acts_permuted:168" class="idref" href="#acts_permuted:168"><span class="id" title="binder">acts_permuted</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:166"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:166"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:167"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation.Permutation</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:167"><span class="id" title="variable">acts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts_permuted:168"><span class="id" title="variable">acts_permuted</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':169" class="idref" href="#bstate':169"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:166"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':169"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':169"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts_permuted:168"><span class="id" title="variable">acts_permuted</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':169"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:166"><span class="id" title="variable">bstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">queue</span> <span class="id" title="var">perm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <span class="id" title="var">acts_permuted</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">step</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">bstate'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#step_permute"><span class="id" title="constructor">step_permute</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span> <span class="id" title="var">bstate'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;showing&nbsp;that&nbsp;there&nbsp;exists&nbsp;a&nbsp;future&nbsp;ChainState<br/>
&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;the&nbsp;contract&nbsp;is&nbsp;deployed&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <a id="deploy_contract" class="idref" href="#deploy_contract"><span class="id" title="lemma">deploy_contract</span></a> : <span class="id" title="keyword">forall</span> {<a id="Setup:170" class="idref" href="#Setup:170"><span class="id" title="binder">Setup</span></a> <a id="Msg:171" class="idref" href="#Msg:171"><span class="id" title="binder">Msg</span></a> <a id="State:172" class="idref" href="#State:172"><span class="id" title="binder">State</span></a> <a id="Error:173" class="idref" href="#Error:173"><span class="id" title="binder">Error</span></a> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H:174" class="idref" href="#H:174"><span class="id" title="binder">Serializable</span></a> <a id="H:174" class="idref" href="#H:174"><span class="id" title="binder">Setup</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H0:175" class="idref" href="#H0:175"><span class="id" title="binder">Serializable</span></a> <a id="H0:175" class="idref" href="#H0:175"><span class="id" title="binder">Msg</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H1:176" class="idref" href="#H1:176"><span class="id" title="binder">Serializable</span></a> <a id="H1:176" class="idref" href="#H1:176"><span class="id" title="binder">State</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="H2:177" class="idref" href="#H2:177"><span class="id" title="binder">Serializable</span></a> <a id="H2:177" class="idref" href="#H2:177"><span class="id" title="binder">Error</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="contract:178" class="idref" href="#contract:178"><span class="id" title="binder">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Contract"><span class="id" title="record">Contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Setup:170"><span class="id" title="variable">Setup</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Msg:171"><span class="id" title="variable">Msg</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:172"><span class="id" title="variable">State</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Error:173"><span class="id" title="variable">Error</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="bstate:179" class="idref" href="#bstate:179"><span class="id" title="binder">bstate</span></a> <a id="origin:180" class="idref" href="#origin:180"><span class="id" title="binder">origin</span></a> <a id="from:181" class="idref" href="#from:181"><span class="id" title="binder">from</span></a> <a id="caddr:182" class="idref" href="#caddr:182"><span class="id" title="binder">caddr</span></a> <a id="amount:183" class="idref" href="#amount:183"><span class="id" title="binder">amount</span></a> <a id="acts:184" class="idref" href="#acts:184"><span class="id" title="binder">acts</span></a> <a id="setup:185" class="idref" href="#setup:185"><span class="id" title="binder">setup</span></a> <a id="cstate:186" class="idref" href="#cstate:186"><span class="id" title="binder">cstate</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:179"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:179"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">{|</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#act_from"><span class="id" title="projection">act_from</span></a> := <a class="idref" href="ConCert.Execution.BuildUtils.html#from:181"><span class="id" title="variable">from</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_origin"><span class="id" title="projection">act_origin</span></a> := <a class="idref" href="ConCert.Execution.BuildUtils.html#origin:180"><span class="id" title="variable">origin</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_body"><span class="id" title="projection">act_body</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#act_deploy"><span class="id" title="constructor">act_deploy</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:183"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#contract:178"><span class="id" title="variable">contract</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Setup:170"><span class="id" title="variable">Setup</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#setup:185"><span class="id" title="variable">setup</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">|}</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:184"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#amount:183"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:179"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:181"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:183"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:179"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#init"><span class="id" title="projection">Blockchain.init</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#contract:178"><span class="id" title="variable">contract</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:181"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:183"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:179"><span class="id" title="variable">bstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#build_ctx"><span class="id" title="constructor">build_ctx</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#origin:180"><span class="id" title="variable">origin</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:181"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:183"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:183"><span class="id" title="variable">amount</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#setup:185"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:186"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':187" class="idref" href="#bstate':187"><span class="id" title="binder">bstate'</span></a> (<a id="trace:188" class="idref" href="#trace:188"><span class="id" title="binder">trace</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':187"><span class="id" title="variable">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:179"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':187"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':187"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.BuildUtils.html#contract:178"><span class="id" title="variable">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':187"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:172"><span class="id" title="variable">State</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:186"><span class="id" title="variable">cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#deployment_info"><span class="id" title="definition">deployment_info</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#Setup:170"><span class="id" title="variable">Setup</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#trace:188"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#build_deployment_info"><span class="id" title="constructor">build_deployment_info</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#origin:180"><span class="id" title="variable">origin</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:181"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:183"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#setup:185"><span class="id" title="variable">setup</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':187"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#acts:184"><span class="id" title="variable">acts</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':187"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#State:172"><span class="id" title="variable">State</span></a> <span class="id" title="var">_</span>) <a class="idref" href="ConCert.Execution.BuildUtils.html#cstate:186"><span class="id" title="variable">cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#add_contract"><span class="id" title="definition">add_contract</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#contract:178"><span class="id" title="variable">contract</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:181"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#caddr:182"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#amount:183"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate:179"><span class="id" title="variable">bstate</span></a>)))<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">queue</span> <span class="id" title="var">amount_nonnegative</span> <span class="id" title="var">enough_balance</span>%<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.ge_le"><span class="id" title="lemma">Z.ge_le</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">caddr_is_contract</span> <span class="id" title="var">not_deployed</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">bstate'</span> := (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <span class="id" title="var">acts</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#set_contract_state"><span class="id" title="definition">set_contract_state</span></a> <span class="id" title="var">caddr</span> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <span class="id" title="var">State</span> <span class="id" title="var">_</span>) <span class="id" title="var">cstate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#add_contract"><span class="id" title="definition">add_contract</span></a> <span class="id" title="var">caddr</span> <span class="id" title="var">contract</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#transfer_balance"><span class="id" title="definition">transfer_balance</span></a> <span class="id" title="var">from</span> <span class="id" title="var">caddr</span> <span class="id" title="var">amount</span> <span class="id" title="var">bstate</span>))<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">step</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainStep"><span class="id" title="inductive">ChainStep</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">bstate'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#step_action"><span class="id" title="constructor">step_action</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">new_acts</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#eval_deploy"><span class="id" title="constructor">eval_deploy</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc_init_to_init"><span class="id" title="lemma">wc_init_to_init</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exists</span> <span class="id" title="var">bstate'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">reach</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">trace</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<a class="idref" href="ConCert.Execution.ChainedList.html#snoc"><span class="id" title="constructor">ChainedList.snoc</span></a> <span class="id" title="var">trace</span> <span class="id" title="var">step</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="var">destruct_chain_step</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span> <span class="id" title="tactic">in</span> <span class="id" title="var">queue_prev</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">queue_prev</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">destruct_address_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">inversion</span> <span class="id" title="var">env_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">contracts_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contracts_eq</span> <span class="id" title="var">caddr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Blockchain.html#address_eq_refl"><span class="id" title="lemma">address_eq_refl</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#address_eq_ne"><span class="id" title="lemma">address_eq_ne</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">contracts_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">exfalso</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">no_eval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span> <span class="id" title="tactic">in</span> <span class="id" title="var">queue_prev</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">queue_prev</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#eval_deploy"><span class="id" title="constructor">eval_deploy</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc_init_to_init"><span class="id" title="lemma">wc_init_to_init</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">env_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">not_deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">not_deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a id="step_reachable_through_exists" class="idref" href="#step_reachable_through_exists"><span class="id" title="lemma">step_reachable_through_exists</span></a> : <span class="id" title="keyword">forall</span> <a id="from:189" class="idref" href="#from:189"><span class="id" title="binder">from</span></a> <a id="mid:190" class="idref" href="#mid:190"><span class="id" title="binder">mid</span></a> (<a id="P:191" class="idref" href="#P:191"><span class="id" title="binder">P</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:189"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#mid:190"><span class="id" title="variable">mid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="to:192" class="idref" href="#to:192"><span class="id" title="binder">to</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#mid:190"><span class="id" title="variable">mid</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:192"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#P:191"><span class="id" title="variable">P</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:192"><span class="id" title="variable">to</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="to:193" class="idref" href="#to:193"><span class="id" title="binder">to</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#from:189"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:193"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#P:191"><span class="id" title="variable">P</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#to:193"><span class="id" title="variable">to</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> [<span class="id" title="var">to</span> [<span class="id" title="var">reach_</span> <span class="id" title="var">HP</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">exists</span> <span class="id" title="var">to</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#BuildUtils"><span class="id" title="section">BuildUtils</span></a>.<br/>

<br/>
<span class="id" title="keyword">Global Hint Resolve</span> <span class="id" title="var">reachable_through_refl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_trans'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_reachable</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Global Hint Resolve</span> <span class="id" title="var">reachable_through_refl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_trans'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reachable_through_reachable</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">update_fix</span> <span class="id" title="var">term1</span> <span class="id" title="var">term2</span> <span class="id" title="var">H</span> <span class="id" title="var">H_orig</span> <span class="id" title="var">H'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="keyword">context</span> <span class="id" title="var">G</span> [ <span class="id" title="var">term1</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := <span class="id" title="keyword">context</span> <span class="id" title="var">G</span> [ <span class="id" title="var">term2</span> ] <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_fix</span> <span class="id" title="var">term1</span> <span class="id" title="var">term2</span> <span class="id" title="var">x</span> <span class="id" title="var">H_orig</span> <span class="id" title="var">H'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">h</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> <span class="id" title="var">H</span>; [<span class="id" title="var">H'</span> | <span class="id" title="tactic">clear</span> <span class="id" title="var">H_orig</span>; <span class="id" title="tactic">rename</span> <span class="id" title="var">h</span> <span class="id" title="var">into</span> <span class="id" title="var">H_orig</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Replaces&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;&lt;term1&gt;&nbsp;with&nbsp;&lt;term2&gt;&nbsp;in&nbsp;hypothesis&nbsp;&lt;H&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;tactic&nbsp;&lt;H'&gt;&nbsp;to&nbsp;prove&nbsp;the&nbsp;old&nbsp;hypothesis&nbsp;implies&nbsp;the&nbsp;updated&nbsp;*)</span><br/>
<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">update_</span> <span class="id" title="var">term1</span> <span class="id" title="var">term2</span> <span class="id" title="var">H</span> <span class="id" title="var">H'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="keyword">context</span> <span class="id" title="var">G</span> [ <span class="id" title="var">term1</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := <span class="id" title="keyword">context</span> <span class="id" title="var">G</span> [ <span class="id" title="var">term2</span> ] <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_fix</span> <span class="id" title="var">term1</span> <span class="id" title="var">term2</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span> <span class="id" title="var">H'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "update" <span class="id" title="keyword">constr</span>(<span class="id" title="var">t1</span>) "with" <span class="id" title="keyword">constr</span>(<span class="id" title="var">t2</span>) "in" <span class="id" title="var">hyp</span>(<span class="id" title="var">H</span>) := <span class="id" title="var">update_</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span> <span class="id" title="var">H</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">easy</span>)).<br/>
<span class="id" title="keyword">Tactic Notation</span> "update" <span class="id" title="keyword">constr</span>(<span class="id" title="var">t1</span>) "with" <span class="id" title="keyword">constr</span>(<span class="id" title="var">t2</span>) "in" <span class="id" title="var">hyp</span>(<span class="id" title="var">H</span>) "by" <span class="id" title="var">tactic</span>(<span class="id" title="var">G</span>) := <span class="id" title="var">update_</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span> <span class="id" title="var">H</span> <span class="id" title="var">G</span>.<br/>
<span class="id" title="keyword">Tactic Notation</span> "update" <span class="id" title="keyword">constr</span>(<span class="id" title="var">t2</span>) "in" <span class="id" title="var">hyp</span>(<span class="id" title="var">H</span>) := <span class="id" title="keyword">let</span> <span class="id" title="var">t1</span> := <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">update_</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span> <span class="id" title="var">H</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">easy</span>)).<br/>
<span class="id" title="keyword">Tactic Notation</span> "update" <span class="id" title="keyword">constr</span>(<span class="id" title="var">t2</span>) "in" <span class="id" title="var">hyp</span>(<span class="id" title="var">H</span>) "by" <span class="id" title="var">tactic</span>(<span class="id" title="var">G</span>) := <span class="id" title="keyword">let</span> <span class="id" title="var">t1</span> := <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">update_</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span> <span class="id" title="var">H</span> <span class="id" title="var">G</span>.<br/>

<br/>
<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">only_on_match</span> <span class="id" title="var">tac</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| |- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':195" class="idref" href="#bstate':195"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':194"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">tac</span><br/>
&nbsp;&nbsp;| |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">update_chainstate</span> <span class="id" title="var">bstate1</span> <span class="id" title="var">bstate2</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <span class="id" title="var">bstate1</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <span class="id" title="var">bstate1</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#IsValidNextBlock"><span class="id" title="record">IsValidNextBlock</span></a> <span class="id" title="var">_</span> <span class="id" title="var">bstate1</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>).(<a class="idref" href="ConCert.Execution.Blockchain.html#env_chain"><span class="id" title="projection">env_chain</span></a>) |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <span class="id" title="var">bstate1</span> <span class="id" title="var">bstate2</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <span class="id" title="var">bstate2</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <span class="id" title="var">bstate1</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>) <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> (<span class="id" title="var">now</span> <span class="id" title="var">rewrite_environment_equiv</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <span class="id" title="var">bstate1</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>) <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> (<span class="id" title="var">now</span> <span class="id" title="var">rewrite_environment_equiv</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="keyword">context</span> [ <span class="id" title="var">bstate1</span> ] |- <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">update</span> <span class="id" title="var">bstate1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">easy</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">only_on_match</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">progress</span> <span class="id" title="var">update_chainstate</span> <span class="id" title="var">bstate1</span> <span class="id" title="var">bstate2</span>).<br/>

<br/>
<span class="comment">(*&nbsp;Tactic&nbsp;for&nbsp;updating&nbsp;goal&nbsp;and&nbsp;all&nbsp;occurences&nbsp;of&nbsp;an&nbsp;old&nbsp;ChainState<br/>
&nbsp;&nbsp;&nbsp;&nbsp;after&nbsp;adding&nbsp;a&nbsp;future&nbsp;ChainState&nbsp;to&nbsp;the&nbsp;environment.&nbsp;*)</span><br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">update_all</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate1</span> ?<span class="id" title="var">bstate2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Henv_eq</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a> ?<span class="id" title="var">bstate2</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>) (<a class="idref" href="ConCert.Execution.Blockchain.html#add_new_block_to_env"><span class="id" title="definition">add_new_block_to_env</span></a> ?<span class="id" title="var">header</span> ?<span class="id" title="var">bstate1</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>)) |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate3:197" class="idref" href="#bstate3:197"><span class="id" title="binder">bstate3</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate1</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate3:196"><span class="id" title="variable">bstate3</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.BuildUtils.html#step_reachable_through_exists"><span class="id" title="lemma">step_reachable_through_exists</span></a> <span class="id" title="var">bstate1</span> <span class="id" title="var">bstate2</span>); <span class="id" title="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_chainstate</span> <span class="id" title="var">bstate1</span> <span class="id" title="var">bstate2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only_on_match</span> <span class="id" title="keyword">ltac</span>:(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">Henv_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">try</span> <span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">header</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">bstate1</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate1</span> ?<span class="id" title="var">bstate2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Henv_eq</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#EnvironmentEquiv"><span class="id" title="record">EnvironmentEquiv</span></a> ?<span class="id" title="var">bstate2</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>) <span class="id" title="var">_</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate3:199" class="idref" href="#bstate3:199"><span class="id" title="binder">bstate3</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate1</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate3:198"><span class="id" title="variable">bstate3</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.BuildUtils.html#step_reachable_through_exists"><span class="id" title="lemma">step_reachable_through_exists</span></a> <span class="id" title="var">bstate1</span> <span class="id" title="var">bstate2</span>); <span class="id" title="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_chainstate</span> <span class="id" title="var">bstate1</span> <span class="id" title="var">bstate2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only_on_match</span> <span class="id" title="keyword">ltac</span>:(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">Henv_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">bstate1</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate1</span> ?<span class="id" title="var">bstate2</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate3:201" class="idref" href="#bstate3:201"><span class="id" title="binder">bstate3</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate1</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate3:200"><span class="id" title="variable">bstate3</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.BuildUtils.html#step_reachable_through_exists"><span class="id" title="lemma">step_reachable_through_exists</span></a> <span class="id" title="var">bstate1</span> <span class="id" title="var">bstate2</span>); <span class="id" title="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <span class="id" title="var">bstate2</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">Hreach</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only_on_match</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">bstate1</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">forward_time</span> <span class="id" title="var">slot_</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_bstate</span> := <span class="id" title="tactic">fresh</span> "bstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_header</span> := <span class="id" title="tactic">fresh</span> "header" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_header_valid</span> := <span class="id" title="tactic">fresh</span> "header_valid" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_reach</span> := <span class="id" title="tactic">fresh</span> "reach" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_queue</span> := <span class="id" title="tactic">fresh</span> "queue" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_env_eq</span> := <span class="id" title="tactic">fresh</span> "env_eq" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_slot_hit</span> := <span class="id" title="tactic">fresh</span> "slot_hit" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hqueue</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> ?<span class="id" title="var">bstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> ?<span class="id" title="var">bstate</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':203" class="idref" href="#bstate':203"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':202"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Execution.BuildUtils.html#forward_time"><span class="id" title="lemma">forward_time</span></a> <span class="id" title="var">bstate</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">slot</span> := <span class="id" title="var">slot_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [<span class="id" title="var">new_bstate</span> [<span class="id" title="var">new_header</span> [<span class="id" title="var">new_reach</span> [<span class="id" title="var">new_header_valid</span> [<span class="id" title="var">new_slot_hit</span> [<span class="id" title="var">new_queue</span> <span class="id" title="var">new_env_eq</span>]]]]]]<br/>
  <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">forward_time_exact</span> <span class="id" title="var">slot_</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_bstate</span> := <span class="id" title="tactic">fresh</span> "bstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_header</span> := <span class="id" title="tactic">fresh</span> "header" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_header_valid</span> := <span class="id" title="tactic">fresh</span> "header_valid" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_reach</span> := <span class="id" title="tactic">fresh</span> "reach" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_queue</span> := <span class="id" title="tactic">fresh</span> "queue" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_env_eq</span> := <span class="id" title="tactic">fresh</span> "env_eq" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_slot_hit</span> := <span class="id" title="tactic">fresh</span> "slot_hit" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hqueue</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> ?<span class="id" title="var">bstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> ?<span class="id" title="var">bstate</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':205" class="idref" href="#bstate':205"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':204"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Execution.BuildUtils.html#forward_time_exact"><span class="id" title="lemma">forward_time_exact</span></a> <span class="id" title="var">bstate</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">slot</span> := <span class="id" title="var">slot_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [<span class="id" title="var">new_bstate</span> [<span class="id" title="var">new_header</span> [<span class="id" title="var">new_reach</span> [<span class="id" title="var">new_header_valid</span> [<span class="id" title="var">new_slot_hit</span> [<span class="id" title="var">new_queue</span> <span class="id" title="var">new_env_eq</span>]]]]]]<br/>
  <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">add_block</span> <span class="id" title="var">acts_</span> <span class="id" title="var">slot_</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_bstate</span> := <span class="id" title="tactic">fresh</span> "bstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_reach</span> := <span class="id" title="tactic">fresh</span> "reach" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_queue</span> := <span class="id" title="tactic">fresh</span> "queue" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_env_eq</span> := <span class="id" title="tactic">fresh</span> "env_eq" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hqueue</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> ?<span class="id" title="var">bstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> ?<span class="id" title="var">bstate</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':207" class="idref" href="#bstate':207"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':206"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#add_block"><span class="id" title="lemma">add_block</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">acts</span> := <span class="id" title="var">acts_</span>) (<span class="id" title="var">slot_incr</span> := <span class="id" title="var">slot_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [<span class="id" title="var">new_bstate</span> [<span class="id" title="var">new_reach</span> [<span class="id" title="var">new_queue</span> <span class="id" title="var">new_env_eq</span>]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Hreach</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">Hqueue</span>| | | | | |]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evaluate_action</span> <span class="id" title="var">contract_</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_bstate</span> := <span class="id" title="tactic">fresh</span> "bstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_reach</span> := <span class="id" title="tactic">fresh</span> "reach" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_deployed_state</span> := <span class="id" title="tactic">fresh</span> "deployed_state" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_queue</span> := <span class="id" title="tactic">fresh</span> "queue" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_env_eq</span> := <span class="id" title="tactic">fresh</span> "env_eq" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hqueue</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> ?<span class="id" title="var">bstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> ?<span class="id" title="var">bstate</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':209" class="idref" href="#bstate':209"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':208"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Execution.BuildUtils.html#evaluate_action"><span class="id" title="lemma">evaluate_action</span></a> <span class="id" title="var">contract_</span>) <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">new_bstate</span> [<span class="id" title="var">new_reach</span> [<span class="id" title="var">new_deployed_state</span> [<span class="id" title="var">new_queue</span> <span class="id" title="var">new_env_eq</span>]]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Hreach</span> | <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hqueue</span> | | | | | | ]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">evaluate_transfer</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_bstate</span> := <span class="id" title="tactic">fresh</span> "bstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_reach</span> := <span class="id" title="tactic">fresh</span> "reach" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_queue</span> := <span class="id" title="tactic">fresh</span> "queue" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_env_eq</span> := <span class="id" title="tactic">fresh</span> "env_eq" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hqueue</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> ?<span class="id" title="var">bstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> ?<span class="id" title="var">bstate</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':211" class="idref" href="#bstate':211"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':210"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#evaluate_transfer"><span class="id" title="lemma">evaluate_transfer</span></a> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">new_bstate</span> [<span class="id" title="var">new_reach</span> [<span class="id" title="var">new_queue</span> <span class="id" title="var">new_env_eq</span>]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Hreach</span> | <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hqueue</span> | | | | ]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">discard_invalid_action</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_bstate</span> := <span class="id" title="tactic">fresh</span> "bstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_reach</span> := <span class="id" title="tactic">fresh</span> "reach" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_queue</span> := <span class="id" title="tactic">fresh</span> "queue" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_env_eq</span> := <span class="id" title="tactic">fresh</span> "env_eq" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hqueue</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> ?<span class="id" title="var">bstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> ?<span class="id" title="var">bstate</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':213" class="idref" href="#bstate':213"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':212"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#discard_invalid_action"><span class="id" title="lemma">discard_invalid_action</span></a> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">new_bstate</span> [<span class="id" title="var">new_reach</span> [<span class="id" title="var">new_queue</span> <span class="id" title="var">new_env_eq</span>]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Hreach</span> | <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hqueue</span> | | | ]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">empty_queue</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_bstate</span> := <span class="id" title="tactic">fresh</span> "bstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_reach</span> := <span class="id" title="tactic">fresh</span> "reach" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_queue</span> := <span class="id" title="tactic">fresh</span> "queue" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">temp_H</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">temp_eval</span> := <span class="id" title="tactic">fresh</span> "eval" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hempty</span> : <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> ?<span class="id" title="var">bstate</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> ?<span class="id" title="var">bstate</span> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':215" class="idref" href="#bstate':215"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':214"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pattern</span> (<span class="id" title="var">bstate</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">H</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ?<span class="id" title="var">f</span> <span class="id" title="var">bstate</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue"><span class="id" title="lemma">empty_queue</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">f</span>) <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">new_bstate</span> [<span class="id" title="var">new_reach</span> [<span class="id" title="var">temp_H</span> <span class="id" title="var">new_queue</span>]]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Hreach</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">Hempty</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ?<span class="id" title="var">bstate_from</span> ?<span class="id" title="var">bstate_to</span> ?<span class="id" title="var">act</span> ?<span class="id" title="var">acts</span> ?<span class="id" title="var">reach_from</span> ?<span class="id" title="var">reach_to</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> ?<span class="id" title="var">queue_from</span> ?<span class="id" title="var">queue_to</span> [[<span class="id" title="var">temp_eval</span>] | ?<span class="id" title="var">env_eq</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 1: <span class="id" title="var">destruct_action_eval</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">rename</span> <span class="id" title="var">temp_H</span> <span class="id" title="var">into</span> <span class="id" title="var">H</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">deploy_contract</span> <span class="id" title="var">contract_</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_bstate</span> := <span class="id" title="tactic">fresh</span> "bstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_reach</span> := <span class="id" title="tactic">fresh</span> "reach" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_deployed_state</span> := <span class="id" title="tactic">fresh</span> "deployed_state" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_contract_deployed</span> := <span class="id" title="tactic">fresh</span> "contract_deployed" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_queue</span> := <span class="id" title="tactic">fresh</span> "queue" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_env_eq</span> := <span class="id" title="tactic">fresh</span> "env_eq" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_cstate</span> := <span class="id" title="tactic">fresh</span> "cstate" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">contract_not_deployed</span> := <span class="id" title="tactic">fresh</span> "trace" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">deploy_info</span> := <span class="id" title="tactic">fresh</span> "deploy_info" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Hqueue</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> ?<span class="id" title="var">bstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hreach</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> ?<span class="id" title="var">bstate</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Haddress</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> ?<span class="id" title="var">caddr</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hdeployed</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> ?<span class="id" title="var">bstate</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>) ?<span class="id" title="var">caddr</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> |-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':217" class="idref" href="#bstate':217"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> ?<span class="id" title="var">bstate</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#bstate':216"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Execution.BuildUtils.html#deploy_contract"><span class="id" title="lemma">deploy_contract</span></a> <span class="id" title="var">contract_</span>) <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">new_bstate</span> &amp; <span class="id" title="var">trace</span> &amp; <span class="id" title="var">new_reach</span> &amp; <span class="id" title="var">new_contract_deployed</span> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">new_deployed_state</span> &amp; <span class="id" title="var">deploy_info</span> &amp; <span class="id" title="var">new_queue</span> &amp; <span class="id" title="var">new_env_eq</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Hreach</span> | <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hqueue</span> | | |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Haddress</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">Hdeployed</span> | |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">Haddress</span> <span class="id" title="var">Hdeployed</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">new_deployed_state</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> ((@<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ?<span class="id" title="var">state</span>) =&gt; <span class="id" title="var">remember</span> <span class="id" title="var">state</span> <span class="id" title="keyword">as</span> <span class="id" title="var">new_cstate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="https://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a> and <a href="https://github.com/jgallen23/toc">TOC</a>
</div>
</div>
<script>
  const elements = document.getElementsByClassName("libtitle");
  while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
  }
  if (window.location.pathname.endsWith("/toc.html")) {
      const jstocDiv = document.getElementById("js-toc");
      jstocDiv.classList.remove("toc");
      jstocDiv.classList.add("jstoc-hidden");
      const jstocHeaderDiv = document.getElementById("js-toc-header");
      jstocHeaderDiv.classList.add("jstoc-hidden");
      const mainDiv = document.getElementById("main");
      mainDiv.classList.add("jstoc-hidden-main");
      const toggleDiv = document.getElementById("toggle-toc");
      toggleDiv.classList.add("jstoc-hidden");
  }
  console.log(window.location.pathname);
</script>
<script type="text/javascript" src="toc.js"></script>
</body>

</html>
