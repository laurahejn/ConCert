<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<link href="toc.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
      <span id="toggle-toc">Contents</span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="https://github.com/AU-COBRA/ConCert" target="_balnk">Project Page</a>
      <a href="index.html">Index</a>
      <a href="toc.html">Table of contents</a>
    </span>
</div>
  <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="js-toc" class="toc" data-toc="h1,h2,h3,h4" data-toc-container="doc" data-toc-offset="-40">
      <div id="js-toc-header" class="toc-header">Contents:</div>
    </div>
    <div id="main">
<h1 class="libtitle">Library ConCert.Examples.Escrow.tests.EscrowTests</h1>

<div class="code">
<span class="comment">(*&nbsp;QuickChick&nbsp;tests&nbsp;of&nbsp;the&nbsp;Escrow&nbsp;contract.&nbsp;The&nbsp;properties&nbsp;tested&nbsp;are:<br/>
&nbsp;&nbsp;&nbsp;-&nbsp;functional&nbsp;correctness&nbsp;(also&nbsp;proved&nbsp;in&nbsp;Escrow.v)<br/>
&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;next_step&nbsp;field&nbsp;satisfies&nbsp;a&nbsp;certain&nbsp;ordering&nbsp;(e.g.&nbsp;buyer_commit&nbsp;-&gt;&nbsp;buyer_confirm&nbsp;-&gt;&nbsp;withdrawals)<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.Automation.html#"><span class="id" title="library">Automation</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Blockchain.html#"><span class="id" title="library">Blockchain</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.ChainedList.html#"><span class="id" title="library">ChainedList</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.ResultMonad.html#"><span class="id" title="library">ResultMonad</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution.Test</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Test.QCTest.html#"><span class="id" title="library">QCTest</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.Escrow</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#"><span class="id" title="library">Escrow</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.Escrow</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#"><span class="id" title="library">EscrowCorrect</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.Escrow</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowPrinters.html#"><span class="id" title="library">EscrowPrinters</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.Escrow</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowGens.html#"><span class="id" title="library">EscrowGens</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.ZArith.html#"><span class="id" title="library">ZArith</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="TestSetup" class="idref" href="#TestSetup"><span class="id" title="section">TestSetup</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Fix&nbsp;seller&nbsp;and&nbsp;buyer&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="seller" class="idref" href="#seller"><span class="id" title="definition">seller</span></a> := <a class="idref" href="ConCert.Execution.Test.TestUtils.html#creator"><span class="id" title="definition">creator</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="buyer" class="idref" href="#buyer"><span class="id" title="definition">buyer</span></a> := <a class="idref" href="ConCert.Execution.Test.TestUtils.html#person_1"><span class="id" title="definition">person_1</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="escrow_setup" class="idref" href="#escrow_setup"><span class="id" title="definition">escrow_setup</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.Escrow.html#setup_buyer"><span class="id" title="projection">setup_buyer</span></a> := <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer"><span class="id" title="definition">buyer</span></a><br/>
&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="escrow_contract_addr" class="idref" href="#escrow_contract_addr"><span class="id" title="definition">escrow_contract_addr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> := <a class="idref" href="ConCert.Execution.Test.TestUtils.html#contract_base_addr"><span class="id" title="definition">contract_base_addr</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;initial&nbsp;blockchain&nbsp;with&nbsp;the&nbsp;escrow&nbsp;contract&nbsp;deployed,&nbsp;and&nbsp;with&nbsp;buyer&nbsp;balance&nbsp;=&nbsp;10&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="escrow_chain" class="idref" href="#escrow_chain"><span class="id" title="definition">escrow_chain</span></a> : <a class="idref" href="ConCert.Execution.Test.TestUtils.html#ChainBuilder"><span class="id" title="instance">ChainBuilder</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#unpack_result"><span class="id" title="definition">unpack_result</span></a> (<a class="idref" href="ConCert.Execution.Test.TraceGens.html#add_block"><span class="id" title="definition">TraceGens.add_block</span></a> <a class="idref" href="ConCert.Execution.Test.TestUtils.html#empty_chain"><span class="id" title="definition">empty_chain</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Test.TestUtils.html#build_transfer"><span class="id" title="definition">build_transfer</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#seller"><span class="id" title="definition">seller</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer"><span class="id" title="definition">buyer</span></a> 10<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Test.TestUtils.html#build_deploy"><span class="id" title="definition">build_deploy</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#seller"><span class="id" title="definition">seller</span></a> 2 <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#contract"><span class="id" title="definition">Escrow.contract</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_setup"><span class="id" title="definition">escrow_setup</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>).<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#TestSetup"><span class="id" title="section">TestSetup</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;To&nbsp;instantiate&nbsp;the&nbsp;EscrowGen&nbsp;module&nbsp;functor,&nbsp;we&nbsp;need&nbsp;to&nbsp;supply<br/>
&nbsp;&nbsp;&nbsp;&nbsp;an&nbsp;EscrowGensInfo&nbsp;module.&nbsp;*)</span><br/>
<span class="id" title="keyword">Module</span> <a id="TestInfo" class="idref" href="#TestInfo"><span class="id" title="module">TestInfo</span></a> &lt;: <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowGens.html#EscrowGensInfo"><span class="id" title="module">EscrowGensInfo</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="TestInfo.contract_addr" class="idref" href="#TestInfo.contract_addr"><span class="id" title="definition">contract_addr</span></a> := <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_contract_addr"><span class="id" title="definition">escrow_contract_addr</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#TestInfo"><span class="id" title="module">TestInfo</span></a>.<br/>
<span class="id" title="keyword">Module</span> <a id="MG" class="idref" href="#MG"><span class="id" title="module">MG</span></a> := <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowGens.html#EscrowGens"><span class="id" title="module">EscrowGens.EscrowGens</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#TestInfo"><span class="id" title="module">TestInfo</span></a>. <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#MG"><span class="id" title="module">MG</span></a>.<br/>
<span class="id" title="keyword">Section</span> <a id="TestGenInstances" class="idref" href="#TestGenInstances"><span class="id" title="section">TestGenInstances</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;automation&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="gEscrowChainBuilder" class="idref" href="#gEscrowChainBuilder"><span class="id" title="instance">gEscrowChainBuilder</span></a> : <span class="id" title="class">GenSized</span> <a class="idref" href="ConCert.Execution.Test.TestUtils.html#ChainBuilder"><span class="id" title="instance">ChainBuilder</span></a> :=<br/>
&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="method">arbitrarySized</span> := <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#gEscrowTraceBetter"><span class="id" title="definition">gEscrowTraceBetter</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_chain"><span class="id" title="definition">escrow_chain</span></a><br/>
&nbsp;&nbsp;|}.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#TestGenInstances"><span class="id" title="section">TestGenInstances</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a id="TestProperties" class="idref" href="#TestProperties"><span class="id" title="section">TestProperties</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;is&nbsp;the&nbsp;proposition&nbsp;we&nbsp;wish&nbsp;to&nbsp;test,&nbsp;but&nbsp;QuickChick&nbsp;cannot&nbsp;test&nbsp;arbitrary&nbsp;Props&nbsp;since&nbsp;they&nbsp;are&nbsp;not<br/>
&nbsp;&nbsp;&nbsp;&nbsp;decidable&nbsp;in&nbsp;general.&nbsp;Therefore,&nbsp;we&nbsp;define&nbsp;a&nbsp;boolean&nbsp;version,&nbsp;escrow_correct_bool,&nbsp;below&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;show&nbsp;that&nbsp;it&nbsp;implies&nbsp;escrow_correct_Prop.&nbsp;We&nbsp;then&nbsp;test&nbsp;on&nbsp;escrow_correct_bool&nbsp;instead.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;alternative&nbsp;approach&nbsp;is&nbsp;to&nbsp;prove&nbsp;that&nbsp;escrow_correct_Prop&nbsp;is&nbsp;decidable,&nbsp;since&nbsp;QuickChick&nbsp;can&nbsp;test&nbsp;any<br/>
&nbsp;&nbsp;&nbsp;&nbsp;decidable&nbsp;proposition&nbsp;(by&nbsp;coercing&nbsp;it&nbsp;to&nbsp;a&nbsp;bool)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="escrow_correct_Prop" class="idref" href="#escrow_correct_Prop"><span class="id" title="definition">escrow_correct_Prop</span></a> {<a id="from:1" class="idref" href="#from:1"><span class="id" title="binder">from</span></a> <a id="to:2" class="idref" href="#to:2"><span class="id" title="binder">to</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="caddr:3" class="idref" href="#caddr:3"><span class="id" title="binder">caddr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="cstate:4" class="idref" href="#cstate:4"><span class="id" title="binder">cstate</span></a> : <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#State"><span class="id" title="record">Escrow.State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="trace:5" class="idref" href="#trace:5"><span class="id" title="binder">trace</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#from:1"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:2"><span class="id" title="variable">to</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="depinfo:6" class="idref" href="#depinfo:6"><span class="id" title="binder">depinfo</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#DeploymentInfo"><span class="id" title="record">DeploymentInfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#Setup"><span class="id" title="record">Setup</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="inc_calls:7" class="idref" href="#inc_calls:7"><span class="id" title="binder">inc_calls</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallInfo"><span class="id" title="record">ContractCallInfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#Msg"><span class="id" title="inductive">Msg</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="item_worth:8" class="idref" href="#item_worth:8"><span class="id" title="binder">item_worth</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#deployment_amount"><span class="id" title="projection">deployment_amount</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:6"><span class="id" title="variable">depinfo</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#d3c2652250c7a120d67ccc0e8f58ae75"><span class="id" title="notation">/</span></a> 2 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="seller:9" class="idref" href="#seller:9"><span class="id" title="binder">seller</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#deployment_from"><span class="id" title="projection">deployment_from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:6"><span class="id" title="variable">depinfo</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="buyer:10" class="idref" href="#buyer:10"><span class="id" title="binder">buyer</span></a> := <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#setup_buyer"><span class="id" title="projection">setup_buyer</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_setup"><span class="id" title="projection">deployment_setup</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:6"><span class="id" title="variable">depinfo</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#is_escrow_finished"><span class="id" title="definition">is_escrow_finished</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cstate:4"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#buyer_confirmed"><span class="id" title="definition">buyer_confirmed</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:7"><span class="id" title="variable">inc_calls</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer:10"><span class="id" title="variable">buyer</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#net_balance_effect"><span class="id" title="definition">net_balance_effect</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:5"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:3"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#seller:9"><span class="id" title="variable">seller</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#item_worth:8"><span class="id" title="variable">item_worth</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#net_balance_effect"><span class="id" title="definition">net_balance_effect</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:5"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:3"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer:10"><span class="id" title="variable">buyer</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#::Z_scope:'-'_x"><span class="id" title="notation">-</span></a><a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#item_worth:8"><span class="id" title="variable">item_worth</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#buyer_confirmed"><span class="id" title="definition">buyer_confirmed</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:7"><span class="id" title="variable">inc_calls</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer:10"><span class="id" title="variable">buyer</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#net_balance_effect"><span class="id" title="definition">net_balance_effect</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:5"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:3"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#seller:9"><span class="id" title="variable">seller</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#net_balance_effect"><span class="id" title="definition">net_balance_effect</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:5"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:3"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer:10"><span class="id" title="variable">buyer</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;bool&nbsp;version&nbsp;of&nbsp;escrow_correct_Prop&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="escrow_correct_bool" class="idref" href="#escrow_correct_bool"><span class="id" title="definition">escrow_correct_bool</span></a> {<a id="from:11" class="idref" href="#from:11"><span class="id" title="binder">from</span></a> <a id="to:12" class="idref" href="#to:12"><span class="id" title="binder">to</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="caddr:13" class="idref" href="#caddr:13"><span class="id" title="binder">caddr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="cstate:14" class="idref" href="#cstate:14"><span class="id" title="binder">cstate</span></a> : <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#State"><span class="id" title="record">Escrow.State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="trace:15" class="idref" href="#trace:15"><span class="id" title="binder">trace</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#from:11"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:12"><span class="id" title="variable">to</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="depinfo:16" class="idref" href="#depinfo:16"><span class="id" title="binder">depinfo</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#DeploymentInfo"><span class="id" title="record">DeploymentInfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#Setup"><span class="id" title="record">Setup</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="inc_calls:17" class="idref" href="#inc_calls:17"><span class="id" title="binder">inc_calls</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallInfo"><span class="id" title="record">ContractCallInfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#Msg"><span class="id" title="inductive">Msg</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="item_worth:18" class="idref" href="#item_worth:18"><span class="id" title="binder">item_worth</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#deployment_amount"><span class="id" title="projection">deployment_amount</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:16"><span class="id" title="variable">depinfo</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#d3c2652250c7a120d67ccc0e8f58ae75"><span class="id" title="notation">/</span></a> 2 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="seller:19" class="idref" href="#seller:19"><span class="id" title="binder">seller</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#deployment_from"><span class="id" title="projection">deployment_from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:16"><span class="id" title="variable">depinfo</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="buyer:20" class="idref" href="#buyer:20"><span class="id" title="binder">buyer</span></a> := <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#setup_buyer"><span class="id" title="projection">setup_buyer</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_setup"><span class="id" title="projection">deployment_setup</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:16"><span class="id" title="variable">depinfo</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#is_escrow_finished"><span class="id" title="definition">is_escrow_finished</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cstate:14"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> (<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#buyer_confirmed"><span class="id" title="definition">buyer_confirmed</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:17"><span class="id" title="variable">inc_calls</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer:20"><span class="id" title="variable">buyer</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">((</span></a><a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#net_balance_effect"><span class="id" title="definition">net_balance_effect</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:15"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:13"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#seller:19"><span class="id" title="variable">seller</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#f10153ef1a81fe79ed16d848b456c79b"><span class="id" title="notation">=?</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#item_worth:18"><span class="id" title="variable">item_worth</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#net_balance_effect"><span class="id" title="definition">net_balance_effect</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:15"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:13"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer:20"><span class="id" title="variable">buyer</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#f10153ef1a81fe79ed16d848b456c79b"><span class="id" title="notation">=?</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#::Z_scope:'-'_x"><span class="id" title="notation">-</span></a><a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#item_worth:18"><span class="id" title="variable">item_worth</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">))</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#buyer_confirmed"><span class="id" title="definition">buyer_confirmed</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:17"><span class="id" title="variable">inc_calls</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer:20"><span class="id" title="variable">buyer</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">((</span></a><a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#net_balance_effect"><span class="id" title="definition">net_balance_effect</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:15"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:13"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#seller:19"><span class="id" title="variable">seller</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#f10153ef1a81fe79ed16d848b456c79b"><span class="id" title="notation">=?</span></a> 0<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#net_balance_effect"><span class="id" title="definition">net_balance_effect</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:15"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:13"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#buyer:20"><span class="id" title="variable">buyer</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#f10153ef1a81fe79ed16d848b456c79b"><span class="id" title="notation">=?</span></a> 0<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::bool_scope:x_'&amp;&amp;'_x"><span class="id" title="notation">))</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;show&nbsp;that&nbsp;the&nbsp;bool&nbsp;version&nbsp;implies&nbsp;the&nbsp;propositional&nbsp;version<br/>
&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;correctness&nbsp;property.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="escrow_correct_bool_refl_prop" class="idref" href="#escrow_correct_bool_refl_prop"><span class="id" title="lemma">escrow_correct_bool_refl_prop</span></a> {<a id="from:21" class="idref" href="#from:21"><span class="id" title="binder">from</span></a> <a id="to:22" class="idref" href="#to:22"><span class="id" title="binder">to</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="caddr:23" class="idref" href="#caddr:23"><span class="id" title="binder">caddr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="cstate:24" class="idref" href="#cstate:24"><span class="id" title="binder">cstate</span></a> : <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#State"><span class="id" title="record">Escrow.State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="trace:25" class="idref" href="#trace:25"><span class="id" title="binder">trace</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#from:21"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:22"><span class="id" title="variable">to</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="depinfo:26" class="idref" href="#depinfo:26"><span class="id" title="binder">depinfo</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#DeploymentInfo"><span class="id" title="record">DeploymentInfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#Setup"><span class="id" title="record">Setup</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="inc_calls:27" class="idref" href="#inc_calls:27"><span class="id" title="binder">inc_calls</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallInfo"><span class="id" title="record">ContractCallInfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#Msg"><span class="id" title="inductive">Msg</span></a>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_bool"><span class="id" title="definition">escrow_correct_bool</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:23"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cstate:24"><span class="id" title="variable">cstate</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:25"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:26"><span class="id" title="variable">depinfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:27"><span class="id" title="variable">inc_calls</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_Prop"><span class="id" title="definition">escrow_correct_Prop</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:23"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cstate:24"><span class="id" title="variable">cstate</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:25"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:26"><span class="id" title="variable">depinfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:27"><span class="id" title="variable">inc_calls</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_bool"><span class="id" title="definition">escrow_correct_bool</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#is_escrow_finished"><span class="id" title="definition">is_escrow_finished</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_Prop"><span class="id" title="definition">escrow_correct_Prop</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">propify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_Prop"><span class="id" title="definition">escrow_correct_Prop</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#is_escrow_finished"><span class="id" title="definition">is_escrow_finished</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_Prop"><span class="id" title="definition">escrow_correct_Prop</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">propify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.eqb_eq"><span class="id" title="lemma">Z.eqb_eq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Finally,&nbsp;we&nbsp;can&nbsp;show&nbsp;that&nbsp;escrow_correct_Prop&nbsp;is&nbsp;decidable&nbsp;(using&nbsp;escrow_correct_bool&nbsp;as<br/>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;decision&nbsp;procedure).&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="escrow_correct_P_dec" class="idref" href="#escrow_correct_P_dec"><span class="id" title="instance">escrow_correct_P_dec</span></a> {<a id="from:28" class="idref" href="#from:28"><span class="id" title="binder">from</span></a> <a id="to:29" class="idref" href="#to:29"><span class="id" title="binder">to</span></a> <a id="caddr:30" class="idref" href="#caddr:30"><span class="id" title="binder">caddr</span></a> <a id="cstate:31" class="idref" href="#cstate:31"><span class="id" title="binder">cstate</span></a> <a id="trace:32" class="idref" href="#trace:32"><span class="id" title="binder">trace</span></a> <a id="depinfo:33" class="idref" href="#depinfo:33"><span class="id" title="binder">depinfo</span></a> <a id="inc_calls:34" class="idref" href="#inc_calls:34"><span class="id" title="binder">inc_calls</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="class">Dec</span> (@<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_Prop"><span class="id" title="definition">escrow_correct_Prop</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#from:28"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:29"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:30"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cstate:31"><span class="id" title="variable">cstate</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:32"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:33"><span class="id" title="variable">depinfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:34"><span class="id" title="variable">inc_calls</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ssr.ssrbool.html#decidable"><span class="id" title="definition">ssrbool.decidable</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_bool"><span class="id" title="definition">escrow_correct_bool</span></a> <span class="id" title="var">caddr</span> <span class="id" title="var">cstate</span> <span class="id" title="var">trace</span> <span class="id" title="var">depinfo</span> <span class="id" title="var">inc_calls</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_bool_refl_prop"><span class="id" title="lemma">escrow_correct_bool_refl_prop</span></a>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#not"><span class="id" title="definition">not</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_bool_refl_prop"><span class="id" title="lemma">escrow_correct_bool_refl_prop</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a id="escrow_correct_P_checkable" class="idref" href="#escrow_correct_P_checkable"><span class="id" title="instance">escrow_correct_P_checkable</span></a> {<a id="from:35" class="idref" href="#from:35"><span class="id" title="binder">from</span></a> <a id="to:36" class="idref" href="#to:36"><span class="id" title="binder">to</span></a> <a id="caddr:37" class="idref" href="#caddr:37"><span class="id" title="binder">caddr</span></a> <a id="cstate:38" class="idref" href="#cstate:38"><span class="id" title="binder">cstate</span></a> <a id="trace:39" class="idref" href="#trace:39"><span class="id" title="binder">trace</span></a> <a id="depinfo:40" class="idref" href="#depinfo:40"><span class="id" title="binder">depinfo</span></a> <a id="inc_calls:41" class="idref" href="#inc_calls:41"><span class="id" title="binder">inc_calls</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="class">Checkable</span> (@<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_Prop"><span class="id" title="definition">escrow_correct_Prop</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#from:35"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:36"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#caddr:37"><span class="id" title="variable">caddr</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cstate:38"><span class="id" title="variable">cstate</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:39"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:40"><span class="id" title="variable">depinfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:41"><span class="id" title="variable">inc_calls</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="instance">testDec</span>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <a id="2e4af7dbc9b7c5f9bce0361ce1c78054" class="idref" href="#2e4af7dbc9b7c5f9bce0361ce1c78054"><span class="id" title="notation">&quot;</span></a>a ===&gt; f" := (<a class="idref" href="ConCert.Execution.Test.TestUtils.html#isSomeCheck"><span class="id" title="definition">isSomeCheck</span></a> <span class="id" title="var">a</span> <span class="id" title="var">f</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 44).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Wrapper&nbsp;for&nbsp;escrow_correct_bool.&nbsp;This&nbsp;is&nbsp;the&nbsp;Checker&nbsp;we&nbsp;will&nbsp;run&nbsp;QC&nbsp;on.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="escrow_correct_P" class="idref" href="#escrow_correct_P"><span class="id" title="definition">escrow_correct_P</span></a> (<a id="cb:42" class="idref" href="#cb:42"><span class="id" title="binder">cb</span></a> : <a class="idref" href="ConCert.Execution.Test.TestUtils.html#ChainBuilder"><span class="id" title="instance">ChainBuilder</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="trace:43" class="idref" href="#trace:43"><span class="id" title="binder">trace</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#builder_trace"><span class="id" title="method">builder_trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cb:42"><span class="id" title="variable">cb</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="depinfo':44" class="idref" href="#depinfo':44"><span class="id" title="binder">depinfo'</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#deployment_info"><span class="id" title="definition">deployment_info</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#Setup"><span class="id" title="record">Escrow.Setup</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:43"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_contract_addr"><span class="id" title="definition">escrow_contract_addr</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="inc_calls':45" class="idref" href="#inc_calls':45"><span class="id" title="binder">inc_calls'</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#incoming_calls"><span class="id" title="definition">incoming_calls</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#Msg"><span class="id" title="inductive">Escrow.Msg</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:43"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_contract_addr"><span class="id" title="definition">escrow_contract_addr</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo':44"><span class="id" title="variable">depinfo'</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#2e4af7dbc9b7c5f9bce0361ce1c78054"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#2e4af7dbc9b7c5f9bce0361ce1c78054"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="depinfo:46" class="idref" href="#depinfo:46"><span class="id" title="binder">depinfo</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls':45"><span class="id" title="variable">inc_calls'</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#2e4af7dbc9b7c5f9bce0361ce1c78054"><span class="id" title="notation">===&gt;</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#2e4af7dbc9b7c5f9bce0361ce1c78054"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="inc_calls:47" class="idref" href="#inc_calls:47"><span class="id" title="binder">inc_calls</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Execution.Test.TestUtils.html#get_contract_state"><span class="id" title="definition">get_contract_state</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#State"><span class="id" title="record">Escrow.State</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cb:42"><span class="id" title="variable">cb</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_contract_addr"><span class="id" title="definition">escrow_contract_addr</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;main&nbsp;part&nbsp;of&nbsp;the&nbsp;property:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">cstate</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.EscrowCorrect.html#is_escrow_finished"><span class="id" title="definition">is_escrow_finished</span></a> <span class="id" title="var">cstate</span> <span class="id" title="notation">==&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span><span class="id" title="notation">(</span><a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_correct_Prop"><span class="id" title="definition">escrow_correct_Prop</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_contract_addr"><span class="id" title="definition">escrow_contract_addr</span></a> <span class="id" title="var">cstate</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:43"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#depinfo:46"><span class="id" title="variable">depinfo</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#inc_calls:47"><span class="id" title="variable">inc_calls</span></a><span class="id" title="notation">)?</span><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <span class="id" title="method">checker</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#2e4af7dbc9b7c5f9bce0361ce1c78054"><span class="id" title="notation">))</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;derive&nbsp;decidable&nbsp;equality&nbsp;on&nbsp;NextStep&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Scheme</span> <span class="id" title="var">Equality</span> <span class="id" title="keyword">for</span> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#NextStep"><span class="id" title="inductive">NextStep</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <a id="nextstep_dec_eq" class="idref" href="#nextstep_dec_eq"><span class="id" title="instance">nextstep_dec_eq</span></a> : <span class="id" title="class">Dec_Eq</span> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#NextStep"><span class="id" title="inductive">NextStep</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#NextStep_eq_dec"><span class="id" title="definition">NextStep_eq_dec</span></a>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="escrow_next_states" class="idref" href="#escrow_next_states"><span class="id" title="definition">escrow_next_states</span></a> {<a id="from:48" class="idref" href="#from:48"><span class="id" title="binder">from</span></a> <a id="to:49" class="idref" href="#to:49"><span class="id" title="binder">to</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="escrow_caddr:50" class="idref" href="#escrow_caddr:50"><span class="id" title="binder">escrow_caddr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="trace:51" class="idref" href="#trace:51"><span class="id" title="binder">trace</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#from:48"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:49"><span class="id" title="variable">to</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#NextStep"><span class="id" title="inductive">NextStep</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="keyword">fix</span> <a id="rec:59" class="idref" href="#rec:59"><span class="id" title="binder">rec</span></a> {<a id="from:52" class="idref" href="#from:52"><span class="id" title="binder">from</span></a> <a id="to:53" class="idref" href="#to:53"><span class="id" title="binder">to</span></a>} (<a id="trace:54" class="idref" href="#trace:54"><span class="id" title="binder">trace</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#from:52"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:53"><span class="id" title="variable">to</span></a>) <a id="acc:55" class="idref" href="#acc:55"><span class="id" title="binder">acc</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:54"><span class="id" title="variable">trace</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.ChainedList.html#snoc"><span class="id" title="constructor">snoc</span></a> <span class="id" title="var">trace'</span> <span class="id" title="var">step</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#acc:55"><span class="id" title="variable">acc</span></a>, <a class="idref" href="ConCert.Execution.Test.TestUtils.html#get_contract_state"><span class="id" title="definition">get_contract_state</span></a> <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#State"><span class="id" title="record">Escrow.State</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:53"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_caddr:50"><span class="id" title="variable">escrow_caddr</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nextstep</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><span class="id" title="var">_</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">state</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="notation">(</span><span class="id" title="var">nextstep</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">state</span>.(<a class="idref" href="ConCert.Examples.Escrow.Escrow.html#next_step"><span class="id" title="projection">next_step</span></a>)<span class="id" title="notation">)?</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#rec:56"><span class="id" title="variable">rec</span></a> <span class="id" title="var">trace'</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#acc:55"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#rec:56"><span class="id" title="variable">rec</span></a> <span class="id" title="var">trace'</span> (<span class="id" title="var">state</span>.(<a class="idref" href="ConCert.Examples.Escrow.Escrow.html#next_step"><span class="id" title="projection">next_step</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#acc:55"><span class="id" title="variable">acc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">state</span> =&gt; <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#rec:56"><span class="id" title="variable">rec</span></a> <span class="id" title="var">trace'</span> (<span class="id" title="var">state</span>.(<a class="idref" href="ConCert.Examples.Escrow.Escrow.html#next_step"><span class="id" title="projection">next_step</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#acc:55"><span class="id" title="variable">acc</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#rec:56"><span class="id" title="variable">rec</span></a> <span class="id" title="var">trace'</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#acc:55"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.ChainedList.html#clnil"><span class="id" title="constructor">clnil</span></a> =&gt; <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#acc:55"><span class="id" title="variable">acc</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#rec:59"><span class="id" title="variable">rec</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:51"><span class="id" title="variable">trace</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;want&nbsp;to&nbsp;see&nbsp;what&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;generated&nbsp;sequences&nbsp;of&nbsp;next_step&nbsp;are,<br/>
&nbsp;&nbsp;so&nbsp;we&nbsp;use&nbsp;QuickChick's&nbsp;'collect'&nbsp;to&nbsp;collect&nbsp;length&nbsp;distribution&nbsp;statistics&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="collect_steps_length_distribution" class="idref" href="#collect_steps_length_distribution"><span class="id" title="definition">collect_steps_length_distribution</span></a> <a id="g:60" class="idref" href="#g:60"><span class="id" title="binder">g</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="definition">forAll</span> (<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#g:60"><span class="id" title="variable">g</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_chain"><span class="id" title="definition">escrow_chain</span></a> 10%<span class="id" title="var">nat</span>) (<span class="id" title="keyword">fun</span> <a id="cb:61" class="idref" href="#cb:61"><span class="id" title="binder">cb</span></a> =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="definition">collect</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#length"><span class="id" title="abbreviation">length</span></a> (<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_next_states"><span class="id" title="definition">escrow_next_states</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_contract_addr"><span class="id" title="definition">escrow_contract_addr</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#builder_trace"><span class="id" title="method">builder_trace</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#cb:61"><span class="id" title="variable">cb</span></a>)))<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;QuickChick&nbsp;(collect_steps_length_distribution&nbsp;gEscrowTrace).&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*<br/>
&nbsp;&nbsp;4812&nbsp;:&nbsp;2<br/>
&nbsp;&nbsp;2470&nbsp;:&nbsp;1<br/>
&nbsp;&nbsp;2244&nbsp;:&nbsp;3<br/>
&nbsp;&nbsp;474&nbsp;:&nbsp;4<br/>
&nbsp;&nbsp;+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(0&nbsp;discards)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;QuickChick&nbsp;(collect_steps_length_distribution&nbsp;gEscrowTraceBetter).&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*<br/>
&nbsp;&nbsp;6636&nbsp;:&nbsp;4<br/>
&nbsp;&nbsp;3364&nbsp;:&nbsp;2<br/>
&nbsp;&nbsp;+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(0&nbsp;discards)&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;see&nbsp;that&nbsp;the&nbsp;"better"&nbsp;generator&nbsp;more&nbsp;often&nbsp;generates&nbsp;the&nbsp;full&nbsp;sequence&nbsp;of&nbsp;states,&nbsp;namely&nbsp;the&nbsp;sequence:<br/>
&nbsp;&nbsp;buyer_commit&nbsp;-&gt;&nbsp;buyer_confirm&nbsp;-&gt;&nbsp;withdrawals&nbsp;-&gt;&nbsp;no_next_step<br/>
&nbsp;&nbsp;The&nbsp;sequence&nbsp;of&nbsp;length&nbsp;2&nbsp;is&nbsp;the&nbsp;sequence:<br/>
&nbsp;&nbsp;buyer_commit&nbsp;-&gt;&nbsp;no_next_step<br/>
&nbsp;&nbsp;Corresponding&nbsp;to&nbsp;the&nbsp;case&nbsp;where&nbsp;the&nbsp;seller&nbsp;withdraws&nbsp;their&nbsp;funds&nbsp;before&nbsp;the&nbsp;buyer&nbsp;commits&nbsp;&amp;&nbsp;confirms&nbsp;their&nbsp;purchase.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="is_valid_step_sequence_fix" class="idref" href="#is_valid_step_sequence_fix"><span class="id" title="definition">is_valid_step_sequence_fix</span></a> <a id="steps:62" class="idref" href="#steps:62"><span class="id" title="binder">steps</span></a> <a id="prev_step:63" class="idref" href="#prev_step:63"><span class="id" title="binder">prev_step</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#prev_step:63"><span class="id" title="variable">prev_step</span></a>, <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#steps:62"><span class="id" title="variable">steps</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>, <span class="id" title="var">step</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><span class="id" title="var">steps'</span> =&gt; <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#is_valid_step_sequence_fix:64"><span class="id" title="definition">is_valid_step_sequence_fix</span></a> <span class="id" title="var">steps'</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">step</span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">prev_step</span>, <span class="id" title="var">step</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a><span class="id" title="var">steps'</span> =&gt; <span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#prev_step:63"><span class="id" title="variable">prev_step</span></a>, <span class="id" title="var">step</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#buyer_commit"><span class="id" title="constructor">buyer_commit</span></a>, <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#buyer_confirm"><span class="id" title="constructor">buyer_confirm</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#buyer_commit"><span class="id" title="constructor">buyer_commit</span></a>, <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#no_next_step"><span class="id" title="constructor">no_next_step</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#buyer_confirm"><span class="id" title="constructor">buyer_confirm</span></a>, <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#withdrawals"><span class="id" title="constructor">withdrawals</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#withdrawals"><span class="id" title="constructor">withdrawals</span></a>, <a class="idref" href="ConCert.Examples.Escrow.Escrow.html#no_next_step"><span class="id" title="constructor">no_next_step</span></a> =&gt; <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#is_valid_step_sequence_fix:64"><span class="id" title="definition">is_valid_step_sequence_fix</span></a> <span class="id" title="var">steps'</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">step</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="is_valid_step_sequence" class="idref" href="#is_valid_step_sequence"><span class="id" title="definition">is_valid_step_sequence</span></a> <a id="steps:69" class="idref" href="#steps:69"><span class="id" title="binder">steps</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#is_valid_step_sequence_fix"><span class="id" title="definition">is_valid_step_sequence_fix</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#steps:69"><span class="id" title="variable">steps</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Test&nbsp;property&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Conjecture</span> <a id="escrow_valid_steps_P" class="idref" href="#escrow_valid_steps_P"><span class="id" title="axiom">escrow_valid_steps_P</span></a> : <span class="id" title="keyword">forall</span> <a id="trace:71" class="idref" href="#trace:71"><span class="id" title="binder">trace</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#cc5e56ba3765e2d6b17e66d19b966f1d"><span class="id" title="notation">{</span></a><a id="to:70" class="idref" href="#to:70"><span class="id" title="binder">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#cc5e56ba3765e2d6b17e66d19b966f1d"><span class="id" title="notation">:</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#cc5e56ba3765e2d6b17e66d19b966f1d"><span class="id" title="notation">&amp;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#to:70"><span class="id" title="variable">to</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#cc5e56ba3765e2d6b17e66d19b966f1d"><span class="id" title="notation">}</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="steps:72" class="idref" href="#steps:72"><span class="id" title="binder">steps</span></a> := <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_next_states"><span class="id" title="definition">escrow_next_states</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#escrow_contract_addr"><span class="id" title="definition">escrow_contract_addr</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Specif.html#projT2"><span class="id" title="definition">projT2</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#trace:71"><span class="id" title="variable">trace</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#is_valid_step_sequence"><span class="id" title="definition">is_valid_step_sequence</span></a> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#steps:72"><span class="id" title="variable">steps</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Escrow.tests.EscrowTests.html#TestProperties"><span class="id" title="section">TestProperties</span></a>.<br/>

<br/>
<span class="comment">(*&nbsp;----------&nbsp;Test&nbsp;execution&nbsp;----------&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Extract</span> <span class="id" title="var">Constant</span> <span class="id" title="var">defNumDiscards</span> =&gt; "(2 * defNumTests)".<br/>

<br/>
<span class="comment">(*&nbsp;QuickChick&nbsp;(forAllEscrowChainBuilder&nbsp;gEscrowTrace&nbsp;7&nbsp;escrow_chain&nbsp;escrow_correct_P).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;***&nbsp;Gave&nbsp;up!&nbsp;Passed&nbsp;only&nbsp;8598&nbsp;tests<br/>
Discarded:&nbsp;20000&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Using&nbsp;the&nbsp;better&nbsp;generator,&nbsp;which&nbsp;avoid&nbsp;the&nbsp;discards:&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;QuickChick&nbsp;(forAllEscrowChainBuilder&nbsp;gEscrowTraceBetter&nbsp;7&nbsp;escrow_chain&nbsp;escrow_correct_P).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(0&nbsp;discards)&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Or&nbsp;alternatively&nbsp;we&nbsp;can&nbsp;just&nbsp;write:&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;QuickChick&nbsp;escrow_correct_P.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(40&nbsp;discards)&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Not&nbsp;sure&nbsp;where&nbsp;the&nbsp;40&nbsp;discards&nbsp;come&nbsp;from,&nbsp;but&nbsp;it's&nbsp;an&nbsp;acceptable&nbsp;amount&nbsp;for&nbsp;sure...&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;implicitly&nbsp;using&nbsp;the&nbsp;"better"&nbsp;generator&nbsp;here&nbsp;to&nbsp;generate&nbsp;arbitrary&nbsp;ChainTraces&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;QuickChick&nbsp;escrow_valid_steps_P.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;+++&nbsp;Passed&nbsp;10000&nbsp;tests&nbsp;(0&nbsp;discards)&nbsp;*)</span><br/>
</div>
</div>
<div id="footer">
  Generated by <a href="https://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a> and <a href="https://github.com/jgallen23/toc">TOC</a>
</div>
</div>
<script>
  const elements = document.getElementsByClassName("libtitle");
  while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
  }
  if (window.location.pathname.endsWith("/toc.html")) {
      const jstocDiv = document.getElementById("js-toc");
      jstocDiv.classList.remove("toc");
      jstocDiv.classList.add("jstoc-hidden");
      const jstocHeaderDiv = document.getElementById("js-toc-header");
      jstocHeaderDiv.classList.add("jstoc-hidden");
      const mainDiv = document.getElementById("main");
      mainDiv.classList.add("jstoc-hidden-main");
      const toggleDiv = document.getElementById("toggle-toc");
      toggleDiv.classList.add("jstoc-hidden");
  }
  console.log(window.location.pathname);
</script>
<script type="text/javascript" src="toc.js"></script>
</body>

</html>
