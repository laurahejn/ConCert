<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<link href="toc.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
      <span id="toggle-toc">Contents</span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="https://github.com/AU-COBRA/ConCert" target="_balnk">Project Page</a>
      <a href="index.html">Index</a>
      <a href="toc.html">Table of contents</a>
    </span>
</div>
  <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="js-toc" class="toc" data-toc="h1,h2,h3,h4" data-toc-container="doc" data-toc-offset="-40">
      <div id="js-toc-header" class="toc-header">Contents:</div>
    </div>
    <div id="main">
<h1 class="libtitle">Library ConCert.Examples.Dexter2.Dexter2CPMM</h1>

<div class="code">
</div>

<div class="doc">
<a id="lab108"></a><h1 class="section">Dexter 2 CPMM contract</h1>
 This file contains an implementation of the Dexter2 CPMM contract
    https://gitlab.com/dexter2tz/dexter2tz/-/blob/1cec9d9333eba756603d6cd90ea9c70d482a5d3d/dexter.mligo
    In addition this file contains proof of functional correctness w.r.t the
    informal specification https://gitlab.com/dexter2tz/dexter2tz/-/blob/1cec9d9333eba756603d6cd90ea9c70d482a5d3d/docs/informal-spec/dexter2-cpmm.md

<div class="paragraph"> </div>

    This contract is an implementation of a Constant Product Market Maker (CPMM).
    When paired with a FA1.2 or FA2 token contract and a Dexter2 liquidity contract,
    this contract serves as a decentralized exchange allowing users to trade between
    XTZ and tokens. Additionally users can also add or withdraw funds from the
    exchanges trading reserves. Traders pay a 0.3
</div>
<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.RecordUpdate.html#"><span class="id" title="library">RecordUpdate</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Blockchain.html#"><span class="id" title="library">Blockchain</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Monad.html#"><span class="id" title="library">Monad</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.ResultMonad.html#"><span class="id" title="library">ResultMonad</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Serializable.html#"><span class="id" title="library">Serializable</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.ContractCommon.html#"><span class="id" title="library">ContractCommon</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.FA2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.FA2.FA2Token.html#"><span class="id" title="library">FA2Token</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.FA2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#"><span class="id" title="library">FA2LegacyInterface</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.Dexter2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2FA12.html#"><span class="id" title="library">Dexter2FA12</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.ZArith_base.html#"><span class="id" title="library">ZArith_base</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>. <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab109"></a><h1 class="section">Contract types</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a id="DexterTypes" class="idref" href="#DexterTypes"><span class="id" title="section">DexterTypes</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="BaseTypes:1" class="idref" href="#BaseTypes:1"><span class="id" title="binder">BaseTypes</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Set</span> <span class="id" title="var">Primitive</span> <span class="id" title="var">Projections</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Set</span> <span class="id" title="var">Nonrecursive</span> <span class="id" title="var">Elimination</span> <span class="id" title="var">Schemes</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">N_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab110"></a><h2 class="section">Type synonyms</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="update_token_pool_internal_" class="idref" href="#update_token_pool_internal_"><span class="id" title="definition">update_token_pool_internal_</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#balance_of_response"><span class="id" title="record">FA2LegacyInterface.balance_of_response</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="token_id" class="idref" href="#token_id"><span class="id" title="definition">token_id</span></a> := <a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#token_id"><span class="id" title="definition">FA2LegacyInterface.token_id</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="token_contract_transfer" class="idref" href="#token_contract_transfer"><span class="id" title="definition">token_contract_transfer</span></a> := <a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#transfer"><span class="id" title="record">FA2LegacyInterface.transfer</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="balance_of" class="idref" href="#balance_of"><span class="id" title="definition">balance_of</span></a> := <a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#balance_of_response"><span class="id" title="record">FA2LegacyInterface.balance_of_response</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="mintOrBurn" class="idref" href="#mintOrBurn"><span class="id" title="definition">mintOrBurn</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2FA12.html#mintOrBurn_param"><span class="id" title="record">Dexter2FA12.mintOrBurn_param</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="baker_address" class="idref" href="#baker_address"><span class="id" title="definition">baker_address</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab111"></a><h2 class="section">Entrypoint types</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="add_liquidity_param" class="idref" href="#add_liquidity_param"><span class="id" title="record">add_liquidity_param</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_add_liquidity_param</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="owner" class="idref" href="#owner"><span class="id" title="projection">owner</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="minLqtMinted" class="idref" href="#minLqtMinted"><span class="id" title="projection">minLqtMinted</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="maxTokensDeposited" class="idref" href="#maxTokensDeposited"><span class="id" title="projection">maxTokensDeposited</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="add_deadline" class="idref" href="#add_deadline"><span class="id" title="projection">add_deadline</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="remove_liquidity_param" class="idref" href="#remove_liquidity_param"><span class="id" title="record">remove_liquidity_param</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_remove_liquidity_param</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="liquidity_to" class="idref" href="#liquidity_to"><span class="id" title="projection">liquidity_to</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="lqtBurned" class="idref" href="#lqtBurned"><span class="id" title="projection">lqtBurned</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="minXtzWithdrawn" class="idref" href="#minXtzWithdrawn"><span class="id" title="projection">minXtzWithdrawn</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="minTokensWithdrawn" class="idref" href="#minTokensWithdrawn"><span class="id" title="projection">minTokensWithdrawn</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="remove_deadline" class="idref" href="#remove_deadline"><span class="id" title="projection">remove_deadline</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="xtz_to_token_param" class="idref" href="#xtz_to_token_param"><span class="id" title="record">xtz_to_token_param</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_xtz_to_token_param</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="tokens_to" class="idref" href="#tokens_to"><span class="id" title="projection">tokens_to</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="minTokensBought" class="idref" href="#minTokensBought"><span class="id" title="projection">minTokensBought</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="xtt_deadline" class="idref" href="#xtt_deadline"><span class="id" title="projection">xtt_deadline</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="token_to_xtz_param" class="idref" href="#token_to_xtz_param"><span class="id" title="record">token_to_xtz_param</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_token_to_xtz_param</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="xtz_to" class="idref" href="#xtz_to"><span class="id" title="projection">xtz_to</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="tokensSold" class="idref" href="#tokensSold"><span class="id" title="projection">tokensSold</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="minXtzBought" class="idref" href="#minXtzBought"><span class="id" title="projection">minXtzBought</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ttx_deadline" class="idref" href="#ttx_deadline"><span class="id" title="projection">ttx_deadline</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="token_to_token_param" class="idref" href="#token_to_token_param"><span class="id" title="record">token_to_token_param</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_token_to_token_param</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="outputDexterContract" class="idref" href="#outputDexterContract"><span class="id" title="projection">outputDexterContract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="to_" class="idref" href="#to_"><span class="id" title="projection">to_</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="minTokensBought_" class="idref" href="#minTokensBought_"><span class="id" title="projection">minTokensBought_</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="tokensSold_" class="idref" href="#tokensSold_"><span class="id" title="projection">tokensSold_</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="ttt_deadline" class="idref" href="#ttt_deadline"><span class="id" title="projection">ttt_deadline</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="set_baker_param" class="idref" href="#set_baker_param"><span class="id" title="record">set_baker_param</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_set_baker_param</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="baker" class="idref" href="#baker"><span class="id" title="projection">baker</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#baker_address"><span class="id" title="definition">baker_address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="freezeBaker_" class="idref" href="#freezeBaker_"><span class="id" title="projection">freezeBaker_</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a id="DexterMsg" class="idref" href="#DexterMsg"><span class="id" title="inductive">DexterMsg</span></a> :=<br/>
&nbsp;&nbsp;| <a id="AddLiquidity" class="idref" href="#AddLiquidity"><span class="id" title="constructor">AddLiquidity</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#add_liquidity_param"><span class="id" title="record">add_liquidity_param</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a><br/>
&nbsp;&nbsp;| <a id="RemoveLiquidity" class="idref" href="#RemoveLiquidity"><span class="id" title="constructor">RemoveLiquidity</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#remove_liquidity_param"><span class="id" title="record">remove_liquidity_param</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a><br/>
&nbsp;&nbsp;| <a id="XtzToToken" class="idref" href="#XtzToToken"><span class="id" title="constructor">XtzToToken</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_to_token_param"><span class="id" title="record">xtz_to_token_param</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a><br/>
&nbsp;&nbsp;| <a id="TokenToXtz" class="idref" href="#TokenToXtz"><span class="id" title="constructor">TokenToXtz</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_to_xtz_param"><span class="id" title="record">token_to_xtz_param</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a><br/>
&nbsp;&nbsp;| <a id="SetBaker" class="idref" href="#SetBaker"><span class="id" title="constructor">SetBaker</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#set_baker_param"><span class="id" title="record">set_baker_param</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a><br/>
&nbsp;&nbsp;| <a id="SetManager" class="idref" href="#SetManager"><span class="id" title="constructor">SetManager</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a><br/>
&nbsp;&nbsp;| <a id="SetLqtAddress" class="idref" href="#SetLqtAddress"><span class="id" title="constructor">SetLqtAddress</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a><br/>
&nbsp;&nbsp;| <a id="UpdateTokenPool" class="idref" href="#UpdateTokenPool"><span class="id" title="constructor">UpdateTokenPool</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a><br/>
&nbsp;&nbsp;| <a id="TokenToToken" class="idref" href="#TokenToToken"><span class="id" title="constructor">TokenToToken</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_to_token_param"><span class="id" title="record">token_to_token_param</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg:31"><span class="id" title="inductive">DexterMsg</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Msg" class="idref" href="#Msg"><span class="id" title="definition">Msg</span></a> := @<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#FA2ReceiverMsg"><span class="id" title="inductive">FA2Token.FA2ReceiverMsg</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg"><span class="id" title="inductive">DexterMsg</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab112"></a><h2 class="section">Storage types</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="State" class="idref" href="#State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_state</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="tokenPool" class="idref" href="#tokenPool"><span class="id" title="projection">tokenPool</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="xtzPool" class="idref" href="#xtzPool"><span class="id" title="projection">xtzPool</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="lqtTotal" class="idref" href="#lqtTotal"><span class="id" title="projection">lqtTotal</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="selfIsUpdatingTokenPool" class="idref" href="#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="freezeBaker" class="idref" href="#freezeBaker"><span class="id" title="projection">freezeBaker</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="manager" class="idref" href="#manager"><span class="id" title="projection">manager</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="tokenAddress" class="idref" href="#tokenAddress"><span class="id" title="projection">tokenAddress</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="tokenId" class="idref" href="#tokenId"><span class="id" title="projection">tokenId</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_id"><span class="id" title="definition">token_id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="lqtAddress" class="idref" href="#lqtAddress"><span class="id" title="projection">lqtAddress</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a id="Setup" class="idref" href="#Setup"><span class="id" title="record">Setup</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_setup</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="lqtTotal_" class="idref" href="#lqtTotal_"><span class="id" title="projection">lqtTotal_</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="manager_" class="idref" href="#manager_"><span class="id" title="projection">manager_</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="tokenAddress_" class="idref" href="#tokenAddress_"><span class="id" title="projection">tokenAddress_</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="tokenId_" class="idref" href="#tokenId_"><span class="id" title="projection">tokenId_</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_id"><span class="id" title="definition">token_id</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Error" class="idref" href="#Error"><span class="id" title="definition">Error</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="default_error" class="idref" href="#default_error"><span class="id" title="definition">default_error</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a> := 1%<span class="id" title="var">nat</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterTypes"><span class="id" title="section">DexterTypes</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Type</span> <a id="Dexter2Serializable" class="idref" href="#Dexter2Serializable"><span class="id" title="module">Dexter2Serializable</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Dexter2Serializable.DS" class="idref" href="#Dexter2Serializable.DS"><span class="id" title="section">DS</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<a id="H:48" class="idref" href="#H:48"><span class="id" title="binder">ChainBase</span></a>}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.add_liquidity_param_serializable" class="idref" href="#Dexter2Serializable.add_liquidity_param_serializable"><span class="id" title="axiom">add_liquidity_param_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#add_liquidity_param"><span class="id" title="record">add_liquidity_param</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">add_liquidity_param_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.remove_liquidity_param_serializable" class="idref" href="#Dexter2Serializable.remove_liquidity_param_serializable"><span class="id" title="axiom">remove_liquidity_param_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#remove_liquidity_param"><span class="id" title="record">remove_liquidity_param</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">remove_liquidity_param_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.xtz_to_token_param_serializable" class="idref" href="#Dexter2Serializable.xtz_to_token_param_serializable"><span class="id" title="axiom">xtz_to_token_param_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_to_token_param"><span class="id" title="record">xtz_to_token_param</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">xtz_to_token_param_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.token_to_xtz_param_serializable" class="idref" href="#Dexter2Serializable.token_to_xtz_param_serializable"><span class="id" title="axiom">token_to_xtz_param_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_to_xtz_param"><span class="id" title="record">token_to_xtz_param</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">token_to_xtz_param_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.set_baker_param_serializable" class="idref" href="#Dexter2Serializable.set_baker_param_serializable"><span class="id" title="axiom">set_baker_param_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#set_baker_param"><span class="id" title="record">set_baker_param</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">set_baker_param_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.token_to_token_param_serializable" class="idref" href="#Dexter2Serializable.token_to_token_param_serializable"><span class="id" title="axiom">token_to_token_param_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_to_token_param"><span class="id" title="record">token_to_token_param</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">token_to_token_param_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.DexterMsg_serializable" class="idref" href="#Dexter2Serializable.DexterMsg_serializable"><span class="id" title="axiom">DexterMsg_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg"><span class="id" title="inductive">DexterMsg</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">DexterMsg_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.Dexter2FA12_Msg_serialize" class="idref" href="#Dexter2Serializable.Dexter2FA12_Msg_serialize"><span class="id" title="axiom">Dexter2FA12_Msg_serialize</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2FA12.html#Msg"><span class="id" title="inductive">Dexter2FA12.Msg</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">Dexter2FA12_Msg_serialize</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.setup_serializable" class="idref" href="#Dexter2Serializable.setup_serializable"><span class="id" title="axiom">setup_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Setup"><span class="id" title="record">Setup</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">setup_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.ClientMsg_serializable" class="idref" href="#Dexter2Serializable.ClientMsg_serializable"><span class="id" title="axiom">ClientMsg_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> (@<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#FA2ReceiverMsg"><span class="id" title="inductive">FA2Token.FA2ReceiverMsg</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg"><span class="id" title="inductive">DexterMsg</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">ClientMsg_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.state_serializable" class="idref" href="#Dexter2Serializable.state_serializable"><span class="id" title="axiom">state_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">state_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="Dexter2Serializable.FA2Token_Msg_serializable" class="idref" href="#Dexter2Serializable.FA2Token_Msg_serializable"><span class="id" title="axiom">FA2Token_Msg_serializable</span></a> : <a class="idref" href="ConCert.Execution.Serializable.html#Serializable"><span class="id" title="class">Serializable</span></a> <a class="idref" href="ConCert.Examples.FA2.FA2Token.html#Msg"><span class="id" title="inductive">FA2Token.Msg</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">FA2Token_Msg_serializable</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2Serializable.DS"><span class="id" title="section">DS</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2Serializable"><span class="id" title="module">Dexter2Serializable</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Type</span> <a id="NullAddress" class="idref" href="#NullAddress"><span class="id" title="module">NullAddress</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="NullAddress.NullAddress" class="idref" href="#NullAddress.NullAddress"><span class="id" title="section">NullAddress</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="NullAddress.BaseTypes" class="idref" href="#NullAddress.BaseTypes"><span class="id" title="axiom">BaseTypes</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">BaseTypes</span>.<br/>

<br/>
</div>

<div class="doc">
Null address that will newer contain contracts 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="NullAddress.null_address" class="idref" href="#NullAddress.null_address"><span class="id" title="axiom">null_address</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>.<br/>

<br/>
</div>

<div class="doc">
Place holder for tezos set delegate operation 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="NullAddress.set_delegate_call" class="idref" href="#NullAddress.set_delegate_call"><span class="id" title="axiom">set_delegate_call</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#baker_address"><span class="id" title="definition">baker_address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="NullAddress.delegate_call" class="idref" href="#NullAddress.delegate_call"><span class="id" title="axiom">delegate_call</span></a> : <span class="id" title="keyword">forall</span> <a id="addr:64" class="idref" href="#addr:64"><span class="id" title="binder">addr</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> <a id="action:65" class="idref" href="#action:65"><span class="id" title="binder">action</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#action:65"><span class="id" title="variable">action</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#act_deploy"><span class="id" title="constructor">act_deploy</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddress.set_delegate_call"><span class="id" title="axiom">set_delegate_call</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#addr:64"><span class="id" title="variable">addr</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddress.NullAddress"><span class="id" title="section">NullAddress</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddress"><span class="id" title="module">NullAddress</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab113"></a><h1 class="section">Contract functions</h1>

</div>
<div class="code">
<span class="id" title="keyword">Module</span> <a id="Dexter2" class="idref" href="#Dexter2"><span class="id" title="module">Dexter2</span></a> (<span class="id" title="var">SI</span> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2Serializable"><span class="id" title="module">Dexter2Serializable</span></a>) (<span class="id" title="var">NAddr</span> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddress"><span class="id" title="module">NullAddress</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#SI"><span class="id" title="module">SI</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Export</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NAddr"><span class="id" title="module">NAddr</span></a>.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="Dexter2.DexterDefs" class="idref" href="#Dexter2.DexterDefs"><span class="id" title="section">DexterDefs</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">N_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab114"></a><h2 class="section">Helper functions</h2>

<div class="paragraph"> </div>

 <span class="inlinecode"><a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a></span> is defined as an alias to <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a></span>. We use these conversion function to mark
        the places explicitly where the conversion from amounts happens. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.amount_to_N" class="idref" href="#Dexter2.amount_to_N"><span class="id" title="definition">amount_to_N</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.N_to_amount" class="idref" href="#Dexter2.N_to_amount"><span class="id" title="definition">N_to_amount</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.of_N"><span class="id" title="definition">Z.of_N</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.Result" class="idref" href="#Dexter2.Result"><span class="id" title="definition">Result</span></a> : <span class="id" title="keyword">Type</span> := <a class="idref" href="ConCert.Execution.ResultMonad.html#result"><span class="id" title="inductive">result</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.sub" class="idref" href="#Dexter2.sub"><span class="id" title="definition">sub</span></a> (<a id="n:68" class="idref" href="#n:68"><span class="id" title="binder">n</span></a> <a id="m:69" class="idref" href="#m:69"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>) : <a class="idref" href="ConCert.Execution.ResultMonad.html#result"><span class="id" title="inductive">result</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:68"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:69"><span class="id" title="variable">m</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:68"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:69"><span class="id" title="variable">m</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.div" class="idref" href="#Dexter2.div"><span class="id" title="definition">div</span></a> (<a id="n:70" class="idref" href="#n:70"><span class="id" title="binder">n</span></a> <a id="m:71" class="idref" href="#m:71"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>) : <a class="idref" href="ConCert.Execution.ResultMonad.html#result"><span class="id" title="inductive">result</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:71"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> 0) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:70"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">/</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:71"><span class="id" title="variable">m</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.ceildiv" class="idref" href="#Dexter2.ceildiv"><span class="id" title="definition">ceildiv</span></a> (<a id="n:72" class="idref" href="#n:72"><span class="id" title="binder">n</span></a> <a id="m:73" class="idref" href="#m:73"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>) : <a class="idref" href="ConCert.Execution.ResultMonad.html#result"><span class="id" title="inductive">result</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.modulo"><span class="id" title="definition">N.modulo</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:72"><span class="id" title="variable">n</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:73"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:72"><span class="id" title="variable">n</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:73"><span class="id" title="variable">m</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="res:74" class="idref" href="#res:74"><span class="id" title="binder">res</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:72"><span class="id" title="variable">n</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:73"><span class="id" title="variable">m</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#res:74"><span class="id" title="variable">res</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.ceildiv_" class="idref" href="#Dexter2.ceildiv_"><span class="id" title="definition">ceildiv_</span></a> (<a id="n:75" class="idref" href="#n:75"><span class="id" title="binder">n</span></a> <a id="m:76" class="idref" href="#m:76"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.modulo"><span class="id" title="definition">N.modulo</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:75"><span class="id" title="variable">n</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:76"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:75"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">/</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:76"><span class="id" title="variable">m</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#n:75"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">/</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#m:76"><span class="id" title="variable">m</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Opaque</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.ceildiv"><span class="id" title="definition">ceildiv</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Opaque</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.ceildiv_"><span class="id" title="definition">ceildiv_</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Opaque</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Opaque</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.sub"><span class="id" title="definition">sub</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.non_zero_amount" class="idref" href="#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> (<a id="amt:77" class="idref" href="#amt:77"><span class="id" title="binder">amt</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a> := (0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#f1746f02f141d025b1e53605943919bf"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#amt:77"><span class="id" title="variable">amt</span></a>)%<span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Arguments</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <span class="id" title="var">_</span> /. <span class="comment">(*&nbsp;always&nbsp;unfold,&nbsp;if&nbsp;applied&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.call_liquidity_token" class="idref" href="#Dexter2.call_liquidity_token"><span class="id" title="definition">call_liquidity_token</span></a> (<a id="addr:78" class="idref" href="#addr:78"><span class="id" title="binder">addr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="amt:79" class="idref" href="#amt:79"><span class="id" title="binder">amt</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="msg:80" class="idref" href="#msg:80"><span class="id" title="binder">msg</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2FA12.html#Msg"><span class="id" title="inductive">Dexter2FA12.Msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#addr:78"><span class="id" title="variable">addr</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.N_to_amount"><span class="id" title="definition">N_to_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#amt:79"><span class="id" title="variable">amt</span></a>) (<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#msg:80"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
Note that <span class="inlinecode"><a class="idref" href="ConCert.Examples.Dexter2.Dexter2FA12.html#quantity"><span class="id" title="projection">quantity</span></a></span> is allowed to be negative. In this case it correspons to burning 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.mint_or_burn" class="idref" href="#Dexter2.mint_or_burn"><span class="id" title="definition">mint_or_burn</span></a> (<a id="state:81" class="idref" href="#state:81"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="target:82" class="idref" href="#target:82"><span class="id" title="binder">target</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="quantitiy:83" class="idref" href="#quantitiy:83"><span class="id" title="binder">quantitiy</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Execution.ResultMonad.html#result"><span class="id" title="inductive">result</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:81"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtAddress"><span class="id" title="projection">lqtAddress</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NAddr.null_address"><span class="id" title="axiom">null_address</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error&nbsp;lqtAddress&nbsp;not&nbsp;set&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.call_liquidity_token"><span class="id" title="definition">call_liquidity_token</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:81"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtAddress"><span class="id" title="projection">lqtAddress</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2FA12.html#msg_mint_or_burn"><span class="id" title="constructor">Dexter2FA12.msg_mint_or_burn</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2FA12.html#build_mintOrBurn_param"><span class="id" title="constructor">Dexter2FA12.build_mintOrBurn_param</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#quantitiy:83"><span class="id" title="variable">quantitiy</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#target:82"><span class="id" title="variable">target</span></a>))).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.call_to_token" class="idref" href="#Dexter2.call_to_token"><span class="id" title="definition">call_to_token</span></a> (<a id="token_addr:84" class="idref" href="#token_addr:84"><span class="id" title="binder">token_addr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="amt:85" class="idref" href="#amt:85"><span class="id" title="binder">amt</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="msg:86" class="idref" href="#msg:86"><span class="id" title="binder">msg</span></a> : <a class="idref" href="ConCert.Examples.FA2.FA2Token.html#Msg"><span class="id" title="inductive">FA2Token.Msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_addr:84"><span class="id" title="variable">token_addr</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.N_to_amount"><span class="id" title="definition">N_to_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#amt:85"><span class="id" title="variable">amt</span></a>) (<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#msg:86"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.token_transfer" class="idref" href="#Dexter2.token_transfer"><span class="id" title="definition">token_transfer</span></a> (<a id="state:87" class="idref" href="#state:87"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="from:88" class="idref" href="#from:88"><span class="id" title="binder">from</span></a> <a id="to:89" class="idref" href="#to:89"><span class="id" title="binder">to</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="amount:90" class="idref" href="#amount:90"><span class="id" title="binder">amount</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.call_to_token"><span class="id" title="definition">call_to_token</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:87"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenAddress"><span class="id" title="projection">tokenAddress</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#msg_transfer"><span class="id" title="constructor">FA2Token.msg_transfer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#build_transfer"><span class="id" title="constructor">FA2LegacyInterface.build_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#from:88"><span class="id" title="variable">from</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#build_transfer_destination"><span class="id" title="constructor">FA2LegacyInterface.build_transfer_destination</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#to:89"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:87"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenId"><span class="id" title="projection">tokenId</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#amount:90"><span class="id" title="variable">amount</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.xtz_transfer" class="idref" href="#Dexter2.xtz_transfer"><span class="id" title="definition">xtz_transfer</span></a> (<a id="to:91" class="idref" href="#to:91"><span class="id" title="binder">to</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="amount:92" class="idref" href="#amount:92"><span class="id" title="binder">amount</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Execution.ResultMonad.html#result"><span class="id" title="inductive">result</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#to:91"><span class="id" title="variable">to</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="ConCert.Execution.ResultMonad.html#Err"><span class="id" title="constructor">Err</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a> <span class="comment">(*&nbsp;error_INVALID_TO_ADDRESS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#to:91"><span class="id" title="variable">to</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.N_to_amount"><span class="id" title="definition">N_to_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#amount:92"><span class="id" title="variable">amount</span></a>)).<br/>

<br/>
</div>

<div class="doc">
<a id="lab115"></a><h2 class="section">Add liquidity</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.add_liquidity" class="idref" href="#Dexter2.add_liquidity"><span class="id" title="definition">add_liquidity</span></a> (<a id="chain:93" class="idref" href="#chain:93"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:94" class="idref" href="#ctx:94"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:95" class="idref" href="#state:95"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="param:96" class="idref" href="#param:96"><span class="id" title="binder">param</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#add_liquidity_param"><span class="id" title="record">add_liquidity_param</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:96"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#add_deadline"><span class="id" title="projection">add_deadline</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#0f31f5c1c6b6a21a3a187247222bc9e4"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:93"><span class="id" title="variable">chain</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a>))%<span class="id" title="var">nat</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_THE_CURRENT_TIME_MUST_BE_LESS_THAN_THE_DEADLINE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="lqt_minted:97" class="idref" href="#lqt_minted:97"><span class="id" title="binder">lqt_minted</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.amount_to_N"><span class="id" title="definition">amount_to_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:94"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal"><span class="id" title="projection">lqtTotal</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_DIV_by_0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="tokens_deposited:98" class="idref" href="#tokens_deposited:98"><span class="id" title="binder">tokens_deposited</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.ceildiv"><span class="id" title="definition">ceildiv</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.amount_to_N"><span class="id" title="definition">amount_to_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:94"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_DIV_by_0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:96"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#maxTokensDeposited"><span class="id" title="projection">maxTokensDeposited</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_deposited:98"><span class="id" title="variable">tokens_deposited</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_MAX_TOKENS_DEPOSITED_MUST_BE_GREATER_THAN_OR_EQUAL_TO_TOKENS_DEPOSITED&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqt_minted:97"><span class="id" title="variable">lqt_minted</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:96"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#minLqtMinted"><span class="id" title="projection">minLqtMinted</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_LQT_MINTED_MUST_BE_GREATER_THAN_MIN_LQT_MINTED&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_state:99" class="idref" href="#new_state:99"><span class="id" title="binder">new_state</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal"><span class="id" title="projection">lqtTotal</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal"><span class="id" title="projection">lqtTotal</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqt_minted:97"><span class="id" title="variable">lqt_minted</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_deposited:98"><span class="id" title="variable">tokens_deposited</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.amount_to_N"><span class="id" title="definition">amount_to_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:94"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="op_token:100" class="idref" href="#op_token:100"><span class="id" title="binder">op_token</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.token_transfer"><span class="id" title="definition">token_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:94"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:94"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_address"><span class="id" title="projection">ctx_contract_address</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_deposited:98"><span class="id" title="variable">tokens_deposited</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="op_lqt:101" class="idref" href="#op_lqt:101"><span class="id" title="binder">op_lqt</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.mint_or_burn"><span class="id" title="definition">mint_or_burn</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:95"><span class="id" title="variable">state</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:96"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#owner"><span class="id" title="projection">owner</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.of_N"><span class="id" title="definition">Z.of_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqt_minted:97"><span class="id" title="variable">lqt_minted</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_state:99"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op_token:100"><span class="id" title="variable">op_token</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op_lqt:101"><span class="id" title="variable">op_lqt</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab116"></a><h2 class="section">Remove liquidity</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.remove_liquidity" class="idref" href="#Dexter2.remove_liquidity"><span class="id" title="definition">remove_liquidity</span></a> (<a id="chain:102" class="idref" href="#chain:102"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:103" class="idref" href="#ctx:103"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:104" class="idref" href="#state:104"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="param:105" class="idref" href="#param:105"><span class="id" title="binder">param</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#remove_liquidity_param"><span class="id" title="record">remove_liquidity_param</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#remove_deadline"><span class="id" title="projection">remove_deadline</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#0f31f5c1c6b6a21a3a187247222bc9e4"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:102"><span class="id" title="variable">chain</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a>))%<span class="id" title="var">nat</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_THE_CURRENT_TIME_MUST_BE_LESS_THAN_THE_DEADLINE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:103"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_AMOUNT_MUST_BE_ZERO&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="xtz_withdrawn:106" class="idref" href="#xtz_withdrawn:106"><span class="id" title="binder">xtz_withdrawn</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtBurned"><span class="id" title="projection">lqtBurned</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal"><span class="id" title="projection">lqtTotal</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_DIV_by_0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="tokens_withdrawn:107" class="idref" href="#tokens_withdrawn:107"><span class="id" title="binder">tokens_withdrawn</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtBurned"><span class="id" title="projection">lqtBurned</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal"><span class="id" title="projection">lqtTotal</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_DIV_by_0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_withdrawn:106"><span class="id" title="variable">xtz_withdrawn</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#minXtzWithdrawn"><span class="id" title="projection">minXtzWithdrawn</span></a>))<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_THE_AMOUNT_OF_XTZ_WITHDRAWN_MUST_BE_GREATER_THAN_OR_EQUAL_TO_MIN_XTZ_WITHDRAWN&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_withdrawn:107"><span class="id" title="variable">tokens_withdrawn</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#minTokensWithdrawn"><span class="id" title="projection">minTokensWithdrawn</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_THE_AMOUNT_OF_TOKENS_WITHDRAWN_MUST_BE_GREATER_THAN_OR_EQUAL_TO_MIN_TOKENS_WITHDRAWN&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="new_lqtPool:108" class="idref" href="#new_lqtPool:108"><span class="id" title="binder">new_lqtPool</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.sub"><span class="id" title="definition">sub</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal"><span class="id" title="projection">lqtTotal</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtBurned"><span class="id" title="projection">lqtBurned</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_CANNOT_BURN_MORE_THAN_THE_TOTAL_AMOUNT_OF_LQT&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="new_tokenPool:109" class="idref" href="#new_tokenPool:109"><span class="id" title="binder">new_tokenPool</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.sub"><span class="id" title="definition">sub</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_withdrawn:107"><span class="id" title="variable">tokens_withdrawn</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_TOKEN_POOL_MINUS_TOKENS_WITHDRAWN_IS_NEGATIVE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="new_xtzPool:110" class="idref" href="#new_xtzPool:110"><span class="id" title="binder">new_xtzPool</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.sub"><span class="id" title="definition">sub</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_withdrawn:106"><span class="id" title="variable">xtz_withdrawn</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;mutez&nbsp;subtraction&nbsp;run&nbsp;time&nbsp;error&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="op_lqt:111" class="idref" href="#op_lqt:111"><span class="id" title="binder">op_lqt</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.mint_or_burn"><span class="id" title="definition">mint_or_burn</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:103"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) (0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.of_N"><span class="id" title="definition">Z.of_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtBurned"><span class="id" title="projection">lqtBurned</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#::Z_scope:x_'-'_x"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">Z</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="op_token:112" class="idref" href="#op_token:112"><span class="id" title="binder">op_token</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.token_transfer"><span class="id" title="definition">token_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:103"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_address"><span class="id" title="projection">ctx_contract_address</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#liquidity_to"><span class="id" title="projection">liquidity_to</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_withdrawn:107"><span class="id" title="variable">tokens_withdrawn</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="opt_xtz:113" class="idref" href="#opt_xtz:113"><span class="id" title="binder">opt_xtz</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.xtz_transfer"><span class="id" title="definition">xtz_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:105"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#liquidity_to"><span class="id" title="projection">liquidity_to</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_withdrawn:106"><span class="id" title="variable">xtz_withdrawn</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_state:114" class="idref" href="#new_state:114"><span class="id" title="binder">new_state</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_tokenPool:109"><span class="id" title="variable">new_tokenPool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_xtzPool:110"><span class="id" title="variable">new_xtzPool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal"><span class="id" title="projection">lqtTotal</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_lqtPool:108"><span class="id" title="variable">new_lqtPool</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#freezeBaker"><span class="id" title="projection">freezeBaker</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#freezeBaker"><span class="id" title="projection">freezeBaker</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#manager"><span class="id" title="projection">manager</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#manager"><span class="id" title="projection">manager</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenAddress"><span class="id" title="projection">tokenAddress</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenAddress"><span class="id" title="projection">tokenAddress</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenId"><span class="id" title="projection">tokenId</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenId"><span class="id" title="projection">tokenId</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtAddress"><span class="id" title="projection">lqtAddress</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:104"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtAddress"><span class="id" title="projection">lqtAddress</span></a>) |} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_state:114"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op_lqt:111"><span class="id" title="variable">op_lqt</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op_token:112"><span class="id" title="variable">op_token</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#opt_xtz:113"><span class="id" title="variable">opt_xtz</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab117"></a><h2 class="section">XTZ to tokens</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.xtz_to_token" class="idref" href="#Dexter2.xtz_to_token"><span class="id" title="definition">xtz_to_token</span></a> (<a id="chain:115" class="idref" href="#chain:115"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:116" class="idref" href="#ctx:116"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:117" class="idref" href="#state:117"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="param:118" class="idref" href="#param:118"><span class="id" title="binder">param</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_to_token_param"><span class="id" title="record">xtz_to_token_param</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:117"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:118"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtt_deadline"><span class="id" title="projection">xtt_deadline</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#0f31f5c1c6b6a21a3a187247222bc9e4"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:115"><span class="id" title="variable">chain</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a>))%<span class="id" title="var">nat</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_THE_CURRENT_TIME_MUST_BE_LESS_THAN_THE_DEADLINE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="tokens_bought:119" class="idref" href="#tokens_bought:119"><span class="id" title="binder">tokens_bought</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.amount_to_N"><span class="id" title="definition">amount_to_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:116"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 997 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:117"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:117"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 1000 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.amount_to_N"><span class="id" title="definition">amount_to_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:116"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 997<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_DIV_by_0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_bought:119"><span class="id" title="variable">tokens_bought</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:118"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#minTokensBought"><span class="id" title="projection">minTokensBought</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_TOKENS_BOUGHT_MUST_BE_GREATER_THAN_OR_EQUAL_TO_MIN_TOKENS_BOUGHT&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="new_tokenPool:120" class="idref" href="#new_tokenPool:120"><span class="id" title="binder">new_tokenPool</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.sub"><span class="id" title="definition">sub</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:117"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_bought:119"><span class="id" title="variable">tokens_bought</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_TOKEN_POOL_MINUS_TOKENS_BOUGHT_IS_NEGATIVE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_state:121" class="idref" href="#new_state:121"><span class="id" title="binder">new_state</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:117"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:117"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.amount_to_N"><span class="id" title="definition">amount_to_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:116"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_tokenPool:120"><span class="id" title="variable">new_tokenPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="op:122" class="idref" href="#op:122"><span class="id" title="binder">op</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.token_transfer"><span class="id" title="definition">token_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:117"><span class="id" title="variable">state</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:116"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_address"><span class="id" title="projection">ctx_contract_address</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:118"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_to"><span class="id" title="projection">tokens_to</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_bought:119"><span class="id" title="variable">tokens_bought</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_state:121"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op:122"><span class="id" title="variable">op</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab118"></a><h2 class="section">Tokes to XTZ</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.token_to_xtz" class="idref" href="#Dexter2.token_to_xtz"><span class="id" title="definition">token_to_xtz</span></a> (<a id="chain:123" class="idref" href="#chain:123"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:124" class="idref" href="#ctx:124"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:125" class="idref" href="#state:125"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="param:126" class="idref" href="#param:126"><span class="id" title="binder">param</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_to_xtz_param"><span class="id" title="record">token_to_xtz_param</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:125"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:126"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ttx_deadline"><span class="id" title="projection">ttx_deadline</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#0f31f5c1c6b6a21a3a187247222bc9e4"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:123"><span class="id" title="variable">chain</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a>))%<span class="id" title="var">nat</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_THE_CURRENT_TIME_MUST_BE_LESS_THAN_THE_DEADLINE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:124"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_AMOUNT_MUST_BE_ZERO&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="xtz_bought:127" class="idref" href="#xtz_bought:127"><span class="id" title="binder">xtz_bought</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:126"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokensSold"><span class="id" title="projection">tokensSold</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 997 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:125"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:125"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 1000 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:126"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokensSold"><span class="id" title="projection">tokensSold</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 997<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_DIV_by_0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_bought:127"><span class="id" title="variable">xtz_bought</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:126"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#minXtzBought"><span class="id" title="projection">minXtzBought</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_XTZ_BOUGHT_MUST_BE_GREATER_THAN_OR_EQUAL_TO_MIN_XTZ_BOUGHT&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="new_xtzPool:128" class="idref" href="#new_xtzPool:128"><span class="id" title="binder">new_xtzPool</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.sub"><span class="id" title="definition">sub</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:125"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_bought:127"><span class="id" title="variable">xtz_bought</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;mutez&nbsp;subtraction&nbsp;run&nbsp;time&nbsp;error&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="op_token:129" class="idref" href="#op_token:129"><span class="id" title="binder">op_token</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.token_transfer"><span class="id" title="definition">token_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:125"><span class="id" title="variable">state</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:124"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:124"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_address"><span class="id" title="projection">ctx_contract_address</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:126"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokensSold"><span class="id" title="projection">tokensSold</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="op_tez:130" class="idref" href="#op_tez:130"><span class="id" title="binder">op_tez</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.xtz_transfer"><span class="id" title="definition">xtz_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:126"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_to"><span class="id" title="projection">xtz_to</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_bought:127"><span class="id" title="variable">xtz_bought</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_state:131" class="idref" href="#new_state:131"><span class="id" title="binder">new_state</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:125"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:125"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:126"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokensSold"><span class="id" title="projection">tokensSold</span></a>) <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_xtzPool:128"><span class="id" title="variable">new_xtzPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_state:131"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op_token:129"><span class="id" title="variable">op_token</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op_tez:130"><span class="id" title="variable">op_tez</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab119"></a><h2 class="section">Default entrypoint</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.default_" class="idref" href="#Dexter2.default_"><span class="id" title="definition">default_</span></a> (<a id="chain:132" class="idref" href="#chain:132"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:133" class="idref" href="#ctx:133"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:134" class="idref" href="#state:134"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:134"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_state:135" class="idref" href="#new_state:135"><span class="id" title="binder">new_state</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:134"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:134"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.amount_to_N"><span class="id" title="definition">amount_to_N</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:133"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>) <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_state:135"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab120"></a><h2 class="section">Set baker</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.set_baker" class="idref" href="#Dexter2.set_baker"><span class="id" title="definition">set_baker</span></a> (<a id="chain:136" class="idref" href="#chain:136"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:137" class="idref" href="#ctx:137"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:138" class="idref" href="#state:138"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="param:139" class="idref" href="#param:139"><span class="id" title="binder">param</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#set_baker_param"><span class="id" title="record">set_baker_param</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:138"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:137"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_AMOUNT_MUST_BE_ZERO&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:137"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:138"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#manager"><span class="id" title="projection">manager</span></a>))) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_ONLY_MANAGER_CAN_SET_BAKER&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:138"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#freezeBaker"><span class="id" title="projection">freezeBaker</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_BAKER_PERMANENTLY_FROZEN&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:138"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#freezeBaker"><span class="id" title="projection">freezeBaker</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:139"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#freezeBaker_"><span class="id" title="projection">freezeBaker_</span></a>) <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NAddr.set_delegate_call"><span class="id" title="axiom">set_delegate_call</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:139"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#baker"><span class="id" title="projection">baker</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab121"></a><h2 class="section">Set manager</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.set_manager" class="idref" href="#Dexter2.set_manager"><span class="id" title="definition">set_manager</span></a> (<a id="chain:140" class="idref" href="#chain:140"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:141" class="idref" href="#ctx:141"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:142" class="idref" href="#state:142"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="new_manager:143" class="idref" href="#new_manager:143"><span class="id" title="binder">new_manager</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:142"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:141"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_AMOUNT_MUST_BE_ZERO&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:141"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:142"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#manager"><span class="id" title="projection">manager</span></a>))) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_ONLY_MANAGER_CAN_SET_MANAGER&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:142"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#manager"><span class="id" title="projection">manager</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_manager:143"><span class="id" title="variable">new_manager</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab122"></a><h2 class="section">Set liquidity address</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.set_lqt_address" class="idref" href="#Dexter2.set_lqt_address"><span class="id" title="definition">set_lqt_address</span></a> (<a id="chain:144" class="idref" href="#chain:144"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:145" class="idref" href="#ctx:145"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:146" class="idref" href="#state:146"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="new_lqt_address:147" class="idref" href="#new_lqt_address:147"><span class="id" title="binder">new_lqt_address</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:146"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:145"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_AMOUNT_MUST_BE_ZERO&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:145"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:146"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#manager"><span class="id" title="projection">manager</span></a>))) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_ONLY_MANAGER_CAN_SET_LQT_ADRESS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:146"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtAddress"><span class="id" title="projection">lqtAddress</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NAddr.null_address"><span class="id" title="axiom">null_address</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_LQT_ADDRESS_ALREADY_SET&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:146"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtAddress"><span class="id" title="projection">lqtAddress</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_lqt_address:147"><span class="id" title="variable">new_lqt_address</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab123"></a><h2 class="section">Update token pool</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.update_token_pool" class="idref" href="#Dexter2.update_token_pool"><span class="id" title="definition">update_token_pool</span></a> (<a id="chain:148" class="idref" href="#chain:148"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:149" class="idref" href="#ctx:149"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:150" class="idref" href="#state:150"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:149"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:149"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_origin"><span class="id" title="projection">ctx_origin</span></a>))) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_CALL_NOT_FROM_AN_IMPLICIT_ACCOUNT&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:149"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_AMOUNT_MUST_BE_ZERO&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:150"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_UNEXPECTED_REENTRANCE_IN_UPDATE_TOKEN_POOL&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="balance_of_request:151" class="idref" href="#balance_of_request:151"><span class="id" title="binder">balance_of_request</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#Build_balance_of_request"><span class="id" title="constructor">FA2LegacyInterface.Build_balance_of_request</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:149"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_address"><span class="id" title="projection">ctx_contract_address</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:150"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenId"><span class="id" title="projection">tokenId</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="balance_of_param:152" class="idref" href="#balance_of_param:152"><span class="id" title="binder">balance_of_param</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#Build_balance_of_param"><span class="id" title="constructor">FA2LegacyInterface.Build_balance_of_param</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#balance_of_request:151"><span class="id" title="variable">balance_of_request</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#Build_callback"><span class="id" title="constructor">FA2LegacyInterface.Build_callback</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:149"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_address"><span class="id" title="projection">ctx_contract_address</span></a>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="op:153" class="idref" href="#op:153"><span class="id" title="binder">op</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.call_to_token"><span class="id" title="definition">call_to_token</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:150"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenAddress"><span class="id" title="projection">tokenAddress</span></a>) 0 (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#msg_balance_of"><span class="id" title="constructor">FA2Token.msg_balance_of</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#balance_of_param:152"><span class="id" title="variable">balance_of_param</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:150"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op:153"><span class="id" title="variable">op</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab124"></a><h2 class="section">Update token pool internal</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.update_token_pool_internal" class="idref" href="#Dexter2.update_token_pool_internal"><span class="id" title="definition">update_token_pool_internal</span></a> (<a id="chain:154" class="idref" href="#chain:154"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:155" class="idref" href="#ctx:155"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:156" class="idref" href="#state:156"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="token_pool:157" class="idref" href="#token_pool:157"><span class="id" title="binder">token_pool</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#update_token_pool_internal_"><span class="id" title="definition">update_token_pool_internal_</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:156"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:155"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:156"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenAddress"><span class="id" title="projection">tokenAddress</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_THIS_ENTRYPOINT_MAY_ONLY_BE_CALLED_BY_GETBALANCE_OF_TOKENADDRESS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:155"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_AMOUNT_MUST_BE_ZERO&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="token_pool:159" class="idref" href="#token_pool:159"><span class="id" title="binder">token_pool</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_pool:157"><span class="id" title="variable">token_pool</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> =&gt; <a class="idref" href="ConCert.Execution.ResultMonad.html#Err"><span class="id" title="constructor">Err</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a> <span class="comment">(*&nbsp;error_INVALID_FA2_BALANCE_RESPONSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <span class="id" title="var">xs</span> =&gt; <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <span class="id" title="var">x</span>.(<a class="idref" href="ConCert.Examples.FA2.FA2LegacyInterface.html#balance"><span class="id" title="projection">balance</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_state:160" class="idref" href="#new_state:160"><span class="id" title="binder">new_state</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:156"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_pool:159"><span class="id" title="variable">token_pool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_state:160"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.call_to_other_token" class="idref" href="#Dexter2.call_to_other_token"><span class="id" title="definition">call_to_other_token</span></a> (<a id="token_addr:161" class="idref" href="#token_addr:161"><span class="id" title="binder">token_addr</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="amount:162" class="idref" href="#amount:162"><span class="id" title="binder">amount</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="msg:163" class="idref" href="#msg:163"><span class="id" title="binder">msg</span></a> : @<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#FA2ReceiverMsg"><span class="id" title="inductive">FA2Token.FA2ReceiverMsg</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DexterMsg"><span class="id" title="inductive">DexterMsg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_addr:161"><span class="id" title="variable">token_addr</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.N_to_amount"><span class="id" title="definition">N_to_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#amount:162"><span class="id" title="variable">amount</span></a>) (<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#msg:163"><span class="id" title="variable">msg</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab125"></a><h2 class="section">Tokens to tokens</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.token_to_token" class="idref" href="#Dexter2.token_to_token"><span class="id" title="definition">token_to_token</span></a> (<a id="chain:164" class="idref" href="#chain:164"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:165" class="idref" href="#ctx:165"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:166" class="idref" href="#state:166"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="param:167" class="idref" href="#param:167"><span class="id" title="binder">param</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#token_to_token_param"><span class="id" title="record">token_to_token_param</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:166"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_SELF_IS_UPDATING_TOKEN_POOL_MUST_BE_FALSE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.non_zero_amount"><span class="id" title="definition">non_zero_amount</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:165"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>)) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_AMOUNT_MUST_BE_ZERO&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.ContractCommon.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ttt_deadline"><span class="id" title="projection">ttt_deadline</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#0f31f5c1c6b6a21a3a187247222bc9e4"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:164"><span class="id" title="variable">chain</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a>))%<span class="id" title="var">nat</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_THE_CURRENT_TIME_MUST_BE_LESS_THAN_THE_DEADLINE&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="xtz_bought:168" class="idref" href="#xtz_bought:168"><span class="id" title="binder">xtz_bought</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.div"><span class="id" title="definition">div</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokensSold_"><span class="id" title="projection">tokensSold_</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 997 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:166"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:166"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 1000 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokensSold_"><span class="id" title="projection">tokensSold_</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> 997<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a>) <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;error_DIV_by_0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <a id="new_xtzPool:169" class="idref" href="#new_xtzPool:169"><span class="id" title="binder">new_xtzPool</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.sub"><span class="id" title="definition">sub</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:166"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_bought:168"><span class="id" title="variable">xtz_bought</span></a> <a class="idref" href="ConCert.Execution.Monad.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;mutez&nbsp;subtraction&nbsp;run&nbsp;time&nbsp;error&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="new_state:170" class="idref" href="#new_state:170"><span class="id" title="binder">new_state</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:166"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:166"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokensSold_"><span class="id" title="projection">tokensSold_</span></a>) <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_xtzPool:169"><span class="id" title="variable">new_xtzPool</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="op1:171" class="idref" href="#op1:171"><span class="id" title="binder">op1</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.token_transfer"><span class="id" title="definition">token_transfer</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:166"><span class="id" title="variable">state</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:165"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:165"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_address"><span class="id" title="projection">ctx_contract_address</span></a>) <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokensSold_"><span class="id" title="projection">tokensSold_</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="op2:172" class="idref" href="#op2:172"><span class="id" title="binder">op2</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.call_to_other_token"><span class="id" title="definition">call_to_other_token</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#outputDexterContract"><span class="id" title="projection">outputDexterContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtz_bought:168"><span class="id" title="variable">xtz_bought</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#XtzToToken"><span class="id" title="constructor">XtzToToken</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokens_to"><span class="id" title="projection">tokens_to</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#to_"><span class="id" title="projection">to_</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#minTokensBought"><span class="id" title="projection">minTokensBought</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#minTokensBought_"><span class="id" title="projection">minTokensBought_</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtt_deadline"><span class="id" title="projection">xtt_deadline</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#param:167"><span class="id" title="variable">param</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ttt_deadline"><span class="id" title="projection">ttt_deadline</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#new_state:170"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op1:171"><span class="id" title="variable">op1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#op2:172"><span class="id" title="variable">op2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab126"></a><h2 class="section">Receive</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.receive_cpmm" class="idref" href="#Dexter2.receive_cpmm"><span class="id" title="definition">receive_cpmm</span></a> (<a id="chain:173" class="idref" href="#chain:173"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:174" class="idref" href="#ctx:174"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="state:175" class="idref" href="#state:175"><span class="id" title="binder">state</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="maybe_msg:176" class="idref" href="#maybe_msg:176"><span class="id" title="binder">maybe_msg</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Msg"><span class="id" title="definition">Msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.Result"><span class="id" title="definition">Result</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#maybe_msg:176"><span class="id" title="variable">maybe_msg</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#AddLiquidity"><span class="id" title="constructor">AddLiquidity</span></a> <span class="id" title="var">param</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.add_liquidity"><span class="id" title="definition">add_liquidity</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#RemoveLiquidity"><span class="id" title="constructor">RemoveLiquidity</span></a> <span class="id" title="var">param</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.remove_liquidity"><span class="id" title="definition">remove_liquidity</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#SetBaker"><span class="id" title="constructor">SetBaker</span></a> <span class="id" title="var">param</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.set_baker"><span class="id" title="definition">set_baker</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#SetManager"><span class="id" title="constructor">SetManager</span></a> <span class="id" title="var">param</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.set_manager"><span class="id" title="definition">set_manager</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#SetLqtAddress"><span class="id" title="constructor">SetLqtAddress</span></a> <span class="id" title="var">param</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.set_lqt_address"><span class="id" title="definition">set_lqt_address</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.default_"><span class="id" title="definition">default_</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#UpdateTokenPool"><span class="id" title="constructor">UpdateTokenPool</span></a>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.update_token_pool"><span class="id" title="definition">update_token_pool</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#XtzToToken"><span class="id" title="constructor">XtzToToken</span></a> <span class="id" title="var">param</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.xtz_to_token"><span class="id" title="definition">xtz_to_token</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#TokenToXtz"><span class="id" title="constructor">TokenToXtz</span></a> <span class="id" title="var">param</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.token_to_xtz"><span class="id" title="definition">token_to_xtz</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#other_msg"><span class="id" title="constructor">FA2Token.other_msg</span></a> (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#TokenToToken"><span class="id" title="constructor">TokenToToken</span></a> <span class="id" title="var">param</span>)) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.token_to_token"><span class="id" title="definition">token_to_token</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">param</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.FA2.FA2Token.html#receive_balance_of_param"><span class="id" title="constructor">FA2Token.receive_balance_of_param</span></a> <span class="id" title="var">responses</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.update_token_pool_internal"><span class="id" title="definition">update_token_pool_internal</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#chain:173"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#ctx:174"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#state:175"><span class="id" title="variable">state</span></a> <span class="id" title="var">responses</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="ConCert.Execution.ResultMonad.html#Err"><span class="id" title="constructor">Err</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#default_error"><span class="id" title="definition">default_error</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab127"></a><h2 class="section">Init</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.init_cpmm" class="idref" href="#Dexter2.init_cpmm"><span class="id" title="definition">init_cpmm</span></a> (<a id="chain:178" class="idref" href="#chain:178"><span class="id" title="binder">chain</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="ctx:179" class="idref" href="#ctx:179"><span class="id" title="binder">ctx</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="setup:180" class="idref" href="#setup:180"><span class="id" title="binder">setup</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Setup"><span class="id" title="record">Setup</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="ConCert.Execution.ResultMonad.html#result"><span class="id" title="inductive">result</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenPool"><span class="id" title="projection">tokenPool</span></a> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#xtzPool"><span class="id" title="projection">xtzPool</span></a> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal"><span class="id" title="projection">lqtTotal</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#setup:180"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtTotal_"><span class="id" title="projection">lqtTotal_</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#selfIsUpdatingTokenPool"><span class="id" title="projection">selfIsUpdatingTokenPool</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#freezeBaker"><span class="id" title="projection">freezeBaker</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#manager"><span class="id" title="projection">manager</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#setup:180"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#manager_"><span class="id" title="projection">manager_</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenAddress"><span class="id" title="projection">tokenAddress</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#setup:180"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenAddress_"><span class="id" title="projection">tokenAddress_</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenId"><span class="id" title="projection">tokenId</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#setup:180"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#tokenId_"><span class="id" title="projection">tokenId_</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#lqtAddress"><span class="id" title="projection">lqtAddress</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NAddr.null_address"><span class="id" title="axiom">null_address</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="Dexter2.contract" class="idref" href="#Dexter2.contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Contract"><span class="id" title="record">Contract</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Setup"><span class="id" title="record">Setup</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Msg"><span class="id" title="definition">Msg</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#State"><span class="id" title="record">State</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Error"><span class="id" title="definition">Error</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#build_contract"><span class="id" title="constructor">build_contract</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.init_cpmm"><span class="id" title="definition">init_cpmm</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.receive_cpmm"><span class="id" title="definition">receive_cpmm</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2.DexterDefs"><span class="id" title="section">DexterDefs</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2"><span class="id" title="module">Dexter2</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="DSInstances" class="idref" href="#DSInstances"><span class="id" title="module">DSInstances</span></a> &lt;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2Serializable"><span class="id" title="module">Dexter2Serializable</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Serialisation&nbsp;instances&nbsp;(omitted).<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTE:&nbsp;we&nbsp;use&nbsp;<span class="inlinecode">&lt;:</span>&nbsp;to&nbsp;make&nbsp;the&nbsp;definitions&nbsp;transparent,&nbsp;so&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implementation&nbsp;details&nbsp;can&nbsp;be&nbsp;revealed,&nbsp;if&nbsp;needed&nbsp;*)</span><br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DSInstances"><span class="id" title="module">DSInstances</span></a>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <a id="NullAddressAxiom" class="idref" href="#NullAddressAxiom"><span class="id" title="module">NullAddressAxiom</span></a> &lt;: <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddress"><span class="id" title="module">NullAddress</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <a id="NullAddressAxiom.NAddr" class="idref" href="#NullAddressAxiom.NAddr"><span class="id" title="section">NAddr</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="NullAddressAxiom.BaseTypes" class="idref" href="#NullAddressAxiom.BaseTypes"><span class="id" title="axiom">BaseTypes</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Existing Instance</span> <span class="id" title="var">BaseTypes</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="NullAddressAxiom.null_address" class="idref" href="#NullAddressAxiom.null_address"><span class="id" title="axiom">null_address</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Parameter</span> <a id="NullAddressAxiom.set_delegate_call" class="idref" href="#NullAddressAxiom.set_delegate_call"><span class="id" title="axiom">set_delegate_call</span></a> : <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#baker_address"><span class="id" title="definition">baker_address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Axiom</span> <a id="NullAddressAxiom.delegate_call" class="idref" href="#NullAddressAxiom.delegate_call"><span class="id" title="axiom">delegate_call</span></a> : <span class="id" title="keyword">forall</span> <a id="addr:196" class="idref" href="#addr:196"><span class="id" title="binder">addr</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> <a id="action:197" class="idref" href="#action:197"><span class="id" title="binder">action</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#action:197"><span class="id" title="variable">action</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Blockchain.html#act_deploy"><span class="id" title="constructor">act_deploy</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>) (<a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddressAxiom.set_delegate_call"><span class="id" title="axiom">set_delegate_call</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#addr:196"><span class="id" title="variable">addr</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddressAxiom.NAddr"><span class="id" title="section">NAddr</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddressAxiom"><span class="id" title="module">NullAddressAxiom</span></a>.<br/>

<br/>
</div>

<div class="doc">
Instantiating the implementaion with required instances for serialisation/deserialisation 
</div>
<div class="code">
<span class="id" title="keyword">Module</span> <a id="DEX2" class="idref" href="#DEX2"><span class="id" title="module">DEX2</span></a> := <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#Dexter2"><span class="id" title="module">Dexter2</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#DSInstances"><span class="id" title="module">DSInstances</span></a> <a class="idref" href="ConCert.Examples.Dexter2.Dexter2CPMM.html#NullAddressAxiom"><span class="id" title="module">NullAddressAxiom</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="https://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a> and <a href="https://github.com/jgallen23/toc">TOC</a>
</div>
</div>
<script>
  const elements = document.getElementsByClassName("libtitle");
  while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
  }
  if (window.location.pathname.endsWith("/toc.html")) {
      const jstocDiv = document.getElementById("js-toc");
      jstocDiv.classList.remove("toc");
      jstocDiv.classList.add("jstoc-hidden");
      const jstocHeaderDiv = document.getElementById("js-toc-header");
      jstocHeaderDiv.classList.add("jstoc-hidden");
      const mainDiv = document.getElementById("main");
      mainDiv.classList.add("jstoc-hidden-main");
      const toggleDiv = document.getElementById("toggle-toc");
      toggleDiv.classList.add("jstoc-hidden");
  }
  console.log(window.location.pathname);
</script>
<script type="text/javascript" src="toc.js"></script>
</body>

</html>
