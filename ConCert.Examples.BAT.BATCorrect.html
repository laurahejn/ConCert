<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<link href="toc.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
      <span id="toggle-toc">Contents</span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="https://github.com/AU-COBRA/ConCert" target="_balnk">Project Page</a>
      <a href="index.html">Index</a>
      <a href="toc.html">Table of contents</a>
    </span>
</div>
  <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="js-toc" class="toc" data-toc="h1,h2,h3,h4" data-toc-container="doc" data-toc-offset="-40">
      <div id="js-toc-header" class="toc-header">Contents:</div>
    </div>
    <div id="main">
<h1 class="libtitle">Library ConCert.Examples.BAT.BATCorrect</h1>

<div class="code">
</div>

<div class="doc">
<a id="lab176"></a><h1 class="section">Basic Attention Token contract</h1>
 Proofs for BAToken contract defined in <span class="inlinecode"><a class="idref" href="ConCert.Examples.BAT.BAT.html#"><span class="id" title="library">ConCert.Examples.BAT.BAT</span></a></span>. 
</div>
<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>. <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ListNotations"><span class="id" title="module">ListNotations</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.ZArith_base.html#"><span class="id" title="library">ZArith_base</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.Automation.html#"><span class="id" title="library">Automation</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.Extras.html#"><span class="id" title="library">Extras</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.RecordUpdate.html#"><span class="id" title="library">RecordUpdate</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Blockchain.html#"><span class="id" title="library">Blockchain</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#"><span class="id" title="library">BuildUtils</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Containers.html#"><span class="id" title="library">Containers</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Serializable.html#"><span class="id" title="library">Serializable</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.ContractCommon.html#"><span class="id" title="library">ContractCommon</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.ResultMonad.html#"><span class="id" title="library">ResultMonad</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.BAT</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#"><span class="id" title="library">BATCommon</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.BAT</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Examples.BAT.BAT.html#"><span class="id" title="library">BAT</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.EIP20</span> <span class="id" title="keyword">Require</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20Token.html#"><span class="id" title="library">EIP20Token</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.EIP20</span> <span class="id" title="keyword">Require</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#"><span class="id" title="library">EIP20TokenCorrect</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab177"></a><h1 class="section">Contract properties</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a id="Theories" class="idref" href="#Theories"><span class="id" title="section">Theories</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;begind&nbsp;hide&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="BaseTypes:1" class="idref" href="#BaseTypes:1"><span class="id" title="binder">BaseTypes</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">N_scope</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Tactics&nbsp;to&nbsp;simplify&nbsp;proof&nbsp;steps&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Tactic Notation</span> "contract_simpl" := <span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a> <span class="id" title="tactic">in</span> *; <span class="id" title="var">contract_simpl</span> <a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">destruct_message</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">msg</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#Msg"><span class="id" title="inductive">Msg</span></a> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">msg</span> : <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#Msg"><span class="id" title="inductive">Msg</span></a> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">msg</span> : <a class="idref" href="ConCert.Examples.EIP20.EIP20Token.html#Msg"><span class="id" title="inductive">EIP20Token.Msg</span></a> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#receive"><span class="id" title="projection">Blockchain.receive</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;end&nbsp;hide&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
<a id="lab178"></a><h2 class="section">Transfer correct</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_balance_correct" class="idref" href="#try_transfer_balance_correct"><span class="id" title="lemma">try_transfer_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:2" class="idref" href="#prev_state:2"><span class="id" title="binder">prev_state</span></a> <a id="new_state:3" class="idref" href="#new_state:3"><span class="id" title="binder">new_state</span></a> <a id="chain:4" class="idref" href="#chain:4"><span class="id" title="binder">chain</span></a> <a id="ctx:5" class="idref" href="#ctx:5"><span class="id" title="binder">ctx</span></a> <a id="to:6" class="idref" href="#to:6"><span class="id" title="binder">to</span></a> <a id="amount:7" class="idref" href="#amount:7"><span class="id" title="binder">amount</span></a> <a id="new_acts:8" class="idref" href="#new_acts:8"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:4"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:5"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:2"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:6"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:7"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:3"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:8"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#transfer_balance_update_correct"><span class="id" title="definition">EIP20TokenCorrect.transfer_balance_update_correct</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:2"><span class="id" title="variable">prev_state</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:3"><span class="id" title="variable">new_state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:5"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:6"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:7"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_balance_correct"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_balance_correct</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_preserves_total_supply" class="idref" href="#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:9" class="idref" href="#prev_state:9"><span class="id" title="binder">prev_state</span></a> <a id="new_state:10" class="idref" href="#new_state:10"><span class="id" title="binder">new_state</span></a> <a id="chain:11" class="idref" href="#chain:11"><span class="id" title="binder">chain</span></a> <a id="ctx:12" class="idref" href="#ctx:12"><span class="id" title="binder">ctx</span></a> <a id="to:13" class="idref" href="#to:13"><span class="id" title="binder">to</span></a> <a id="amount:14" class="idref" href="#amount:14"><span class="id" title="binder">amount</span></a> <a id="new_acts:15" class="idref" href="#new_acts:15"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:11"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:12"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:9"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:13"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:14"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:10"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:15"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:9"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:10"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_preserves_total_supply</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_preserves_allowances" class="idref" href="#try_transfer_preserves_allowances"><span class="id" title="lemma">try_transfer_preserves_allowances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:16" class="idref" href="#prev_state:16"><span class="id" title="binder">prev_state</span></a> <a id="new_state:17" class="idref" href="#new_state:17"><span class="id" title="binder">new_state</span></a> <a id="chain:18" class="idref" href="#chain:18"><span class="id" title="binder">chain</span></a> <a id="ctx:19" class="idref" href="#ctx:19"><span class="id" title="binder">ctx</span></a> <a id="to:20" class="idref" href="#to:20"><span class="id" title="binder">to</span></a> <a id="amount:21" class="idref" href="#amount:21"><span class="id" title="binder">amount</span></a> <a id="new_acts:22" class="idref" href="#new_acts:22"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:18"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:19"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:16"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:20"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:21"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:17"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:22"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:16"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:17"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_preserves_allowances"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_preserves_allowances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_preserves_other_balances" class="idref" href="#try_transfer_preserves_other_balances"><span class="id" title="lemma">try_transfer_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:23" class="idref" href="#prev_state:23"><span class="id" title="binder">prev_state</span></a> <a id="new_state:24" class="idref" href="#new_state:24"><span class="id" title="binder">new_state</span></a> <a id="chain:25" class="idref" href="#chain:25"><span class="id" title="binder">chain</span></a> <a id="ctx:26" class="idref" href="#ctx:26"><span class="id" title="binder">ctx</span></a> <a id="to:27" class="idref" href="#to:27"><span class="id" title="binder">to</span></a> <a id="amount:28" class="idref" href="#amount:28"><span class="id" title="binder">amount</span></a> <a id="new_acts:29" class="idref" href="#new_acts:29"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:25"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:26"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:23"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:27"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:28"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:24"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:29"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:30" class="idref" href="#account:30"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:30"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:26"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:30"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:27"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:30"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:23"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:30"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:24"><span class="id" title="variable">new_state</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span> <span class="id" title="var">account_not_to</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_preserves_other_balances"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_preserves_other_balances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_is_some" class="idref" href="#try_transfer_is_some"><span class="id" title="lemma">try_transfer_is_some</span></a> : <span class="id" title="keyword">forall</span> <a id="state:31" class="idref" href="#state:31"><span class="id" title="binder">state</span></a> <a id="chain:32" class="idref" href="#chain:32"><span class="id" title="binder">chain</span></a> <a id="ctx:33" class="idref" href="#ctx:33"><span class="id" title="binder">ctx</span></a> <a id="to:34" class="idref" href="#to:34"><span class="id" title="binder">to</span></a> <a id="amount:35" class="idref" href="#amount:35"><span class="id" title="binder">amount</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:33"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:35"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:33"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:31"><span class="id" title="variable">state</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#isOk"><span class="id" title="definition">isOk</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:32"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:33"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:31"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:34"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:35"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_is_some"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_is_some</span></a>, <a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab179"></a><h2 class="section">Transfer_from correct</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_from_balance_correct" class="idref" href="#try_transfer_from_balance_correct"><span class="id" title="lemma">try_transfer_from_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:36" class="idref" href="#prev_state:36"><span class="id" title="binder">prev_state</span></a> <a id="new_state:37" class="idref" href="#new_state:37"><span class="id" title="binder">new_state</span></a> <a id="chain:38" class="idref" href="#chain:38"><span class="id" title="binder">chain</span></a> <a id="ctx:39" class="idref" href="#ctx:39"><span class="id" title="binder">ctx</span></a> <a id="from:40" class="idref" href="#from:40"><span class="id" title="binder">from</span></a> <a id="to:41" class="idref" href="#to:41"><span class="id" title="binder">to</span></a> <a id="amount:42" class="idref" href="#amount:42"><span class="id" title="binder">amount</span></a> <a id="new_acts:43" class="idref" href="#new_acts:43"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:38"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:39"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:36"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:40"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:41"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:42"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:37"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:43"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#transfer_balance_update_correct"><span class="id" title="definition">EIP20TokenCorrect.transfer_balance_update_correct</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:36"><span class="id" title="variable">prev_state</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:37"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:40"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:41"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:42"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#transfer_from_allowances_update_correct"><span class="id" title="definition">EIP20TokenCorrect.transfer_from_allowances_update_correct</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:36"><span class="id" title="variable">prev_state</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:37"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:40"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:39"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:42"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_from_balance_correct"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_from_balance_correct</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_from_preserves_total_supply" class="idref" href="#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:44" class="idref" href="#prev_state:44"><span class="id" title="binder">prev_state</span></a> <a id="new_state:45" class="idref" href="#new_state:45"><span class="id" title="binder">new_state</span></a> <a id="chain:46" class="idref" href="#chain:46"><span class="id" title="binder">chain</span></a> <a id="ctx:47" class="idref" href="#ctx:47"><span class="id" title="binder">ctx</span></a> <a id="from:48" class="idref" href="#from:48"><span class="id" title="binder">from</span></a> <a id="to:49" class="idref" href="#to:49"><span class="id" title="binder">to</span></a> <a id="amount:50" class="idref" href="#amount:50"><span class="id" title="binder">amount</span></a> <a id="new_acts:51" class="idref" href="#new_acts:51"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:46"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:47"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:44"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:48"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:49"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:50"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:45"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:51"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:44"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:45"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_from_preserves_total_supply</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_from_preserves_other_balances" class="idref" href="#try_transfer_from_preserves_other_balances"><span class="id" title="lemma">try_transfer_from_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:52" class="idref" href="#prev_state:52"><span class="id" title="binder">prev_state</span></a> <a id="new_state:53" class="idref" href="#new_state:53"><span class="id" title="binder">new_state</span></a> <a id="chain:54" class="idref" href="#chain:54"><span class="id" title="binder">chain</span></a> <a id="ctx:55" class="idref" href="#ctx:55"><span class="id" title="binder">ctx</span></a> <a id="from:56" class="idref" href="#from:56"><span class="id" title="binder">from</span></a> <a id="to:57" class="idref" href="#to:57"><span class="id" title="binder">to</span></a> <a id="amount:58" class="idref" href="#amount:58"><span class="id" title="binder">amount</span></a> <a id="new_acts:59" class="idref" href="#new_acts:59"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:54"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:55"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:52"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:56"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:57"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:58"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:53"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:59"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:60" class="idref" href="#account:60"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:60"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:56"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:60"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:57"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:60"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:52"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:60"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:53"><span class="id" title="variable">new_state</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_from_preserves_other_balances"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_from_preserves_other_balances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_from_preserves_other_allowances" class="idref" href="#try_transfer_from_preserves_other_allowances"><span class="id" title="lemma">try_transfer_from_preserves_other_allowances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:61" class="idref" href="#prev_state:61"><span class="id" title="binder">prev_state</span></a> <a id="new_state:62" class="idref" href="#new_state:62"><span class="id" title="binder">new_state</span></a> <a id="chain:63" class="idref" href="#chain:63"><span class="id" title="binder">chain</span></a> <a id="ctx:64" class="idref" href="#ctx:64"><span class="id" title="binder">ctx</span></a> <a id="from:65" class="idref" href="#from:65"><span class="id" title="binder">from</span></a> <a id="to:66" class="idref" href="#to:66"><span class="id" title="binder">to</span></a> <a id="amount:67" class="idref" href="#amount:67"><span class="id" title="binder">amount</span></a> <a id="new_acts:68" class="idref" href="#new_acts:68"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:63"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:64"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:61"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:65"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:66"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:67"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:62"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:68"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:69" class="idref" href="#account:69"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:69"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:65"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:69"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:61"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:69"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:62"><span class="id" title="variable">new_state</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_from_preserves_other_allowances"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_from_preserves_other_allowances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_from_preserves_other_allowance" class="idref" href="#try_transfer_from_preserves_other_allowance"><span class="id" title="lemma">try_transfer_from_preserves_other_allowance</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:70" class="idref" href="#prev_state:70"><span class="id" title="binder">prev_state</span></a> <a id="new_state:71" class="idref" href="#new_state:71"><span class="id" title="binder">new_state</span></a> <a id="chain:72" class="idref" href="#chain:72"><span class="id" title="binder">chain</span></a> <a id="ctx:73" class="idref" href="#ctx:73"><span class="id" title="binder">ctx</span></a> <a id="from:74" class="idref" href="#from:74"><span class="id" title="binder">from</span></a> <a id="to:75" class="idref" href="#to:75"><span class="id" title="binder">to</span></a> <a id="amount:76" class="idref" href="#amount:76"><span class="id" title="binder">amount</span></a> <a id="new_acts:77" class="idref" href="#new_acts:77"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:72"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:73"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:70"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:74"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:75"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:76"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:71"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:77"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:78" class="idref" href="#account:78"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:78"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:73"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#get_allowance"><span class="id" title="abbreviation">get_allowance</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:70"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:74"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:78"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#get_allowance"><span class="id" title="abbreviation">get_allowance</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:71"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:74"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:78"><span class="id" title="variable">account</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_from_preserves_other_allowance"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_from_preserves_other_allowance</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_from_is_some" class="idref" href="#try_transfer_from_is_some"><span class="id" title="lemma">try_transfer_from_is_some</span></a> : <span class="id" title="keyword">forall</span> <a id="state:79" class="idref" href="#state:79"><span class="id" title="binder">state</span></a> <a id="chain:80" class="idref" href="#chain:80"><span class="id" title="binder">chain</span></a> <a id="ctx:81" class="idref" href="#ctx:81"><span class="id" title="binder">ctx</span></a> <a id="from:82" class="idref" href="#from:82"><span class="id" title="binder">from</span></a> <a id="to:83" class="idref" href="#to:83"><span class="id" title="binder">to</span></a> <a id="amount:84" class="idref" href="#amount:84"><span class="id" title="binder">amount</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="get_allowance_:86" class="idref" href="#get_allowance_:86"><span class="id" title="binder">get_allowance_</span></a> <a id="account:85" class="idref" href="#account:85"><span class="id" title="binder">account</span></a> := <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:85"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> (@<a class="idref" href="ConCert.Execution.Containers.html#FMap.empty"><span class="id" title="abbreviation">FMap.empty</span></a> (<a class="idref" href="ConCert.Execution.Containers.html#FMap"><span class="id" title="abbreviation">FMap</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>) <span class="id" title="var">_</span>) (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:82"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:79"><span class="id" title="variable">state</span></a>))) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:81"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:82"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:79"><span class="id" title="variable">state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Utils.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#get_allowance_:86"><span class="id" title="variable">get_allowance_</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:81"><span class="id" title="variable">ctx</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:84"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:82"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:79"><span class="id" title="variable">state</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:84"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#get_allowance_:86"><span class="id" title="variable">get_allowance_</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:81"><span class="id" title="variable">ctx</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#isOk"><span class="id" title="definition">isOk</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:80"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:81"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:79"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:82"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:83"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:84"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">amount_zero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a>, <span class="id" title="var">get_allowance_</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_from_is_some"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_from_is_some</span></a>, <a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab180"></a><h2 class="section">Approve correct</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_approve_allowance_correct" class="idref" href="#try_approve_allowance_correct"><span class="id" title="lemma">try_approve_allowance_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:87" class="idref" href="#prev_state:87"><span class="id" title="binder">prev_state</span></a> <a id="new_state:88" class="idref" href="#new_state:88"><span class="id" title="binder">new_state</span></a> <a id="chain:89" class="idref" href="#chain:89"><span class="id" title="binder">chain</span></a> <a id="ctx:90" class="idref" href="#ctx:90"><span class="id" title="binder">ctx</span></a> <a id="delegate:91" class="idref" href="#delegate:91"><span class="id" title="binder">delegate</span></a> <a id="amount:92" class="idref" href="#amount:92"><span class="id" title="binder">amount</span></a> <a id="new_acts:93" class="idref" href="#new_acts:93"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:89"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:90"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:87"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:91"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:92"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:88"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:93"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#approve_allowance_update_correct"><span class="id" title="definition">EIP20TokenCorrect.approve_allowance_update_correct</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:88"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:90"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:91"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:92"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_approve_allowance_correct"><span class="id" title="lemma">EIP20TokenCorrect.try_approve_allowance_correct</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_approve_preserves_total_supply" class="idref" href="#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:94" class="idref" href="#prev_state:94"><span class="id" title="binder">prev_state</span></a> <a id="new_state:95" class="idref" href="#new_state:95"><span class="id" title="binder">new_state</span></a> <a id="chain:96" class="idref" href="#chain:96"><span class="id" title="binder">chain</span></a> <a id="ctx:97" class="idref" href="#ctx:97"><span class="id" title="binder">ctx</span></a> <a id="delegate:98" class="idref" href="#delegate:98"><span class="id" title="binder">delegate</span></a> <a id="amount:99" class="idref" href="#amount:99"><span class="id" title="binder">amount</span></a> <a id="new_acts:100" class="idref" href="#new_acts:100"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:96"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:97"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:94"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:98"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:99"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:95"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:100"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:94"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:95"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_approve_preserves_total_supply"><span class="id" title="lemma">EIP20TokenCorrect.try_approve_preserves_total_supply</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_approve_preserves_balances" class="idref" href="#try_approve_preserves_balances"><span class="id" title="lemma">try_approve_preserves_balances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:101" class="idref" href="#prev_state:101"><span class="id" title="binder">prev_state</span></a> <a id="new_state:102" class="idref" href="#new_state:102"><span class="id" title="binder">new_state</span></a> <a id="chain:103" class="idref" href="#chain:103"><span class="id" title="binder">chain</span></a> <a id="ctx:104" class="idref" href="#ctx:104"><span class="id" title="binder">ctx</span></a> <a id="delegate:105" class="idref" href="#delegate:105"><span class="id" title="binder">delegate</span></a> <a id="amount:106" class="idref" href="#amount:106"><span class="id" title="binder">amount</span></a> <a id="new_acts:107" class="idref" href="#new_acts:107"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:103"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:104"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:101"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:105"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:106"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:102"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:107"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:101"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:102"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_approve_preserves_balances"><span class="id" title="lemma">EIP20TokenCorrect.try_approve_preserves_balances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_approve_preserves_other_allowances" class="idref" href="#try_approve_preserves_other_allowances"><span class="id" title="lemma">try_approve_preserves_other_allowances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:108" class="idref" href="#prev_state:108"><span class="id" title="binder">prev_state</span></a> <a id="new_state:109" class="idref" href="#new_state:109"><span class="id" title="binder">new_state</span></a> <a id="chain:110" class="idref" href="#chain:110"><span class="id" title="binder">chain</span></a> <a id="ctx:111" class="idref" href="#ctx:111"><span class="id" title="binder">ctx</span></a> <a id="delegate:112" class="idref" href="#delegate:112"><span class="id" title="binder">delegate</span></a> <a id="amount:113" class="idref" href="#amount:113"><span class="id" title="binder">amount</span></a> <a id="new_acts:114" class="idref" href="#new_acts:114"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:110"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:111"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:108"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:112"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:113"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:109"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:114"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:115" class="idref" href="#account:115"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:115"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:111"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:115"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:108"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:115"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:109"><span class="id" title="variable">new_state</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_approve_preserves_other_allowances"><span class="id" title="lemma">EIP20TokenCorrect.try_approve_preserves_other_allowances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_approve_preserves_other_allowance" class="idref" href="#try_approve_preserves_other_allowance"><span class="id" title="lemma">try_approve_preserves_other_allowance</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:116" class="idref" href="#prev_state:116"><span class="id" title="binder">prev_state</span></a> <a id="new_state:117" class="idref" href="#new_state:117"><span class="id" title="binder">new_state</span></a> <a id="chain:118" class="idref" href="#chain:118"><span class="id" title="binder">chain</span></a> <a id="ctx:119" class="idref" href="#ctx:119"><span class="id" title="binder">ctx</span></a> <a id="delegate:120" class="idref" href="#delegate:120"><span class="id" title="binder">delegate</span></a> <a id="amount:121" class="idref" href="#amount:121"><span class="id" title="binder">amount</span></a> <a id="new_acts:122" class="idref" href="#new_acts:122"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:118"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:119"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:116"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:120"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:121"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:117"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:122"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:123" class="idref" href="#account:123"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:123"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:120"><span class="id" title="variable">delegate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#get_allowance"><span class="id" title="abbreviation">get_allowance</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:116"><span class="id" title="variable">prev_state</span></a>) (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:119"><span class="id" title="variable">ctx</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:123"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#get_allowance"><span class="id" title="abbreviation">get_allowance</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:117"><span class="id" title="variable">new_state</span></a>) (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:119"><span class="id" title="variable">ctx</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:123"><span class="id" title="variable">account</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_approve_preserves_other_allowance"><span class="id" title="lemma">EIP20TokenCorrect.try_approve_preserves_other_allowance</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_approve_is_some" class="idref" href="#try_approve_is_some"><span class="id" title="lemma">try_approve_is_some</span></a> : <span class="id" title="keyword">forall</span> <a id="state:124" class="idref" href="#state:124"><span class="id" title="binder">state</span></a> <a id="chain:125" class="idref" href="#chain:125"><span class="id" title="binder">chain</span></a> <a id="ctx:126" class="idref" href="#ctx:126"><span class="id" title="binder">ctx</span></a> <a id="delegate:127" class="idref" href="#delegate:127"><span class="id" title="binder">delegate</span></a> <a id="amount:128" class="idref" href="#amount:128"><span class="id" title="binder">amount</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:126"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#isOk"><span class="id" title="definition">isOk</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:125"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:126"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:124"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:127"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:128"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_approve_is_some"><span class="id" title="lemma">EIP20TokenCorrect.try_approve_is_some</span></a>, <a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab181"></a><h2 class="section">EIP20 functions only changes token_state</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="eip_only_changes_token_state" class="idref" href="#eip_only_changes_token_state"><span class="id" title="lemma">eip_only_changes_token_state</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:129" class="idref" href="#prev_state:129"><span class="id" title="binder">prev_state</span></a> <a id="new_state:130" class="idref" href="#new_state:130"><span class="id" title="binder">new_state</span></a> <a id="chain:131" class="idref" href="#chain:131"><span class="id" title="binder">chain</span></a> <a id="ctx:132" class="idref" href="#ctx:132"><span class="id" title="binder">ctx</span></a> <a id="m:133" class="idref" href="#m:133"><span class="id" title="binder">m</span></a> <a id="new_acts:134" class="idref" href="#new_acts:134"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:131"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:132"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:129"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenMsg"><span class="id" title="constructor">tokenMsg</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#m:133"><span class="id" title="variable">m</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:130"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:134"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:129"><span class="id" title="variable">prev_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:130"><span class="id" title="variable">new_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:130"><span class="id" title="variable">new_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab182"></a><h2 class="section">EIP20 functions not payable</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="eip20_not_payable" class="idref" href="#eip20_not_payable"><span class="id" title="lemma">eip20_not_payable</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:135" class="idref" href="#prev_state:135"><span class="id" title="binder">prev_state</span></a> <a id="new_state:136" class="idref" href="#new_state:136"><span class="id" title="binder">new_state</span></a> <a id="chain:137" class="idref" href="#chain:137"><span class="id" title="binder">chain</span></a> <a id="ctx:138" class="idref" href="#ctx:138"><span class="id" title="binder">ctx</span></a> <a id="m:139" class="idref" href="#m:139"><span class="id" title="binder">m</span></a> <a id="new_acts:140" class="idref" href="#new_acts:140"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:137"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:138"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:135"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenMsg"><span class="id" title="constructor">tokenMsg</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#m:139"><span class="id" title="variable">m</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:136"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:140"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:138"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> 0)%<span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#EIP20_not_payable"><span class="id" title="lemma">EIP20TokenCorrect.EIP20_not_payable</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab183"></a><h2 class="section">EIP20 functions produces no acts</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="eip20_new_acts_correct" class="idref" href="#eip20_new_acts_correct"><span class="id" title="lemma">eip20_new_acts_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:141" class="idref" href="#prev_state:141"><span class="id" title="binder">prev_state</span></a> <a id="new_state:142" class="idref" href="#new_state:142"><span class="id" title="binder">new_state</span></a> <a id="chain:143" class="idref" href="#chain:143"><span class="id" title="binder">chain</span></a> <a id="ctx:144" class="idref" href="#ctx:144"><span class="id" title="binder">ctx</span></a> <a id="m:145" class="idref" href="#m:145"><span class="id" title="binder">m</span></a> <a id="new_acts:146" class="idref" href="#new_acts:146"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:143"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:144"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:141"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenMsg"><span class="id" title="constructor">tokenMsg</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#m:145"><span class="id" title="variable">m</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:142"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:146"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:146"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#EIP20_no_acts"><span class="id" title="lemma">EIP20TokenCorrect.EIP20_no_acts</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab184"></a><h2 class="section">Create_tokens correct</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_balance_correct" class="idref" href="#try_create_tokens_balance_correct"><span class="id" title="lemma">try_create_tokens_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:147" class="idref" href="#prev_state:147"><span class="id" title="binder">prev_state</span></a> <a id="new_state:148" class="idref" href="#new_state:148"><span class="id" title="binder">new_state</span></a> <a id="chain:149" class="idref" href="#chain:149"><span class="id" title="binder">chain</span></a> <a id="ctx:150" class="idref" href="#ctx:150"><span class="id" title="binder">ctx</span></a> <a id="new_acts:151" class="idref" href="#new_acts:151"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:149"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:150"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:147"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:148"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:151"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:150"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:147"><span class="id" title="variable">prev_state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:150"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:148"><span class="id" title="variable">new_state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:150"><span class="id" title="variable">ctx</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:147"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#add_is_partial_alter_plus"><span class="id" title="lemma">EIP20TokenCorrect.add_is_partial_alter_plus</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <span class="id" title="var">prev_state</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">from_balance</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">from_balance</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add"><span class="id" title="lemma">FMap.find_add</span></a>; <span class="id" title="var">cbn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_sub"><span class="id" title="lemma">N.add_sub</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_total_supply_correct" class="idref" href="#try_create_tokens_total_supply_correct"><span class="id" title="lemma">try_create_tokens_total_supply_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:152" class="idref" href="#prev_state:152"><span class="id" title="binder">prev_state</span></a> <a id="new_state:153" class="idref" href="#new_state:153"><span class="id" title="binder">new_state</span></a> <a id="chain:154" class="idref" href="#chain:154"><span class="id" title="binder">chain</span></a> <a id="ctx:155" class="idref" href="#ctx:155"><span class="id" title="binder">ctx</span></a> <a id="new_acts:156" class="idref" href="#new_acts:156"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:154"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:155"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:152"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:153"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:156"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:152"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:155"><span class="id" title="variable">ctx</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:152"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:153"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_preserves_other_balances" class="idref" href="#try_create_tokens_preserves_other_balances"><span class="id" title="lemma">try_create_tokens_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:157" class="idref" href="#prev_state:157"><span class="id" title="binder">prev_state</span></a> <a id="new_state:158" class="idref" href="#new_state:158"><span class="id" title="binder">new_state</span></a> <a id="chain:159" class="idref" href="#chain:159"><span class="id" title="binder">chain</span></a> <a id="ctx:160" class="idref" href="#ctx:160"><span class="id" title="binder">ctx</span></a> <a id="new_acts:161" class="idref" href="#new_acts:161"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:159"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:160"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:157"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:158"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:161"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:162" class="idref" href="#account:162"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:162"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:160"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:162"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:157"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:162"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:158"><span class="id" title="variable">new_state</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#add_is_partial_alter_plus"><span class="id" title="lemma">EIP20TokenCorrect.add_is_partial_alter_plus</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add_ne"><span class="id" title="lemma">FMap.find_add_ne</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_preserves_allowances" class="idref" href="#try_create_tokens_preserves_allowances"><span class="id" title="lemma">try_create_tokens_preserves_allowances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:163" class="idref" href="#prev_state:163"><span class="id" title="binder">prev_state</span></a> <a id="new_state:164" class="idref" href="#new_state:164"><span class="id" title="binder">new_state</span></a> <a id="chain:165" class="idref" href="#chain:165"><span class="id" title="binder">chain</span></a> <a id="ctx:166" class="idref" href="#ctx:166"><span class="id" title="binder">ctx</span></a> <a id="new_acts:167" class="idref" href="#new_acts:167"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:165"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:166"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:163"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:164"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:167"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:163"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:164"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_only_change_token_state" class="idref" href="#try_create_tokens_only_change_token_state"><span class="id" title="lemma">try_create_tokens_only_change_token_state</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:168" class="idref" href="#prev_state:168"><span class="id" title="binder">prev_state</span></a> <a id="new_state:169" class="idref" href="#new_state:169"><span class="id" title="binder">new_state</span></a> <a id="chain:170" class="idref" href="#chain:170"><span class="id" title="binder">chain</span></a> <a id="ctx:171" class="idref" href="#ctx:171"><span class="id" title="binder">ctx</span></a> <a id="new_acts:172" class="idref" href="#new_acts:172"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:170"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:171"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:168"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:169"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:172"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:168"><span class="id" title="variable">prev_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:169"><span class="id" title="variable">new_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:169"><span class="id" title="variable">new_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_is_some" class="idref" href="#try_create_tokens_is_some"><span class="id" title="lemma">try_create_tokens_is_some</span></a> : <span class="id" title="keyword">forall</span> <a id="state:173" class="idref" href="#state:173"><span class="id" title="binder">state</span></a> <a id="chain:174" class="idref" href="#chain:174"><span class="id" title="binder">chain</span></a> <a id="ctx:175" class="idref" href="#ctx:175"><span class="id" title="binder">ctx</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.lt"><span class="id" title="definition">Z.lt</span></a> 0 (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:175"><span class="id" title="variable">ctx</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:173"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:173"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:174"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:174"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:173"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:173"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:175"><span class="id" title="variable">ctx</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:173"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:173"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="x:176" class="idref" href="#x:176"><span class="id" title="binder">x</span></a> <a id="y:177" class="idref" href="#y:177"><span class="id" title="binder">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:174"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:175"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:173"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#x:176"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#y:177"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">propify</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rename</span> <span class="id" title="var">H4</span> <span class="id" title="var">into</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">funding_active</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_nonnegative</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">cap_not_hit</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span> : <span class="id" title="var">contract_simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">propify</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_or_hyps</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_acts_correct" class="idref" href="#try_create_tokens_acts_correct"><span class="id" title="lemma">try_create_tokens_acts_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:178" class="idref" href="#prev_state:178"><span class="id" title="binder">prev_state</span></a> <a id="new_state:179" class="idref" href="#new_state:179"><span class="id" title="binder">new_state</span></a> <a id="chain:180" class="idref" href="#chain:180"><span class="id" title="binder">chain</span></a> <a id="ctx:181" class="idref" href="#ctx:181"><span class="id" title="binder">ctx</span></a> <a id="new_acts:182" class="idref" href="#new_acts:182"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:180"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:181"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:178"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:179"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:182"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:182"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_amount_correct" class="idref" href="#try_create_tokens_amount_correct"><span class="id" title="lemma">try_create_tokens_amount_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:183" class="idref" href="#prev_state:183"><span class="id" title="binder">prev_state</span></a> <a id="new_state:184" class="idref" href="#new_state:184"><span class="id" title="binder">new_state</span></a> <a id="chain:185" class="idref" href="#chain:185"><span class="id" title="binder">chain</span></a> <a id="ctx:186" class="idref" href="#ctx:186"><span class="id" title="binder">ctx</span></a> <a id="new_acts:187" class="idref" href="#new_acts:187"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:185"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:186"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:183"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:184"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:187"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.lt"><span class="id" title="definition">Z.lt</span></a> 0 <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:186"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.leb_gt"><span class="id" title="lemma">Z.leb_gt</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab185"></a><h2 class="section">Finalize correct</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_finalize_isFinalized_correct" class="idref" href="#try_finalize_isFinalized_correct"><span class="id" title="lemma">try_finalize_isFinalized_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:188" class="idref" href="#prev_state:188"><span class="id" title="binder">prev_state</span></a> <a id="new_state:189" class="idref" href="#new_state:189"><span class="id" title="binder">new_state</span></a> <a id="chain:190" class="idref" href="#chain:190"><span class="id" title="binder">chain</span></a> <a id="ctx:191" class="idref" href="#ctx:191"><span class="id" title="binder">ctx</span></a> <a id="new_acts:192" class="idref" href="#new_acts:192"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:190"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:191"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:188"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:189"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:192"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:188"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:189"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">propify</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_finalize_only_change_isFinalized" class="idref" href="#try_finalize_only_change_isFinalized"><span class="id" title="lemma">try_finalize_only_change_isFinalized</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:193" class="idref" href="#prev_state:193"><span class="id" title="binder">prev_state</span></a> <a id="new_state:194" class="idref" href="#new_state:194"><span class="id" title="binder">new_state</span></a> <a id="chain:195" class="idref" href="#chain:195"><span class="id" title="binder">chain</span></a> <a id="ctx:196" class="idref" href="#ctx:196"><span class="id" title="binder">ctx</span></a> <a id="new_acts:197" class="idref" href="#new_acts:197"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:195"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:196"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:193"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:194"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:197"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:193"><span class="id" title="variable">prev_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:194"><span class="id" title="variable">new_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:194"><span class="id" title="variable">new_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_finalize_preserves_total_supply" class="idref" href="#try_finalize_preserves_total_supply"><span class="id" title="lemma">try_finalize_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:198" class="idref" href="#prev_state:198"><span class="id" title="binder">prev_state</span></a> <a id="new_state:199" class="idref" href="#new_state:199"><span class="id" title="binder">new_state</span></a> <a id="chain:200" class="idref" href="#chain:200"><span class="id" title="binder">chain</span></a> <a id="ctx:201" class="idref" href="#ctx:201"><span class="id" title="binder">ctx</span></a> <a id="new_acts:202" class="idref" href="#new_acts:202"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:200"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:201"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:198"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:199"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:202"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:198"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:199"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_only_change_isFinalized"><span class="id" title="lemma">try_finalize_only_change_isFinalized</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_finalize_is_some" class="idref" href="#try_finalize_is_some"><span class="id" title="lemma">try_finalize_is_some</span></a> : <span class="id" title="keyword">forall</span> <a id="state:203" class="idref" href="#state:203"><span class="id" title="binder">state</span></a> <a id="chain:204" class="idref" href="#chain:204"><span class="id" title="binder">chain</span></a> <a id="ctx:205" class="idref" href="#ctx:205"><span class="id" title="binder">ctx</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:205"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:203"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:205"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:203"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:203"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:203"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:203"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:204"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:203"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:203"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="x:206" class="idref" href="#x:206"><span class="id" title="binder">x</span></a> <a id="y:207" class="idref" href="#y:207"><span class="id" title="binder">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:204"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:205"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:203"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#x:206"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#y:207"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">propify</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_or_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_finalize_acts_correct" class="idref" href="#try_finalize_acts_correct"><span class="id" title="lemma">try_finalize_acts_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:208" class="idref" href="#prev_state:208"><span class="id" title="binder">prev_state</span></a> <a id="new_state:209" class="idref" href="#new_state:209"><span class="id" title="binder">new_state</span></a> <a id="chain:210" class="idref" href="#chain:210"><span class="id" title="binder">chain</span></a> <a id="ctx:211" class="idref" href="#ctx:211"><span class="id" title="binder">ctx</span></a> <a id="new_acts:212" class="idref" href="#new_acts:212"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:210"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:211"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:208"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:209"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:212"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:212"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:208"><span class="id" title="variable">prev_state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_balance"><span class="id" title="projection">ctx_contract_balance</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:211"><span class="id" title="variable">ctx</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab186"></a><h2 class="section">Refund correct</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_refund_balance_correct" class="idref" href="#try_refund_balance_correct"><span class="id" title="lemma">try_refund_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:213" class="idref" href="#prev_state:213"><span class="id" title="binder">prev_state</span></a> <a id="new_state:214" class="idref" href="#new_state:214"><span class="id" title="binder">new_state</span></a> <a id="chain:215" class="idref" href="#chain:215"><span class="id" title="binder">chain</span></a> <a id="ctx:216" class="idref" href="#ctx:216"><span class="id" title="binder">ctx</span></a> <a id="new_acts:217" class="idref" href="#new_acts:217"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:215"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:216"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:213"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:214"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:217"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:216"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:214"><span class="id" title="variable">new_state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add"><span class="id" title="lemma">FMap.find_add</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_refund_total_supply_correct" class="idref" href="#try_refund_total_supply_correct"><span class="id" title="lemma">try_refund_total_supply_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:218" class="idref" href="#prev_state:218"><span class="id" title="binder">prev_state</span></a> <a id="new_state:219" class="idref" href="#new_state:219"><span class="id" title="binder">new_state</span></a> <a id="chain:220" class="idref" href="#chain:220"><span class="id" title="binder">chain</span></a> <a id="ctx:221" class="idref" href="#ctx:221"><span class="id" title="binder">ctx</span></a> <a id="new_acts:222" class="idref" href="#new_acts:222"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:220"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:221"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:218"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:219"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:222"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:218"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:221"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:218"><span class="id" title="variable">prev_state</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:219"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">result_to_option</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_refund_preserves_other_balances" class="idref" href="#try_refund_preserves_other_balances"><span class="id" title="lemma">try_refund_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:223" class="idref" href="#prev_state:223"><span class="id" title="binder">prev_state</span></a> <a id="new_state:224" class="idref" href="#new_state:224"><span class="id" title="binder">new_state</span></a> <a id="chain:225" class="idref" href="#chain:225"><span class="id" title="binder">chain</span></a> <a id="ctx:226" class="idref" href="#ctx:226"><span class="id" title="binder">ctx</span></a> <a id="new_acts:227" class="idref" href="#new_acts:227"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:225"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:226"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:223"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:224"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:227"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:228" class="idref" href="#account:228"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:228"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:226"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:228"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:223"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:228"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:224"><span class="id" title="variable">new_state</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add_ne"><span class="id" title="lemma">FMap.find_add_ne</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_refund_preserves_allowances" class="idref" href="#try_refund_preserves_allowances"><span class="id" title="lemma">try_refund_preserves_allowances</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:229" class="idref" href="#prev_state:229"><span class="id" title="binder">prev_state</span></a> <a id="new_state:230" class="idref" href="#new_state:230"><span class="id" title="binder">new_state</span></a> <a id="chain:231" class="idref" href="#chain:231"><span class="id" title="binder">chain</span></a> <a id="ctx:232" class="idref" href="#ctx:232"><span class="id" title="binder">ctx</span></a> <a id="new_acts:233" class="idref" href="#new_acts:233"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:231"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:232"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:229"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:230"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:233"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:229"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:230"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_refund_only_change_token_state" class="idref" href="#try_refund_only_change_token_state"><span class="id" title="lemma">try_refund_only_change_token_state</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:234" class="idref" href="#prev_state:234"><span class="id" title="binder">prev_state</span></a> <a id="new_state:235" class="idref" href="#new_state:235"><span class="id" title="binder">new_state</span></a> <a id="chain:236" class="idref" href="#chain:236"><span class="id" title="binder">chain</span></a> <a id="ctx:237" class="idref" href="#ctx:237"><span class="id" title="binder">ctx</span></a> <a id="new_acts:238" class="idref" href="#new_acts:238"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:236"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:237"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:234"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:235"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:238"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:234"><span class="id" title="variable">prev_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:235"><span class="id" title="variable">new_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:235"><span class="id" title="variable">new_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_refund_is_some" class="idref" href="#try_refund_is_some"><span class="id" title="lemma">try_refund_is_some</span></a> : <span class="id" title="keyword">forall</span> <a id="state:239" class="idref" href="#state:239"><span class="id" title="binder">state</span></a> <a id="chain:240" class="idref" href="#chain:240"><span class="id" title="binder">chain</span></a> <a id="ctx:241" class="idref" href="#ctx:241"><span class="id" title="binder">ctx</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:241"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:239"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:239"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:240"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:239"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:239"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:241"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:239"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:241"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:239"><span class="id" title="variable">state</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="x:242" class="idref" href="#x:242"><span class="id" title="binder">x</span></a> <a id="y:243" class="idref" href="#y:243"><span class="id" title="binder">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:240"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:241"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:239"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#x:242"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#y:243"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">propify</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_or_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">result_to_option</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_refund_acts_correct" class="idref" href="#try_refund_acts_correct"><span class="id" title="lemma">try_refund_acts_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:244" class="idref" href="#prev_state:244"><span class="id" title="binder">prev_state</span></a> <a id="new_state:245" class="idref" href="#new_state:245"><span class="id" title="binder">new_state</span></a> <a id="chain:246" class="idref" href="#chain:246"><span class="id" title="binder">chain</span></a> <a id="ctx:247" class="idref" href="#ctx:247"><span class="id" title="binder">ctx</span></a> <a id="new_acts:248" class="idref" href="#new_acts:248"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:246"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:247"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:244"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:245"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:248"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:248"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:247"><span class="id" title="variable">ctx</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.of_N"><span class="id" title="definition">Z.of_N</span></a> (<a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:247"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:244"><span class="id" title="variable">prev_state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">/</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:244"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">result_to_option</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab187"></a><h2 class="section">Init correct</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="init_bat_balance_correct" class="idref" href="#init_bat_balance_correct"><span class="id" title="lemma">init_bat_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="state:249" class="idref" href="#state:249"><span class="id" title="binder">state</span></a> <a id="chain:250" class="idref" href="#chain:250"><span class="id" title="binder">chain</span></a> <a id="ctx:251" class="idref" href="#ctx:251"><span class="id" title="binder">ctx</span></a> <a id="setup:252" class="idref" href="#setup:252"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:250"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:251"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:252"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:249"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:249"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:249"><span class="id" title="variable">state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:252"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add"><span class="id" title="lemma">FMap.find_add</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="init_other_balances_correct" class="idref" href="#init_other_balances_correct"><span class="id" title="lemma">init_other_balances_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="state:253" class="idref" href="#state:253"><span class="id" title="binder">state</span></a> <a id="chain:254" class="idref" href="#chain:254"><span class="id" title="binder">chain</span></a> <a id="ctx:255" class="idref" href="#ctx:255"><span class="id" title="binder">ctx</span></a> <a id="setup:256" class="idref" href="#setup:256"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:254"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:255"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:256"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:253"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <a id="account:257" class="idref" href="#account:257"><span class="id" title="binder">account</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:257"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:253"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:257"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:253"><span class="id" title="variable">state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_funddeposit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add_ne"><span class="id" title="lemma">FMap.find_add_ne</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="init_allowances_correct" class="idref" href="#init_allowances_correct"><span class="id" title="lemma">init_allowances_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="state:258" class="idref" href="#state:258"><span class="id" title="binder">state</span></a> <a id="chain:259" class="idref" href="#chain:259"><span class="id" title="binder">chain</span></a> <a id="ctx:260" class="idref" href="#ctx:260"><span class="id" title="binder">ctx</span></a> <a id="setup:261" class="idref" href="#setup:261"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:259"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:260"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:261"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:258"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:258"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.empty"><span class="id" title="abbreviation">FMap.empty</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="init_isFinalized_correct" class="idref" href="#init_isFinalized_correct"><span class="id" title="lemma">init_isFinalized_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="state:262" class="idref" href="#state:262"><span class="id" title="binder">state</span></a> <a id="chain:263" class="idref" href="#chain:263"><span class="id" title="binder">chain</span></a> <a id="ctx:264" class="idref" href="#ctx:264"><span class="id" title="binder">ctx</span></a> <a id="setup:265" class="idref" href="#setup:265"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:263"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:264"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:265"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:262"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:262"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="init_total_supply_correct" class="idref" href="#init_total_supply_correct"><span class="id" title="lemma">init_total_supply_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="state:266" class="idref" href="#state:266"><span class="id" title="binder">state</span></a> <a id="chain:267" class="idref" href="#chain:267"><span class="id" title="binder">chain</span></a> <a id="ctx:268" class="idref" href="#ctx:268"><span class="id" title="binder">ctx</span></a> <a id="setup:269" class="idref" href="#setup:269"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:267"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:268"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:269"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:266"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:266"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:269"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="init_constants_correct" class="idref" href="#init_constants_correct"><span class="id" title="lemma">init_constants_correct</span></a> : <span class="id" title="keyword">forall</span> <a id="state:270" class="idref" href="#state:270"><span class="id" title="binder">state</span></a> <a id="chain:271" class="idref" href="#chain:271"><span class="id" title="binder">chain</span></a> <a id="ctx:272" class="idref" href="#ctx:272"><span class="id" title="binder">ctx</span></a> <a id="setup:273" class="idref" href="#setup:273"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:271"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:272"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundDeposit"><span class="id" title="projection">_fundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_batFundDeposit"><span class="id" title="projection">_batFundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundingEnd"><span class="id" title="projection">_fundingEnd</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenCreationCap"><span class="id" title="projection">_tokenCreationCap</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenCreationMin"><span class="id" title="projection">_tokenCreationMin</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:270"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:273"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab188"></a><h2 class="section">Functions preserve sum of balances</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_preserves_balances_sum" class="idref" href="#try_transfer_preserves_balances_sum"><span class="id" title="lemma">try_transfer_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:274" class="idref" href="#prev_state:274"><span class="id" title="binder">prev_state</span></a> <a id="new_state:275" class="idref" href="#new_state:275"><span class="id" title="binder">new_state</span></a> <a id="chain:276" class="idref" href="#chain:276"><span class="id" title="binder">chain</span></a> <a id="ctx:277" class="idref" href="#ctx:277"><span class="id" title="binder">ctx</span></a> <a id="to:278" class="idref" href="#to:278"><span class="id" title="binder">to</span></a> <a id="amount:279" class="idref" href="#amount:279"><span class="id" title="binder">amount</span></a> <a id="new_acts:280" class="idref" href="#new_acts:280"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:276"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:277"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:274"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:278"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:279"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:275"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:280"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:274"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:275"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_preserves_balances_sum"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_preserves_balances_sum</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_transfer_from_preserves_balances_sum" class="idref" href="#try_transfer_from_preserves_balances_sum"><span class="id" title="lemma">try_transfer_from_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:281" class="idref" href="#prev_state:281"><span class="id" title="binder">prev_state</span></a> <a id="new_state:282" class="idref" href="#new_state:282"><span class="id" title="binder">new_state</span></a> <a id="chain:283" class="idref" href="#chain:283"><span class="id" title="binder">chain</span></a> <a id="ctx:284" class="idref" href="#ctx:284"><span class="id" title="binder">ctx</span></a> <a id="from:285" class="idref" href="#from:285"><span class="id" title="binder">from</span></a> <a id="to:286" class="idref" href="#to:286"><span class="id" title="binder">to</span></a> <a id="amount:287" class="idref" href="#amount:287"><span class="id" title="binder">amount</span></a> <a id="new_acts:288" class="idref" href="#new_acts:288"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:283"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:284"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:281"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#from:285"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#to:286"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:287"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:282"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:288"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:281"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:282"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_transfer_from_preserves_balances_sum"><span class="id" title="lemma">EIP20TokenCorrect.try_transfer_from_preserves_balances_sum</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_approve_preserves_balances_sum" class="idref" href="#try_approve_preserves_balances_sum"><span class="id" title="lemma">try_approve_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:289" class="idref" href="#prev_state:289"><span class="id" title="binder">prev_state</span></a> <a id="new_state:290" class="idref" href="#new_state:290"><span class="id" title="binder">new_state</span></a> <a id="chain:291" class="idref" href="#chain:291"><span class="id" title="binder">chain</span></a> <a id="ctx:292" class="idref" href="#ctx:292"><span class="id" title="binder">ctx</span></a> <a id="delegate:293" class="idref" href="#delegate:293"><span class="id" title="binder">delegate</span></a> <a id="amount:294" class="idref" href="#amount:294"><span class="id" title="binder">amount</span></a> <a id="new_acts:295" class="idref" href="#new_acts:295"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:291"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:292"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:289"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#delegate:293"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#amount:294"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:290"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:295"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:289"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:290"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#try_approve_preserves_balances_sum"><span class="id" title="lemma">EIP20TokenCorrect.try_approve_preserves_balances_sum</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_create_tokens_update_balances_sum" class="idref" href="#try_create_tokens_update_balances_sum"><span class="id" title="lemma">try_create_tokens_update_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:296" class="idref" href="#prev_state:296"><span class="id" title="binder">prev_state</span></a> <a id="new_state:297" class="idref" href="#new_state:297"><span class="id" title="binder">new_state</span></a> <a id="chain:298" class="idref" href="#chain:298"><span class="id" title="binder">chain</span></a> <a id="ctx:299" class="idref" href="#ctx:299"><span class="id" title="binder">ctx</span></a> <a id="new_acts:300" class="idref" href="#new_acts:300"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:298"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:299"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:296"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:297"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:300"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:296"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:299"><span class="id" title="variable">ctx</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:296"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:297"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20Token.html#sum_balances"><span class="id" title="definition">EIP20Token.sum_balances</span></a>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20TokenCorrect.html#add_is_partial_alter_plus"><span class="id" title="lemma">EIP20TokenCorrect.add_is_partial_alter_plus</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <span class="id" title="var">prev_state</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">from_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">from_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add_existing"><span class="id" title="lemma">FMap.elements_add_existing</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Utils.Extras.html#sumN_split"><span class="id" title="lemma">sumN_split</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) (<span class="id" title="var">y</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Utils.Extras.html#sumN_swap"><span class="id" title="lemma">sumN_swap</span></a>, <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp/stdpp.fin_maps.html#map_to_list_delete"><span class="id" title="lemma">fin_maps.map_to_list_delete</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">from_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add"><span class="id" title="lemma">FMap.elements_add</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_finalize_preserves_balances_sum" class="idref" href="#try_finalize_preserves_balances_sum"><span class="id" title="lemma">try_finalize_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:301" class="idref" href="#prev_state:301"><span class="id" title="binder">prev_state</span></a> <a id="new_state:302" class="idref" href="#new_state:302"><span class="id" title="binder">new_state</span></a> <a id="chain:303" class="idref" href="#chain:303"><span class="id" title="binder">chain</span></a> <a id="ctx:304" class="idref" href="#ctx:304"><span class="id" title="binder">ctx</span></a> <a id="new_acts:305" class="idref" href="#new_acts:305"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:303"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:304"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:301"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:302"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:305"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:301"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:302"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="try_refund_update_balances_sum" class="idref" href="#try_refund_update_balances_sum"><span class="id" title="lemma">try_refund_update_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:306" class="idref" href="#prev_state:306"><span class="id" title="binder">prev_state</span></a> <a id="new_state:307" class="idref" href="#new_state:307"><span class="id" title="binder">new_state</span></a> <a id="chain:308" class="idref" href="#chain:308"><span class="id" title="binder">chain</span></a> <a id="ctx:309" class="idref" href="#ctx:309"><span class="id" title="binder">ctx</span></a> <a id="new_acts:310" class="idref" href="#new_acts:310"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:308"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:309"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:306"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:307"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:310"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:306"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:307"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:309"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:306"><span class="id" title="variable">prev_state</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20Token.html#sum_balances"><span class="id" title="definition">EIP20Token.sum_balances</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">result_to_option</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add_existing"><span class="id" title="lemma">FMap.elements_add_existing</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="var">with_default</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span> ((<span class="id" title="keyword">fun</span> '<a id="pat:314" class="idref" href="#pat:314"><span class="id" title="binder">(</span></a><a id="pat:314" class="idref" href="#pat:314"><span class="id" title="binder">_</span></a><a id="pat:314" class="idref" href="#pat:314"><span class="id" title="binder">,</span></a> <a id="pat:314" class="idref" href="#pat:314"><span class="id" title="binder">v</span></a><a id="pat:314" class="idref" href="#pat:314"><span class="id" title="binder">)</span></a> =&gt; <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#v:311"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">t</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Utils.Extras.html#sumN_inv"><span class="id" title="lemma">sumN_inv</span></a>, <a class="idref" href="ConCert.Utils.Extras.html#sumN_swap"><span class="id" title="lemma">sumN_swap</span></a>, <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp/stdpp.fin_maps.html#map_to_list_delete"><span class="id" title="lemma">fin_maps.map_to_list_delete</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="init_preserves_balances_sum" class="idref" href="#init_preserves_balances_sum"><span class="id" title="lemma">init_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <a id="state:315" class="idref" href="#state:315"><span class="id" title="binder">state</span></a> <a id="chain:316" class="idref" href="#chain:316"><span class="id" title="binder">chain</span></a> <a id="ctx:317" class="idref" href="#ctx:317"><span class="id" title="binder">ctx</span></a> <a id="setup:318" class="idref" href="#setup:318"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:316"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:317"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:318"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:315"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:315"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#state:315"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.EIP20.EIP20Token.html#sum_balances"><span class="id" title="definition">EIP20Token.sum_balances</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add"><span class="id" title="lemma">FMap.elements_add</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp/stdpp.fin_maps.html#map_to_list_empty"><span class="id" title="lemma">fin_maps.map_to_list_empty</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_0_r"><span class="id" title="lemma">N.add_0_r</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab189"></a><h2 class="section">Sum of balances always equals total supply</h2>

<div class="paragraph"> </div>

 In any reachable state the sum of token balance
      will be equal to the total supply of tokens 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="sum_balances_eq_total_supply" class="idref" href="#sum_balances_eq_total_supply"><span class="id" title="lemma">sum_balances_eq_total_supply</span></a> <a id="bstate:319" class="idref" href="#bstate:319"><span class="id" title="binder">bstate</span></a> <a id="caddr:320" class="idref" href="#caddr:320"><span class="id" title="binder">caddr</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:319"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:319"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:320"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="cstate:321" class="idref" href="#cstate:321"><span class="id" title="binder">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:319"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:320"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:321"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:321"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#:::'sum_balances'_x"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:321"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_contract_state_prop"><span class="id" title="lemma">lift_contract_state_prop</span></a> <a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">contract</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#init_preserves_balances_sum"><span class="id" title="lemma">init_preserves_balances_sum</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">IH</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Blockchain.html#receive"><span class="id" title="projection">Blockchain.receive</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_transfer_preserves_balances_sum"><span class="id" title="lemma">try_transfer_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_transfer_from_preserves_balances_sum"><span class="id" title="lemma">try_transfer_from_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_approve_preserves_balances_sum"><span class="id" title="lemma">try_approve_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_create_tokens_update_balances_sum"><span class="id" title="lemma">try_create_tokens_update_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_create_tokens_total_supply_correct"><span class="id" title="lemma">try_create_tokens_total_supply_correct</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_preserves_balances_sum"><span class="id" title="lemma">try_finalize_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_preserves_total_supply"><span class="id" title="lemma">try_finalize_preserves_total_supply</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_refund_update_balances_sum"><span class="id" title="lemma">try_refund_update_balances_sum</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">balance_sum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_refund_total_supply_correct"><span class="id" title="lemma">try_refund_total_supply_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab190"></a><h2 class="section">Total supply can only grow before funding fails</h2>

<div class="paragraph"> </div>

 If funding period is active or funding goal was hit then the
      total supply of tokens cannot decrease 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="receive_total_supply_increasing" class="idref" href="#receive_total_supply_increasing"><span class="id" title="lemma">receive_total_supply_increasing</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:322" class="idref" href="#prev_state:322"><span class="id" title="binder">prev_state</span></a> <a id="new_state:323" class="idref" href="#new_state:323"><span class="id" title="binder">new_state</span></a> <a id="chain:324" class="idref" href="#chain:324"><span class="id" title="binder">chain</span></a> <a id="ctx:325" class="idref" href="#ctx:325"><span class="id" title="binder">ctx</span></a> <a id="msg:326" class="idref" href="#msg:326"><span class="id" title="binder">msg</span></a> <a id="new_acts:327" class="idref" href="#new_acts:327"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:324"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:322"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:322"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:322"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:324"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:325"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:322"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#msg:326"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:323"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:327"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:322"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:323"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">funding_active</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_create_tokens_total_supply_correct"><span class="id" title="lemma">try_create_tokens_total_supply_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_add_r"><span class="id" title="lemma">N.le_add_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_preserves_total_supply"><span class="id" title="lemma">try_finalize_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_refund_is_some"><span class="id" title="lemma">try_refund_is_some</span></a> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">refund_implications</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">receive_some</span> <span class="id" title="tactic">in</span> <span class="id" title="var">refund_implications</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">refund_implications</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab191"></a><h2 class="section">Constants are constant</h2>

<div class="paragraph"> </div>

 Constants should never change after after receiving msg 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="receive_preserves_constants" class="idref" href="#receive_preserves_constants"><span class="id" title="lemma">receive_preserves_constants</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:328" class="idref" href="#prev_state:328"><span class="id" title="binder">prev_state</span></a> <a id="new_state:329" class="idref" href="#new_state:329"><span class="id" title="binder">new_state</span></a> <a id="chain:330" class="idref" href="#chain:330"><span class="id" title="binder">chain</span></a> <a id="ctx:331" class="idref" href="#ctx:331"><span class="id" title="binder">ctx</span></a> <a id="msg:332" class="idref" href="#msg:332"><span class="id" title="binder">msg</span></a> <a id="new_acts:333" class="idref" href="#new_acts:333"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:330"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:331"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#msg:332"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:333"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:328"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:329"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>; <span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Constants are always equal to the initial assignment 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="constants_are_constant" class="idref" href="#constants_are_constant"><span class="id" title="lemma">constants_are_constant</span></a> <a id="bstate:334" class="idref" href="#bstate:334"><span class="id" title="binder">bstate</span></a> <a id="caddr:335" class="idref" href="#caddr:335"><span class="id" title="binder">caddr</span></a> (<a id="trace:336" class="idref" href="#trace:336"><span class="id" title="binder">trace</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:334"><span class="id" title="variable">bstate</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:334"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:335"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="deploy_info:337" class="idref" href="#deploy_info:337"><span class="id" title="binder">deploy_info</span></a> <a id="cstate:338" class="idref" href="#cstate:338"><span class="id" title="binder">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_info"><span class="id" title="definition">deployment_info</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#trace:336"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:335"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deploy_info:337"><span class="id" title="variable">deploy_info</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:334"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:335"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="keyword">let</span> <a id="setup:339" class="idref" href="#setup:339"><span class="id" title="binder">setup</span></a> := <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deploy_info:337"><span class="id" title="variable">deploy_info</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_setup"><span class="id" title="projection">deployment_setup</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:339"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundDeposit"><span class="id" title="projection">_fundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:339"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_batFundDeposit"><span class="id" title="projection">_batFundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:339"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:339"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundingEnd"><span class="id" title="projection">_fundingEnd</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:339"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:339"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenCreationCap"><span class="id" title="projection">_tokenCreationCap</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:339"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenCreationMin"><span class="id" title="projection">_tokenCreationMin</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:338"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:339"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_dep_info_contract_state_prop"><span class="id" title="lemma">lift_dep_info_contract_state_prop</span></a> <a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">contract</span></a>); <span class="id" title="tactic">intros</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#init_constants_correct"><span class="id" title="lemma">init_constants_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">IH</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#receive_preserves_constants"><span class="id" title="lemma">receive_preserves_constants</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab192"></a><h2 class="section">Finalize cannot be undone</h2>

<div class="paragraph"> </div>

 Once the contract is in the finalized state it cannot leave it 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="final_is_final" class="idref" href="#final_is_final"><span class="id" title="lemma">final_is_final</span></a> : <span class="id" title="keyword">forall</span> <a id="prev_state:340" class="idref" href="#prev_state:340"><span class="id" title="binder">prev_state</span></a> <a id="new_state:341" class="idref" href="#new_state:341"><span class="id" title="binder">new_state</span></a> <a id="chain:342" class="idref" href="#chain:342"><span class="id" title="binder">chain</span></a> <a id="ctx:343" class="idref" href="#ctx:343"><span class="id" title="binder">ctx</span></a> <a id="msg:344" class="idref" href="#msg:344"><span class="id" title="binder">msg</span></a> <a id="new_acts:345" class="idref" href="#new_acts:345"><span class="id" title="binder">new_acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:340"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#chain:342"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#ctx:343"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#prev_state:340"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#msg:344"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.ResultMonad.html#Ok"><span class="id" title="constructor">Ok</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:341"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:345"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_state:341"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * (<span class="id" title="var">finalized</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#eip_only_changes_token_state"><span class="id" title="lemma">eip_only_changes_token_state</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_create_tokens_only_change_token_state"><span class="id" title="lemma">try_create_tokens_only_change_token_state</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_isFinalized_correct"><span class="id" title="lemma">try_finalize_isFinalized_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_refund_only_change_token_state"><span class="id" title="lemma">try_refund_only_change_token_state</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab193"></a><h2 class="section">Cannot finalize if goal not hit</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="no_finalization_before_goal" class="idref" href="#no_finalization_before_goal"><span class="id" title="lemma">no_finalization_before_goal</span></a> <a id="bstate:346" class="idref" href="#bstate:346"><span class="id" title="binder">bstate</span></a> <a id="caddr:347" class="idref" href="#caddr:347"><span class="id" title="binder">caddr</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:346"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:346"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:347"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="cstate:348" class="idref" href="#cstate:348"><span class="id" title="binder">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:346"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:347"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:348"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:348"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:348"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:348"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_contract_state_prop"><span class="id" title="lemma">lift_contract_state_prop</span></a> <a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">contract</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> ? <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Blockchain.html#init"><span class="id" title="projection">Blockchain.init</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#init_isFinalized_correct"><span class="id" title="lemma">init_isFinalized_correct</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">IH</span> <span class="id" title="var">receive_some</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#eip_only_changes_token_state"><span class="id" title="lemma">eip_only_changes_token_state</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">finalized_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">supply_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">supply_unchanged</span>, &lt;- <span class="id" title="var">finalized_unchanged</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">supply_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">supply_unchanged</span>, &lt;- <span class="id" title="var">finalized_unchanged</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">supply_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">supply_unchanged</span>, &lt;- <span class="id" title="var">finalized_unchanged</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">propify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">propify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.nlt_ge"><span class="id" title="lemma">N.nlt_ge</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">propify</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab194"></a><h2 class="section">It is always possible to finalize</h2>

<div class="paragraph"> </div>

 Prove that it is always possible to reach a state where the token is finalized if the funding
      goal was reached 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="can_finalize_if_creation_min" class="idref" href="#can_finalize_if_creation_min"><span class="id" title="lemma">can_finalize_if_creation_min</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:349" class="idref" href="#bstate:349"><span class="id" title="binder">bstate</span></a> (<a id="reward:350" class="idref" href="#reward:350"><span class="id" title="binder">reward</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) (<a id="caddr:351" class="idref" href="#caddr:351"><span class="id" title="binder">caddr</span></a> <a id="creator:352" class="idref" href="#creator:352"><span class="id" title="binder">creator</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#creator:352"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#reward:350"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:349"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:349"><span class="id" title="variable">bstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="cstate:353" class="idref" href="#cstate:353"><span class="id" title="binder">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:349"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:351"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:349"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:351"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:353"><span class="id" title="variable">cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:353"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:353"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:353"><span class="id" title="variable">cstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':354" class="idref" href="#bstate':354"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:349"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate':354"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate':354"><span class="id" title="variable">bstate'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="cstate':355" class="idref" href="#cstate':355"><span class="id" title="binder">cstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate':354"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:351"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate':354"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:351"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate':355"><span class="id" title="variable">cstate'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate':355"><span class="id" title="variable">cstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hcreator</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">bstate_reachable</span> <span class="id" title="var">bstate_queue</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Empty&nbsp;the&nbsp;action&nbsp;queue&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;add&nbsp;new&nbsp;blocks&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty_queue</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">cstate</span> &amp; <span class="id" title="var">contract_deployed</span> &amp; <span class="id" title="var">contract_state</span> &amp; <span class="id" title="var">creation_min</span> &amp; <span class="id" title="var">fund_deposit_not_contract</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;H&nbsp;is&nbsp;preserved&nbsp;after&nbsp;transfers,&nbsp;discarding&nbsp;invalid&nbsp;actions,&nbsp;calling&nbsp;other&nbsp;contracts&nbsp;and&nbsp;deploying&nbsp;contracts&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 3: <span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqdec"><span class="id" title="method">address_eqdec</span></a> <span class="id" title="var">caddr</span> <span class="id" title="var">to_addr</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">eexists</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;H&nbsp;is&nbsp;preserved&nbsp;after&nbsp;calls&nbsp;to&nbsp;the&nbsp;contract&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">amount_nonnegative</span> <span class="id" title="var">enough_balance</span> <span class="id" title="var">reward</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">creator</span> <span class="id" title="var">Hcreator</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bstate_queue</span> <span class="id" title="var">bstate_reachable</span> <span class="id" title="var">bstate</span> <span class="id" title="var">new_acts_eq</span> <span class="id" title="var">act_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_state</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive_strong"><span class="id" title="lemma">wc_receive_strong</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prev_state'</span> &amp; <span class="id" title="var">msg'</span> &amp; <span class="id" title="var">new_state'</span> &amp; <span class="id" title="var">serialize_prev_state</span> &amp; <span class="id" title="var">_</span> &amp; <span class="id" title="var">serialize_new_state</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">serialize_prev_state</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">serialize_prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#receive_total_supply_increasing"><span class="id" title="lemma">receive_total_supply_increasing</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">total_supply_increasing</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#receive_preserves_constants"><span class="id" title="lemma">receive_preserves_constants</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> (? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="var">_</span> <span class="id" title="var">prev_state'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> <span class="id" title="var">new_state'</span> |- <span class="id" title="var">_</span>=&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">new_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;check&nbsp;if&nbsp;contract&nbsp;is&nbsp;already&nbsp;finalized,&nbsp;if&nbsp;it&nbsp;is&nbsp;we&nbsp;just&nbsp;use&nbsp;the&nbsp;current&nbsp;state&nbsp;to&nbsp;finish&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">finalized</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Fast&nbsp;forward&nbsp;time/slot&nbsp;to&nbsp;"fundingEnd"&nbsp;so&nbsp;that&nbsp;we&nbsp;know&nbsp;for&nbsp;sure&nbsp;that&nbsp;the&nbsp;funding&nbsp;period&nbsp;is&nbsp;not&nbsp;active<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;next&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forward_time</span> (<span class="id" title="var">cstate</span>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>)); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;forward_time&nbsp;gives&nbsp;us&nbsp;a&nbsp;new&nbsp;ChainState&nbsp;so&nbsp;we&nbsp;no&nbsp;longer&nbsp;need&nbsp;the&nbsp;old&nbsp;one&nbsp;therefore<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;call&nbsp;update_all&nbsp;to&nbsp;replace&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;the&nbsp;old&nbsp;ChainState&nbsp;with&nbsp;the&nbsp;new&nbsp;one&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;funding&nbsp;period&nbsp;is&nbsp;over&nbsp;or&nbsp;on&nbsp;its&nbsp;last&nbsp;slot&nbsp;and&nbsp;the&nbsp;funding&nbsp;minimum&nbsp;has&nbsp;been&nbsp;hit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;now&nbsp;we&nbsp;can&nbsp;add&nbsp;a&nbsp;new&nbsp;block&nbsp;containing&nbsp;a&nbsp;finalize&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_block</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#finalize_act"><span class="id" title="definition">finalize_act</span></a> <span class="id" title="var">cstate</span> <span class="id" title="var">caddr</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">)]</span></a> 1%<span class="id" title="var">nat</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp/stdpp.list.html#Forall_singleton"><span class="id" title="lemma">list.Forall_singleton</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#address_eq_refl"><span class="id" title="lemma">address_eq_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;hypothesis&nbsp;"slot_hit"&nbsp;no&nbsp;longer&nbsp;holds&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;update&nbsp;it&nbsp;manually&nbsp;before&nbsp;calling&nbsp;update_all&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <span class="id" title="var">cstate</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate0</span>)%<span class="id" title="var">nat</span> <span class="id" title="tactic">in</span> <span class="id" title="var">slot_hit</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">reward</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">creator</span> <span class="id" title="var">Hcreator</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;can&nbsp;now&nbsp;evaluate&nbsp;the&nbsp;action&nbsp;we&nbsp;added&nbsp;giving&nbsp;us&nbsp;a&nbsp;ChainState&nbsp;where<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;token&nbsp;is&nbsp;in&nbsp;its&nbsp;finalized&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evaluate_action</span> <a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;is&nbsp;enough&nbsp;balance&nbsp;to&nbsp;evaluate&nbsp;action&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;receive&nbsp;action&nbsp;returns&nbsp;Some&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_is_some"><span class="id" title="lemma">try_finalize_is_some</span></a> <span class="id" title="var">cstate</span> <span class="id" title="var">bstate0</span>) <span class="id" title="keyword">as</span> ((<span class="id" title="var">new_cstate</span> &amp; <span class="id" title="var">new_act</span> &amp; <span class="id" title="var">receive_some</span>) &amp; <span class="id" title="var">_</span>); <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_isFinalized_correct"><span class="id" title="lemma">try_finalize_isFinalized_correct</span></a> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">finalized_new_cstate</span>]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_only_change_isFinalized"><span class="id" title="lemma">try_finalize_only_change_isFinalized</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finalized_new_cstate</span>, (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_finalize_acts_correct"><span class="id" title="lemma">try_finalize_acts_correct</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">contract_state</span> <span class="id" title="var">slot_hit</span> <span class="id" title="var">creation_min</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue0</span>; <span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">repeat</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>)|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Finally&nbsp;we&nbsp;need&nbsp;to&nbsp;evaluate&nbsp;the&nbsp;new&nbsp;transfer&nbsp;action&nbsp;that&nbsp;finalize&nbsp;produced&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evaluate_transfer</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;transfer&nbsp;is&nbsp;nonnegative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.add_0_r"><span class="id" title="lemma">Z.add_0_r</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;is&nbsp;enough&nbsp;balance&nbsp;to&nbsp;evaluate&nbsp;the&nbsp;transfer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.add_0_r"><span class="id" title="lemma">Z.add_0_r</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.le_ge"><span class="id" title="lemma">Z.le_ge</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.le_refl"><span class="id" title="lemma">Z.le_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">exists</span> <span class="id" title="var">bstate0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Prove that it is always possible to reach a state where the token is finalized if there
      is enough money in the blockchain and the contract constants have valid values 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="can_finalize_if_deployed" class="idref" href="#can_finalize_if_deployed"><span class="id" title="lemma">can_finalize_if_deployed</span></a> : <span class="id" title="keyword">forall</span> <a id="deployed_bstate:356" class="idref" href="#deployed_bstate:356"><span class="id" title="binder">deployed_bstate</span></a> (<a id="reward:357" class="idref" href="#reward:357"><span class="id" title="binder">reward</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) (<a id="caddr:358" class="idref" href="#caddr:358"><span class="id" title="binder">caddr</span></a> <a id="creator:359" class="idref" href="#creator:359"><span class="id" title="binder">creator</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) <a id="accounts:360" class="idref" href="#accounts:360"><span class="id" title="binder">accounts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#creator:359"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#reward:357"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_bstate:356"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_bstate:356"><span class="id" title="variable">deployed_bstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#accounts:360"><span class="id" title="variable">accounts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> <a id="acc:361" class="idref" href="#acc:361"><span class="id" title="binder">acc</span></a> =&gt; <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#acc:361"><span class="id" title="variable">acc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#accounts:360"><span class="id" title="variable">accounts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="deployed_cstate:362" class="idref" href="#deployed_cstate:362"><span class="id" title="binder">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_bstate:356"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:358"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_bstate:356"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:358"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">((</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance"><span class="id" title="definition">spendable_balance</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_bstate:356"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#accounts:360"><span class="id" title="variable">accounts</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_chain"><span class="id" title="projection">env_chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_bstate:356"><span class="id" title="variable">deployed_bstate</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_chain"><span class="id" title="projection">env_chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_bstate:356"><span class="id" title="variable">deployed_bstate</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_cstate:362"><span class="id" title="variable">deployed_cstate</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> 0<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate:363" class="idref" href="#bstate:363"><span class="id" title="binder">bstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#deployed_bstate:356"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:363"><span class="id" title="variable">bstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:363"><span class="id" title="variable">bstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="cstate:364" class="idref" href="#cstate:364"><span class="id" title="binder">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:363"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:358"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:363"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:358"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:364"><span class="id" title="variable">cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:364"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hcreator</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">reach'</span> <span class="id" title="var">empty</span> <span class="id" title="var">accounts_unique</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Empty&nbsp;the&nbsp;action&nbsp;queue&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;add&nbsp;new&nbsp;blocks&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty_queue</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">cstate</span> &amp; <span class="id" title="var">contract_deployed</span> &amp; <span class="id" title="var">contract_state</span> &amp; <span class="id" title="var">enough_balance_to_fund</span> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">can_hit_fund_min</span> &amp; <span class="id" title="var">funding_period_started</span> &amp; <span class="id" title="var">funding_period_not_over</span> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fund_deposit_not_contract</span> &amp; <span class="id" title="var">echange_rate_nonzero</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;H&nbsp;is&nbsp;preserved&nbsp;after&nbsp;transfers,&nbsp;discarding&nbsp;invalid&nbsp;actions,&nbsp;calling&nbsp;other&nbsp;contracts&nbsp;and&nbsp;deploying&nbsp;contracts&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 3: <span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqdec"><span class="id" title="method">address_eqdec</span></a> <span class="id" title="var">caddr</span> <span class="id" title="var">to_addr</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">exists</span> <span class="id" title="var">cstate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; (<span class="id" title="var">easy</span> || <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_consume_act"><span class="id" title="lemma">spendable_consume_act</span></a>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">subst</span>; (<span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;H&nbsp;is&nbsp;preserved&nbsp;after&nbsp;calls&nbsp;to&nbsp;the&nbsp;contract&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">enough_balance</span> <span class="id" title="var">reward</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">creator</span> <span class="id" title="var">Hcreator</span> <span class="id" title="var">empty</span> <span class="id" title="var">reach'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">deployed_bstate</span> <span class="id" title="var">new_acts_eq</span> <span class="id" title="var">accounts_unique</span> <span class="id" title="var">accounts_not_contracts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_state</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive_strong"><span class="id" title="lemma">wc_receive_strong</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prev_state'</span> &amp; <span class="id" title="var">msg'</span> &amp; <span class="id" title="var">new_state'</span> &amp; <span class="id" title="var">serialize_prev_state</span> &amp; <span class="id" title="var">serialize_msg</span> &amp; <span class="id" title="var">serialize_new_state</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">serialize_prev_state</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">serialize_prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#receive_total_supply_increasing"><span class="id" title="lemma">receive_total_supply_increasing</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">total_supply_increasing</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#receive_preserves_constants"><span class="id" title="lemma">receive_preserves_constants</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> (? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="var">_</span> <span class="id" title="var">prev_state'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> <span class="id" title="var">new_state'</span> |- <span class="id" title="var">_</span>=&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> <span class="id" title="var">new_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; (<span class="id" title="var">easy</span> || <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>; [| <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_le_mono_l"><span class="id" title="lemma">N.sub_le_mono_l</span></a>, <span class="id" title="var">total_supply_increasing</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_consume_act"><span class="id" title="lemma">spendable_consume_act</span></a>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Update&nbsp;goal&nbsp;and&nbsp;eleminate&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;old&nbsp;ChainState&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;that&nbsp;the&nbsp;queue&nbsp;is&nbsp;empty&nbsp;we&nbsp;can&nbsp;switch&nbsp;from&nbsp;using&nbsp;spendable_balance<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;total_balance&nbsp;to&nbsp;simplify&nbsp;the&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_eq_total_balance"><span class="id" title="lemma">spendable_eq_total_balance</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;check&nbsp;if&nbsp;contract&nbsp;is&nbsp;already&nbsp;finalized,&nbsp;if&nbsp;it&nbsp;is&nbsp;we&nbsp;just&nbsp;use&nbsp;the&nbsp;current&nbsp;state&nbsp;to&nbsp;finish&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">finalized</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a> |].<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Next&nbsp;add&nbsp;a&nbsp;new&nbsp;block&nbsp;containing&nbsp;enough&nbsp;create_tokens&nbsp;actions&nbsp;to&nbsp;reach&nbsp;funding&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_block</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_token_acts"><span class="id" title="definition">create_token_acts</span></a> (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#add_balance"><span class="id" title="definition">add_balance</span></a> <span class="id" title="var">creator</span> <span class="id" title="var">reward</span> <span class="id" title="var">bstate</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a>)<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>) <span class="id" title="var">caddr</span> <span class="id" title="var">accounts</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a>) <span class="id" title="var">cstate</span>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>)) 1%<span class="id" title="var">nat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 1: <span class="id" title="tactic">apply</span> <span class="id" title="var">Hcreator</span>; <span class="id" title="tactic">eauto</span>; [<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="https://metacoq.github.io/html/MetaCoq.Template.utils.All_Forall.html#In_Forall"><span class="id" title="lemma">All_Forall.In_Forall</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_token_acts_is_account"><span class="id" title="lemma">create_token_acts_is_account</span></a> | <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_token_acts_origin_correct"><span class="id" title="lemma">create_token_acts_origin_correct</span></a> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;funding&nbsp;period&nbsp;is&nbsp;still&nbsp;not&nbsp;over&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate0</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span> <span class="id" title="tactic">in</span> <span class="id" title="var">funding_period_not_over</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;environment&nbsp;in&nbsp;the&nbsp;new&nbsp;ChainState&nbsp;is&nbsp;correct&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#setter_from_getter_Environment_env_account_balances"><span class="id" title="definition">setter_from_getter_Environment_env_account_balances</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a> =&gt; <a class="idref" href="ConCert.Execution.Blockchain.html#add_balance"><span class="id" title="definition">add_balance</span></a> <span class="id" title="var">creator</span> <span class="id" title="var">reward</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span>)) <span class="id" title="var">bstate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">bstate0</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>) <span class="id" title="tactic">in</span> <span class="id" title="var">queue0</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue0</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_token_acts_eq"><span class="id" title="lemma">create_token_acts_eq</span></a>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">now</span> <span class="id" title="var">rewrite_environment_equiv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;is&nbsp;still&nbsp;enough&nbsp;balance&nbsp;in&nbsp;accounts&nbsp;to&nbsp;hit&nbsp;funding&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_balance_positive"><span class="id" title="lemma">total_balance_positive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_balance_le"><span class="id" title="lemma">total_balance_le</span></a> <span class="id" title="var">bstate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">rewrite_environment_equiv</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">bstate0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">cstate</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Next&nbsp;we&nbsp;do&nbsp;induction&nbsp;on&nbsp;account&nbsp;to&nbsp;evaluate&nbsp;all&nbsp;the&nbsp;actions&nbsp;added&nbsp;to&nbsp;the&nbsp;queue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">accounts</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;If&nbsp;the&nbsp;queue&nbsp;is&nbsp;empty&nbsp;then&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;funding&nbsp;goal&nbsp;was&nbsp;hit<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;can&nbsp;then&nbsp;apply&nbsp;can_finalize_if_creation_min&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">accounts_unique</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">can_hit_fund_min</span> <span class="id" title="var">echange_rate_nonzero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finalized</span> <span class="id" title="var">funding_period_not_over</span> <span class="id" title="var">funding_period_started</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_0_r"><span class="id" title="lemma">N.le_0_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_0_le"><span class="id" title="lemma">N.sub_0_le</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#can_finalize_if_creation_min"><span class="id" title="lemma">can_finalize_if_creation_min</span></a> <span class="id" title="var">bstate0</span> <span class="id" title="var">reward</span> <span class="id" title="var">caddr</span> <span class="id" title="var">creator</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> []; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">reward</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">creator</span> <span class="id" title="var">Hcreator</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#NoDup_cons_iff"><span class="id" title="lemma">NoDup_cons_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">accounts_unique</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">accounts_unique</span> <span class="id" title="var">accounts_unique'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp/stdpp.list.html#Forall_cons"><span class="id" title="lemma">list.Forall_cons</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">accounts_not_contracts'</span>].<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Check&nbsp;if&nbsp;funding&nbsp;goal&nbsp;was&nbsp;alredy&nbsp;hit&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <span class="id" title="var">cstate</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">tokens_left_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;If&nbsp;funding&nbsp;goal&nbsp;is&nbsp;reached&nbsp;then&nbsp;we&nbsp;know&nbsp;that&nbsp;create_token_acts&nbsp;will&nbsp;not<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;produce&nbsp;any&nbsp;more&nbsp;actions&nbsp;so&nbsp;the&nbsp;queue&nbsp;is&nbsp;actually&nbsp;empty.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Therefore&nbsp;we&nbsp;can&nbsp;directly&nbsp;apply&nbsp;the&nbsp;induction&nbsp;hypothesis&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHaccounts</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">tokens_left_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">tokens_left_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_0_l"><span class="id" title="lemma">N.le_0_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">tokens_left_to_fund</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;check&nbsp;if&nbsp;the&nbsp;account&nbsp;balance&nbsp;is&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#f1746f02f141d025b1e53605943919bf"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate0</span> <span class="id" title="var">a</span>)%<span class="id" title="var">Z</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">balance_positive</span>; <span class="id" title="var">cycle</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.ltb_ge"><span class="id" title="lemma">Z.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">balance_positive</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.ltb_lt"><span class="id" title="lemma">Z.ltb_lt</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">balance_positive</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;If&nbsp;account&nbsp;balance&nbsp;is&nbsp;0&nbsp;then&nbsp;we&nbsp;need&nbsp;to&nbsp;discard&nbsp;the&nbsp;action&nbsp;as&nbsp;it<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cannot&nbsp;be&nbsp;evaluated&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">amount_zero</span> : (<span class="id" title="keyword">forall</span> <a id="x:366" class="idref" href="#x:366"><span class="id" title="binder">x</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#x:365"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#x:365"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0%<span class="id" title="var">N</span>)%<span class="id" title="var">Z</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_token_acts_cons"><span class="id" title="lemma">create_token_acts_cons</span></a>, <span class="id" title="var">amount_zero</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.min_0_r"><span class="id" title="lemma">N.min_0_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_0_l"><span class="id" title="lemma">N.mul_0_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_0_r"><span class="id" title="lemma">N.sub_0_r</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">queue0</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">discard_invalid_action</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;action&nbsp;cannot&nbsp;be&nbsp;evaluated&nbsp;since&nbsp;create_tokens<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requires&nbsp;to&nbsp;be&nbsp;called&nbsp;with&nbsp;amount&nbsp;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">accounts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">cstate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">p</span> <span class="id" title="var">reach0</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">balance_positive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="tactic">eval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">act_eq</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive_strong"><span class="id" title="lemma">wc_receive_strong</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prev_state'</span> &amp; <span class="id" title="var">msg'</span> &amp; <span class="id" title="var">new_state'</span> &amp; <span class="id" title="var">serialize_prev_state</span> &amp; <span class="id" title="var">serialize_msg</span> &amp; <span class="id" title="var">serialize_new_state</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_msg</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">serialize_msg</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_create_tokens_amount_correct"><span class="id" title="lemma">try_create_tokens_amount_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Apply&nbsp;induction&nbsp;hypothesis&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">edestruct</span> <span class="id" title="var">IHaccounts</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">bstate0</span> := <span class="id" title="var">bstate</span>) (<span class="id" title="var">cstate</span> := <span class="id" title="var">cstate</span>) <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">bstate_new</span> &amp; <span class="id" title="var">reach_new</span> &amp; <span class="id" title="var">emptyable_new</span> &amp; <span class="id" title="var">H</span>); <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_token_acts_eq"><span class="id" title="lemma">create_token_acts_eq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="var">rewrite_environment_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_balance_distr"><span class="id" title="lemma">total_balance_distr</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_balance_eq"><span class="id" title="lemma">total_balance_eq</span></a> <span class="id" title="var">_</span> <span class="id" title="var">bstate0</span>) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">intros</span>; <span class="id" title="var">now</span> <span class="id" title="var">rewrite_environment_equiv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;action&nbsp;is&nbsp;valid&nbsp;we&nbsp;need&nbsp;to&nbsp;evaluate&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evaluate_action</span> <a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 1-4: <span class="id" title="tactic">clear</span> <span class="id" title="var">fund_deposit_not_contract</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">IHaccounts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;is&nbsp;an&nbsp;action&nbsp;in&nbsp;the&nbsp;queue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_token_acts_cons"><span class="id" title="lemma">create_token_acts_cons</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;amount&nbsp;is&nbsp;nonnegative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.le_ge"><span class="id" title="lemma">Z.le_ge</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#N2Z.is_nonneg"><span class="id" title="lemma">N2Z.is_nonneg</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;amount&nbsp;&lt;=&nbsp;account&nbsp;balance&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;receive&nbsp;returns&nbsp;Some&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">accounts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="var">contract_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">funding_period_started</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">funding_period_not_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">finalized</span>, <span class="id" title="var">funding_period_started</span>, <span class="id" title="var">funding_period_not_over</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#N2Z.inj_min"><span class="id" title="lemma">N2Z.inj_min</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.id"><span class="id" title="lemma">Z2N.id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.ge_le"><span class="id" title="lemma">Z.ge_le</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>; <span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">finalized</span> <span class="id" title="var">funding_period_started</span> <span class="id" title="var">funding_period_not_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">match_amount</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="var">destruct_throw_if</span> <span class="id" title="var">match_amount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">match_cap</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="var">destruct_throw_if</span> <span class="id" title="var">match_cap</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> &lt;-; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">match_amount</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="var">destruct_throw_if</span> <span class="id" title="var">match_amount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">match_cap</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="var">destruct_throw_if</span> <span class="id" title="var">match_cap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="comment">(*&nbsp;Prove&nbsp;contradiction&nbsp;between&nbsp;match_amount,&nbsp;match_cap&nbsp;and&nbsp;can_hit_fund_min&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.ltb_lt"><span class="id" title="lemma">N.ltb_lt</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">match_cap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.leb_gt"><span class="id" title="lemma">Z.leb_gt</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.min_glb_lt_iff"><span class="id" title="lemma">Z.min_glb_lt_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">match_amount</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">min_left</span> <span class="id" title="var">min_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.inj_min"><span class="id" title="lemma">Z2N.inj_min</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#N2Z.id"><span class="id" title="lemma">N2Z.id</span></a>, &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_min_distr_r"><span class="id" title="lemma">N.mul_min_distr_r</span></a>, &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_min_distr_l"><span class="id" title="lemma">N.add_min_distr_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.min_glb_lt_iff"><span class="id" title="lemma">N.min_glb_lt_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">match_cap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">match_cap</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">match_cap_left</span> <span class="id" title="var">match_cap_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.lt_le_trans"><span class="id" title="lemma">N.lt_le_trans</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">p</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">match_cap_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_add_distr_r"><span class="id" title="lemma">N.mul_add_distr_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_1_l"><span class="id" title="lemma">N.mul_1_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_assoc"><span class="id" title="lemma">N.add_assoc</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_assoc"><span class="id" title="lemma">N.add_assoc</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_le_mono_r"><span class="id" title="lemma">N.add_le_mono_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#N_le_sub"><span class="id" title="lemma">N_le_sub</span></a>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#N_div_mul_le"><span class="id" title="lemma">N_div_mul_le</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="comment">(*&nbsp;Prove&nbsp;contradiction&nbsp;between&nbsp;match_amount,&nbsp;balance_positive&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Zbool.html#Zle_bool_imp_le"><span class="id" title="lemma">Zle_bool_imp_le</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.min_le"><span class="id" title="lemma">Z.min_le</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">match_amount</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">min_left</span> | <span class="id" title="var">min_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#N2Z.inj_0"><span class="id" title="lemma">N2Z.inj_0</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">min_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#N2Z.inj_le"><span class="id" title="lemma">N2Z.inj_le</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#N_le_add_distr"><span class="id" title="lemma">N_le_add_distr</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">min_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">caddr_not_in_accounts</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">caddr</span> <span class="id" title="var">accounts</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">intro</span>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall_forall"><span class="id" title="lemma">Forall_forall</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">accounts_not_contracts'</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">accounts_not_contracts'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_addr_format"><span class="id" title="lemma">contract_addr_format</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">contract_deployed</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Apply&nbsp;induction&nbsp;hypothesis&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">edestruct</span> <span class="id" title="var">IHaccounts</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">bstate_new</span> &amp; <span class="id" title="var">reach_new</span> &amp; <span class="id" title="var">emptyable_new</span> &amp; <span class="id" title="var">H</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">IHaccounts</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">balance_positive</span> <span class="id" title="var">queue0</span> <span class="id" title="var">tokens_left_to_fund</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 12: (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deployed_state</span>; <span class="id" title="tactic">eauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">eauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.inj_min"><span class="id" title="lemma">Z2N.inj_min</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#N2Z.id"><span class="id" title="lemma">N2Z.id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="var">funding_period_started</span> <span class="id" title="var">funding_period_not_over</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">can_hit_fund_min</span> <span class="id" title="var">fund_deposit_not_contract</span> <span class="id" title="var">finalized</span> <span class="id" title="var">contract_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;queues&nbsp;of&nbsp;the&nbsp;two&nbsp;ChainStates&nbsp;are&nbsp;equivalent&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_add_distr"><span class="id" title="lemma">N.sub_add_distr</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#create_token_acts_eq"><span class="id" title="lemma">create_token_acts_eq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">rewrite_environment_equiv</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;still&nbsp;is&nbsp;enough&nbsp;balance&nbsp;to&nbsp;hit&nbsp;funding&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">queue</span> <span class="id" title="var">accounts_not_contracts'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">edestruct</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.min_dec"><span class="id" title="lemma">N.min_dec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [| <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_0_l"><span class="id" title="lemma">N.le_0_l</span></a>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_add_distr_r"><span class="id" title="lemma">N.mul_add_distr_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_1_l"><span class="id" title="lemma">N.mul_1_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_0_r"><span class="id" title="lemma">N.le_0_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_add_distr"><span class="id" title="lemma">N.sub_add_distr</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_add_distr"><span class="id" title="lemma">N.sub_add_distr</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_0_le"><span class="id" title="lemma">N.sub_0_le</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#N_le_div_mul"><span class="id" title="lemma">N_le_div_mul</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_balance_distr"><span class="id" title="lemma">total_balance_distr</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_balance_eq"><span class="id" title="lemma">total_balance_eq</span></a> <span class="id" title="var">_</span> <span class="id" title="var">bstate0</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_sub_le_add_r"><span class="id" title="lemma">N.le_sub_le_add_r</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_add_distr"><span class="id" title="lemma">N.sub_add_distr</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [| <span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_le_mono_l"><span class="id" title="lemma">N.sub_le_mono_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.add_le_mono_l"><span class="id" title="lemma">N.add_le_mono_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="can_deploy_and_finalize" class="idref" href="#can_deploy_and_finalize"><span class="id" title="lemma">can_deploy_and_finalize</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:367" class="idref" href="#bstate:367"><span class="id" title="binder">bstate</span></a> (<a id="reward:368" class="idref" href="#reward:368"><span class="id" title="binder">reward</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) (<a id="caddr:369" class="idref" href="#caddr:369"><span class="id" title="binder">caddr</span></a> <a id="creator:370" class="idref" href="#creator:370"><span class="id" title="binder">creator</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) <a id="accounts:371" class="idref" href="#accounts:371"><span class="id" title="binder">accounts</span></a> <a id="setup:372" class="idref" href="#setup:372"><span class="id" title="binder">setup</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#creator:370"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#reward:368"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:367"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:367"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#accounts:371"><span class="id" title="variable">accounts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> <a id="acc:373" class="idref" href="#acc:373"><span class="id" title="binder">acc</span></a> =&gt; <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#acc:373"><span class="id" title="variable">acc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>) <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#accounts:371"><span class="id" title="variable">accounts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:369"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:367"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:369"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">((</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenCreationMin"><span class="id" title="projection">_tokenCreationMin</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance"><span class="id" title="definition">spendable_balance</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:367"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#accounts:371"><span class="id" title="variable">accounts</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenCreationCap"><span class="id" title="projection">_tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'-'_x"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenCreationMin"><span class="id" title="projection">_tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundingEnd"><span class="id" title="projection">_fundingEnd</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_chain"><span class="id" title="projection">env_chain</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:367"><span class="id" title="variable">bstate</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundDeposit"><span class="id" title="projection">_fundDeposit</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#setup:372"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="bstate':374" class="idref" href="#bstate':374"><span class="id" title="binder">bstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:367"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate':374"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate':374"><span class="id" title="variable">bstate'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="cstate:375" class="idref" href="#cstate:375"><span class="id" title="binder">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate':374"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:369"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate':374"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:369"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:375"><span class="id" title="variable">cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:375"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hcreator</span> <span class="id" title="var">Hreward</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bstate_reachable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bstate_queue</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">accounts_unique</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">accounts_not_contracts</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">caddr_is_contract</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_not_deployed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">enough_balance_to_fund</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">can_hit_fund_min</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">funding_period_nonempty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">funding_period_not_started</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fund_deposit_not_contract</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">echange_rate_nonzero</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_block</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[(</span></a><a class="idref" href="ConCert.Examples.BAT.BATCommon.html#deploy_act"><span class="id" title="definition">deploy_act</span></a> <span class="id" title="var">setup</span> <a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> <span class="id" title="var">creator</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">)]</span></a> 1%<span class="id" title="var">nat</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="https://plv.mpi-sws.org/coqdoc/stdpp/stdpp.list.html#Forall_singleton"><span class="id" title="lemma">list.Forall_singleton</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#address_eq_refl"><span class="id" title="lemma">address_eq_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate0</span><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a> <span class="id" title="var">setup</span>)%<span class="id" title="var">nat</span> <span class="id" title="tactic">in</span> <span class="id" title="var">funding_period_not_started</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance"><span class="id" title="definition">spendable_balance</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#pending_usage"><span class="id" title="definition">pending_usage</span></a>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>, <span class="id" title="var">bstate_queue</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Utils.Extras.html#sumZ_le"><span class="id" title="lemma">sumZ_le</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">deploy_contract</span> <a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#constants_are_constant"><span class="id" title="lemma">constants_are_constant</span></a> <span class="id" title="keyword">as</span> (<span class="id" title="var">dep_info</span> &amp; <span class="id" title="var">cstate'</span> &amp; <span class="id" title="var">deploy_info'</span> &amp; <span class="id" title="var">deployed_state'</span> &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ?); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deployed_state</span>, <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state'</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">cstate'</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deploy_info</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deploy_info'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deploy_info'</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">dep_info</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">deploy_info'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="var">_</span> <span class="id" title="var">cstate</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> <span class="id" title="var">setup</span> |- <span class="id" title="var">_</span>=&gt; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.sub_le_mono_l"><span class="id" title="lemma">N.sub_le_mono_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.eq_le_incl"><span class="id" title="lemma">N.eq_le_incl</span></a> | <span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span>]; <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqcstate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate</span> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_consume_act"><span class="id" title="lemma">spendable_consume_act</span></a>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">trace</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forward_time_exact</span> (<span class="id" title="var">cstate</span>.(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>)); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">inversion</span> <span class="id" title="var">header_valid</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#spendable_balance"><span class="id" title="definition">spendable_balance</span></a>, <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#pending_usage"><span class="id" title="definition">pending_usage</span></a>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>, <span class="id" title="var">queue0</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Utils.Extras.html#sumZ_le"><span class="id" title="lemma">sumZ_le</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">funding_period_not_started</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#can_finalize_if_deployed"><span class="id" title="lemma">can_finalize_if_deployed</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab195"></a><h2 class="section">Refund guarantee</h2>

<div class="paragraph"> </div>

 The BAToken contract should guarantee that all tokens (except for the free initSupply given to batFundDeposit)
      can be fully refunded. However as shown in the property based tests this is not the case so we can only prove
      a weaker result stating that refund msgs can always be consumed. This does not guarantee refunding as the
      proof does not state that the new actions produced by refund entrypoint can be evaluated. Thus it is not
      guaranteed that the state changes will be applied 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="weak_refund_guarantee" class="idref" href="#weak_refund_guarantee"><span class="id" title="lemma">weak_refund_guarantee</span></a> : <span class="id" title="keyword">forall</span> <a id="bstate:376" class="idref" href="#bstate:376"><span class="id" title="binder">bstate</span></a> <a id="cstate:377" class="idref" href="#cstate:377"><span class="id" title="binder">cstate</span></a> <a id="caddr:378" class="idref" href="#caddr:378"><span class="id" title="binder">caddr</span></a> <a id="account:379" class="idref" href="#account:379"><span class="id" title="binder">account</span></a> <a id="acts:380" class="idref" href="#acts:380"><span class="id" title="binder">acts</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="refund_act:381" class="idref" href="#refund_act:381"><span class="id" title="binder">refund_act</span></a> := <a class="idref" href="ConCert.Execution.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:379"><span class="id" title="variable">account</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:379"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:378"><span class="id" title="variable">caddr</span></a> 0 <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:376"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:376"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:378"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Examples.BAT.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:376"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#caddr:378"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:377"><span class="id" title="variable">cstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:376"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#refund_act:381"><span class="id" title="variable">refund_act</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#::list_scope:x_'::'_x"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#acts:380"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:377"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:376"><span class="id" title="variable">bstate</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;funding&nbsp;period&nbsp;is&nbsp;over&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:377"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:377"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;funding&nbsp;failed&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:379"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:377"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;sender&nbsp;is&nbsp;not&nbsp;batFundDeposit&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;0 <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.NArith.BinNat.html#::N_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#account:379"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#cstate:377"><span class="id" title="variable">cstate</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;account&nbsp;owns&nbsp;some&nbsp;tokens&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <a id="new_bstate:382" class="idref" href="#new_bstate:382"><span class="id" title="binder">new_bstate</span></a> <a id="new_acts:383" class="idref" href="#new_acts:383"><span class="id" title="binder">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_bstate:382"><span class="id" title="variable">new_bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:383"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#acts:380"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Logic.html#inhabited"><span class="id" title="inductive">inhabited</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#bstate:376"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#refund_act:381"><span class="id" title="variable">refund_act</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_bstate:382"><span class="id" title="variable">new_bstate</span></a> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#new_acts:383"><span class="id" title="variable">new_acts</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">queue</span> <span class="id" title="var">funding_over</span> <span class="id" title="var">funding_failed</span> <span class="id" title="var">account_not_batfund</span> <span class="id" title="var">has_tokens</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">refund_act</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#no_finalization_before_goal"><span class="id" title="lemma">no_finalization_before_goal</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">reach</span> <span class="id" title="keyword">as</span> <span class="id" title="var">not_finalized</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">not_finalized</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">cstate'</span> &amp; <span class="id" title="var">deployed_state'</span> &amp; <span class="id" title="var">not_finalized</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deployed_state</span>, <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">cstate'</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> {| <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a> := <span class="id" title="var">_</span>; <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> := <span class="id" title="var">_</span> |}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#eval_call"><span class="id" title="constructor">eval_call</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">msg</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.16.1/stdlib//Coq.ZArith.BinInt.html#Z.ge_le"><span class="id" title="lemma">Z.ge_le</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#try_refund_is_some"><span class="id" title="lemma">try_refund_is_some</span></a> <span class="id" title="keyword">as</span> [[<span class="id" title="var">new_cstate</span> [<span class="id" title="var">resp_acts</span> <span class="id" title="var">receive_some</span>]] <span class="id" title="var">_</span>]; <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc_receive_to_receive"><span class="id" title="lemma">wc_receive_to_receive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Blockchain.html#receive"><span class="id" title="projection">Blockchain.receive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">H1</span> <span class="id" title="var">into</span> <span class="id" title="var">account_balance_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">result_to_option</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span> (<a class="idref" href="ConCert.Utils.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <span class="id" title="var">account</span> (<a class="idref" href="ConCert.Examples.BAT.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <span class="id" title="var">cstate</span>))); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">account_balance_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Examples.BAT.BATCorrect.html#Theories"><span class="id" title="section">Theories</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="https://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a> and <a href="https://github.com/jgallen23/toc">TOC</a>
</div>
</div>
<script>
  const elements = document.getElementsByClassName("libtitle");
  while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
  }
  if (window.location.pathname.endsWith("/toc.html")) {
      const jstocDiv = document.getElementById("js-toc");
      jstocDiv.classList.remove("toc");
      jstocDiv.classList.add("jstoc-hidden");
      const jstocHeaderDiv = document.getElementById("js-toc-header");
      jstocHeaderDiv.classList.add("jstoc-hidden");
      const mainDiv = document.getElementById("main");
      mainDiv.classList.add("jstoc-hidden-main");
      const toggleDiv = document.getElementById("toggle-toc");
      toggleDiv.classList.add("jstoc-hidden");
  }
  console.log(window.location.pathname);
</script>
<script type="text/javascript" src="toc.js"></script>
</body>

</html>
